<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å°è›‹å­</title>
  
  <subtitle>å°è›‹å­</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xv44586.github.io/"/>
  <updated>2022-09-08T08:50:42.670Z</updated>
  <id>https://xv44586.github.io/</id>
  
  <author>
    <name>[object Object]</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>tokenizers æ€»ç»“</title>
    <link href="https://xv44586.github.io/2022/09/08/tokenizers/"/>
    <id>https://xv44586.github.io/2022/09/08/tokenizers/</id>
    <published>2022-09-08T07:23:52.000Z</published>
    <updated>2022-09-08T08:50:42.670Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#qian-yan">å‰è¨€</a><ul><li><a href="#bpe">BPE</a></li><li><a href="#bytes-bpe">Bytes BPE</a></li><li><a href="#wordpiece">WordPiece</a></li><li><a href="#unigram">Unigram</a></li><li><a href="#sentencepiece">SentencePiece</a></li><li><a href="#train-from-scratch">train from scratch</a></li></ul></li><li><a href="#tui-jian">æ¨è</a></li><li><a href="#bu-chong-yue-du">è¡¥å……é˜…è¯»</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div></p><h1><span id="qian-yan">å‰è¨€</span><a href="#qian-yan" class="header-anchor"></a></h1><p>tokenizer ç›®å‰ä¸»æµçš„æ–¹å¼æ˜¯subword levelï¼Œè‡³äºchar level /word level éƒ½ç”±äºç²’åº¦é—®é¢˜å·²è¢«ä¸»æµæŠ›å¼ƒã€‚ç›®å‰subword level çš„tokenizer BPE, Bytes BPE, WordPiece, Unigram, SentencePiece,ä¸‹é¢ç®€å•æ€»ç»“ä¸€ä¸‹å„ä¸ªæ–¹æ³•ã€‚ </p><h2><span id="bpe">BPE</span><a href="#bpe" class="header-anchor"></a></h2><p>bpe çš„æ–¹æ¡ˆæ˜¯é€šè¿‡ç»Ÿè®¡è¯é¢‘æ¥ç¡®å®šä¸¤ä¸ªç›¸é‚»çš„pair subwords è¦ä¸è¦åˆå¹¶ï¼Œå…·ä½“åšæ³•ï¼š<br>1.ç»Ÿè®¡pre-tokenize çš„word çš„è¯é¢‘ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">"hug"</span>, 10), (<span class="string">"pug"</span>, 5), (<span class="string">"pun"</span>, 12), (<span class="string">"bun"</span>, 4), (<span class="string">"hugs"</span>, 5)</span><br></pre></td></tr></table></figure></p><p>2.ä½¿ç”¨è¯å…¸å¯¹word è¿›è¡Œåˆ‡åˆ†ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># base vocabulary: ["b", "g", "h", "n", "p", "s", "u"]</span></span><br><span class="line">(<span class="string">"h"</span> <span class="string">"u"</span> <span class="string">"g"</span>, 10), (<span class="string">"p"</span> <span class="string">"u"</span> <span class="string">"g"</span>, 5), (<span class="string">"p"</span> <span class="string">"u"</span> <span class="string">"n"</span>, 12), (<span class="string">"b"</span> <span class="string">"u"</span> <span class="string">"n"</span>, 4), (<span class="string">"h"</span> <span class="string">"u"</span> <span class="string">"g"</span> <span class="string">"s"</span>, 5)</span><br></pre></td></tr></table></figure></p><p>3.ç»Ÿè®¡ç›¸é‚»ä¸¤ä¸ªsubword pair è¯é¢‘ï¼Œå°†top-k é«˜çš„pair åˆå¹¶ç”Ÿæˆæ–°çš„subwordï¼Œæ·»åŠ è¿›vocabularyï¼ŒåŒæ—¶ï¼Œå¦‚æœå½“å‰çš„subword  åªä¼šåŒpair ä¸€èµ·å‡ºç°ï¼Œåˆ™åŒæ—¶å°†vocabulary ä¸­å¯¹åº”subword åˆ é™¤ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># count pair</span></span><br><span class="line">h + u = 10 + 5 = 15</span><br><span class="line">u + g = 10 + 5 +  = 20</span><br><span class="line">...</span><br><span class="line"><span class="comment"># merge top k</span></span><br><span class="line"><span class="built_in">set</span> k = 1</span><br><span class="line">ug -&gt; vocabulary</span><br><span class="line">base vocabulary: [<span class="string">"b"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"n"</span>, <span class="string">"p"</span>, <span class="string">"s"</span>, <span class="string">"u"</span>, <span class="string">"ug"</span>]</span><br><span class="line">â€‹</span><br><span class="line">loop until vocabulary match vocab_size</span><br><span class="line">â€‹</span><br></pre></td></tr></table></figure></p><h2><span id="bytes-bpe">Bytes BPE</span><a href="#bytes-bpe" class="header-anchor"></a></h2><p>Bytes BPE ä¸BPEåŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼šBPE ä¸­ä¼šå­˜åœ¨UNK çš„æƒ…å†µï¼Œä¸ºäº†è§£å†³unk çš„é—®é¢˜ï¼Œä¸€ä¸ªéå¸¸å¤©æ‰çš„æƒ³æ³•æ˜¯å°†æ‰€æœ‰text å…ˆè½¬ä¸º<code>bytes</code> ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨unk çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤šè¯­è¨€ä¸­ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¤§å¤§ç¼©å‡è¯è¡¨å¤§å°;æ­¤å¤–å³ä½¿ä¸æ˜¯ç›®æ ‡è¯­è¨€è®­ç»ƒçš„æ¨¡å‹ä¹Ÿå¯ä»¥æ‹¿æ¥ä½¿ç”¨ã€‚é€šå¸¸è¯è¡¨å¤§å°åŒ…æ‹¬256 ä¸ªåŸºæœ¬bytes + &lt;end|of|text&gt; + vocab-size,å¦‚gpt2 çš„è¯è¡¨ä¸º50257: 256 base bytes tokens + &lt;end|of|text&gt; + 50,000 merges.<br>æ­¤å¤–ï¼Œè®­ç»ƒbytes bpe æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬è¿˜ä¼šé€‰æ‹©å…ˆå°†æ–‡æœ¬è¿›è¡Œnormalizeï¼Œè¿™éƒ¨åˆ†åé¢ä¼šè¿›ä¸€æ­¥è¯´æ˜ã€‚</p><h2><span id="wordpiece">WordPiece</span><a href="#wordpiece" class="header-anchor"></a></h2><p>WordPiece ä¸BPE ä¹Ÿéå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«ä¸»è¦åœ¨äºmerge çš„ç­–ç•¥ï¼šBPE ä¸­é€‰æ‹©é¢‘ç‡æœ€é«˜çš„pair è¿›è¡Œåˆå¹¶ï¼ŒWordPiece åˆ™é€‰æ‹©ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥è¿›è¡Œé€‰æ‹©ï¼š<br>$$<br>L = logP(S) = \sum^Nlog(P_i)<br>$$<br>å¯¹äºä¸¤ä¸ªsubwordï¼š $t_x$, $t_y$ ï¼Œåˆå¹¶åä¸º $t_z$ ï¼Œåˆ™åˆå¹¶å‰åçš„å¢ç›Šï¼š<br>$$<br>Loss = logP(t_z) - (logP(t_x) + logP(t_y))<br>$$<br>é€šè¿‡è®¡ç®—åˆå¹¶å¢ç›Šæ˜¯å¦å¢å¤§æ¥å†³å®šæ˜¯å¦åˆå¹¶subword pair.</p><h2><span id="unigram">Unigram</span><a href="#unigram" class="header-anchor"></a></h2><p>Unigram ä¸ ä¸Šè¿°çš„æ–¹æ³•éƒ½ç•¥æœ‰ä¸åŒï¼šUnigram ä¸å†æ˜¯é€šè¿‡åˆå¹¶base vocabulary ä¸­çš„subword æ¥æ–°å¢ï¼Œä»–é€‰æ‹©åœ¨åˆå§‹åŒ–æ—¶åˆå§‹åŒ–ä¸€ä¸ªéå¸¸å¤§çš„subword setï¼Œé€šè¿‡è®¡ç®—æ˜¯å¦éœ€è¦å°†ä¸€ä¸ªsubword åˆ‡åˆ†ä¸ºå¤šä¸ªbase subword ï¼ˆremove è¿™ä¸ªsubwordï¼‰æ¥å‡å°vocabulary size ç›´åˆ°è¾¾åˆ°vocab sizeã€‚<br>è¿™é‡Œæœ‰ä¸€ä¸ªå‡è®¾ï¼šå¥å­ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œsubword ä¸ subword ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚å¯¹åº”çš„å¥å­çš„è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼å°±æ˜¯å…¶subword çš„æ¦‚ç‡çš„ä¹˜ç§¯ã€‚ç›®æ ‡æ˜¯ä¿å­˜vocab size çš„åŒæ—¶è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼æœ€å¤§ã€‚<br>$$<br>x^* = argmax_{x \in U}P(\overrightarrow{x})<br>$$<br>æ•´ä¸ªæ±‚è§£è¿‡ç¨‹æ˜¯ä¸€ä¸ªç®€å•çš„EM æˆ–è€…è¯´ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ï¼š<br>0.å»ºç«‹ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç§å­subword vocabularyï¼Œå¯ä»¥ç”¨å­—å…¸æ ‘æ„å»ºå¯ä»¥æ˜¯æ‰€æœ‰å­—ç¬¦çš„ç»„åˆï¼Œä¹Ÿå¯ä»¥ç”¨bpe æ„å»ºï¼›<br>1.ï¼ˆæœŸæœ›Eï¼‰ç»Ÿè®¡vocabulary ä¸­æ¯ä¸ªsubword çš„é¢‘ç‡ï¼Œè®¡ç®—å…¶å¯¹åº”æ¦‚ç‡å€¼ï¼›<br>2.ï¼ˆæœ€å¤§åŒ–Mï¼‰æ ¹æ®å…¶æ¦‚ç‡ï¼Œä½¿ç”¨ç»´ç‰¹æ¯”ç®—æ³•è¿”å›å…¶è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼æœ€å¤§åŒ–ä¸‹çš„æœ€ä½³åˆ†å‰²æ–¹æ¡ˆï¼›<br>3.è®¡ç®—æœ€ä½³åˆ†å‰²æ–¹æ¡ˆä¸‹æ¯ä¸ªæ–°å­è¯çš„lossï¼Œè¿™é‡Œçš„loss æ˜¯æŒ‡å°†å½“å‰subword ä»vocabulary ä¸­ç§»é™¤æ—¶ï¼Œå¯¹åº”çš„è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼ï¼Œå³<br>$$<br>L = âˆ’ \sum^Nlog (\sum_{xâˆˆS(x_i)}p(x))<br>$$<br>4.ä¸¢å¼ƒæ‰loss å‰x% å¯¹åº”çš„subwordï¼›<br>5.é‡å¤2-4é˜¶æ®µï¼Œç›´åˆ°vocabulary è¾¾åˆ°æŒ‡å®šçš„vocab sizeã€‚</p><h2><span id="sentencepiece">SentencePiece</span><a href="#sentencepiece" class="header-anchor"></a></h2><p>SentencePiece å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„tokenizer æ–¹æ³•ï¼Œä»–å…¶å®æ˜¯ä¸€ä¸ªå®ç°äº†BPE/Unigram tokenizer çš„ä¸€ä¸ªé›†åˆï¼Œä¸è¿‡ä»–æœ‰ä¸€äº›åˆ›æ–°çš„åœ°æ–¹ã€‚<br>ä¸Šè¿°æ–¹æ³•ä¸­æœ‰ä¸€äº›é—®é¢˜ï¼š<br>1.éƒ½æœ‰å­—ï¼Œå­è¯æˆ–è¯çš„æ¦‚å¿µï¼Œç„¶è€Œåœ¨å¾ˆå¤šè¯­è¨€ä¸­å¹¶æ²¡æœ‰è¿™æ ·çš„æ¦‚å¿µï¼›<br>2.éƒ½é»˜è®¤éœ€è¦è‡ªå·±è¿›è¡Œpre-tokenizeï¼Œå¦‚è‹±è¯­åˆ™åˆ©ç”¨â€œç©ºæ ¼â€ä½œä¸ºè¯çš„åˆ†å‰²ç¬¦ï¼Œä¸­æ–‡åˆ™ä¸€èˆ¬é€‰æ‹©jieba è¿›è¡Œpre-tokenizeï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸åŒçš„è¯­è¨€æœ‰è‡ªå·±çš„ä¸€å¥—åšæ³•ï¼Œä¸ç»Ÿä¸€ï¼›<br>3.token æ ¼å¼ä¸ç»Ÿä¸€ã€‚ä»¥è‹±æ–‡ä¸ºä¾‹ï¼Œè¡¨ç¤ºtoken æ—¶ä¼šæœ‰ ##xx, xx/s è¿™ç§ï¼Œè¡¨ç¤ºsubword æ˜¯å¦å‡ºç°åœ¨è¯çš„é¦–å°¾ï¼Œç„¶è€Œä¸­æ–‡ä¸­æ˜¯æ²¡æœ‰è¿™ç§æ¦‚å¿µçš„ï¼›<br>4.è§£ç å›°éš¾ï¼Œå¦‚BPEè§£ç æ—¶éœ€è¦è¿›è¡Œä¸€äº›æ ‡å‡†åŒ–ï¼Œæœ€å¸¸è§çš„æ˜¯å»é™¤æ ‡ç‚¹ç¬¦å·ã€‚è€Œæˆ‘ä»¬è§£ç åæ˜¯ [new] [york]ä¸¤ä¸ªtokenï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“åŸæ¥çš„è¯æ˜¯ newyork/new york/new-york ä¸­çš„å“ªä¸€ä¸ª.<br>SentencePiece çš„åšæ³•ï¼š<br><a href="https://github.com/google/sentencepiece" target="_blank" rel="noopener"><br>SentencePiece treats the input text just as a sequence of Unicode characters. Whitespace is also handled as a normal symbol. To handle the whitespace as a basic token explicitly, SentencePiece first escapes the whitespace with a meta symbol â€œâ–â€ (U+2581) as follows.</a></p><p>å³é¦–å…ˆå°†ç©ºæ ¼è½¬æ¢ä¸ºä¸€ä¸ªæ ‡å‡†çš„å­—ç¬¦â€â–â€,ç„¶åå°†text è½¬æ¢ä¸ºunicodeï¼Œå…¶å®è¿™é‡Œçš„unicode æ˜¯NFKC-based normalizationåçš„unicodeï¼Œè‡³äºunicode æ ‡å‡†åŒ–ï¼Œå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/weixin_43866211/article/details/98384017" target="_blank" rel="noopener">unicodeæ–‡æœ¬æ ‡å‡†åŒ–</a> ï¼Œè™½ç„¶é€šå¸¸æˆ‘ä»¬ä½¿ç”¨NFKC æ ‡å‡†åŒ–ï¼Œä½†sentencepiece å†…éƒ¨å››ç§æ–¹æ³•éƒ½å®ç°äº†ã€‚<br>é€šè¿‡ä¸Šè¿°çš„ç©ºæ ¼è½¬æ¢åŠ normalizeï¼Œæ‰€æœ‰çš„è¯­è¨€ç»è¿‡è½¬æ¢åå°±æœ‰ç»Ÿä¸€çš„æ ¼å¼äº†ï¼Œè¿™æ ·å¤šè¯­è¨€çš„é—®é¢˜å°±å½»åº•çš„ä¸token åˆ‡åˆ†è§£å¶äº†ï¼Œtokenizer å°±æœ‰äº†ä¸€ä¸ªå®Œå…¨ç«¯åˆ°ç«¯çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2><span id="train-from-scratch">train from scratch</span><a href="#train-from-scratch" class="header-anchor"></a></h2><p>è®­ç»ƒä¸€ä¸ªtokenizer model ä¸»è¦æœ‰ä¸¤ä¸ªä»“åº“å¯ä»¥å‚è€ƒï¼š <a href="https://github.com/huggingface/tokenizers" target="_blank" rel="noopener">huggingface/tokenizers</a>   å’Œ  <a href="https://github.com/google/sentencepiece" target="_blank" rel="noopener">google/sentencepiece</a>.<br>å…¶ä¸­tokenizers æ”¯æŒbpe/bytes bpe/unigram/wordpiece, sentencepiece æ”¯æŒbpe/unigram.ä¸¤è€…éƒ½æ”¯æŒå››ç§æ ‡æ³¨åŒ–æ–¹æ³•ã€‚<br>æ­¤å¤–ï¼Œtokenizers ä¸æ”¯æŒè‡ªå®šä¹‰çš„pre_tokenizerçš„ä¿å­˜ï¼Œå¦‚ä¸­æ–‡æ—¶æˆ‘ä»¬å¸¸ç”¨çš„jieba.lcut ï¼›bytes bpeä¸æ”¯æŒbig dataset çš„è®­ç»ƒï¼Œ1T  å†…å­˜è®­ç»ƒ100G æ–‡æœ¬ä¹Ÿä¼šå› å†…å­˜ä¸è¶³è¢«killedï¼Œï¼ˆä¸€ä¸ªåŠæ³•æ˜¯ç¼©å°è¯­æ–™è®­ç»ƒï¼Œå› ä¸ºæ²¡æœ‰oov çš„é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šå°è¯­æ–™ä¸‹è®­ç»ƒä¹Ÿèƒ½ç”¨ï¼‰ã€‚<br>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œé€šå¸¸ä¼šç»“åˆhuggingface/transformers ä¸€èµ·ä½¿ç”¨ï¼Œè¿™é‡Œä¹Ÿçœ‹äº†ä¸€ä¸‹transformers/tokenizers çš„å®ç°ã€‚åŸå§‹çš„GPT2 ä¸­çš„tokenizer æ˜¯æ²¡æœ‰åšnormalize çš„ï¼Œæ‰€ä»¥ transformersä¸­çš„GPT2Tokenizer ä¹Ÿæ˜¯æ²¡æœ‰åšnormalize çš„ï¼Œè€Œé€šå¸¸æˆ‘ä»¬è‡ªå·±è®­ç»ƒçš„bytes bpe æ˜¯ä¼šåŠ ä¸€ä¸ªnormalize çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¦‚æœæ˜¯é€šè¿‡huggingface/tokenizers è®­ç»ƒçš„tokenierï¼Œè¿ç§»åˆ°transformers æ—¶éœ€è¦æ³¨æ„normalize æ˜¯å¦å®ç°ã€‚</p><h1><span id="tui-jian">æ¨è</span><a href="#tui-jian" class="header-anchor"></a></h1><p>å½“ç›®æ ‡è¯­è¨€ä¸ºä¸­æ–‡æ—¶ï¼Œæ¨èä½¿ç”¨WordPiece + jieba çš„æ–¹æ¡ˆï¼›è€Œæ˜¯å¤šè¯­è¨€åœºæ™¯æ—¶ï¼Œæ¨èä½¿ç”¨SentencePieceBPE/SentencePieceUnigram.<br>æ— è®ºå“ªç§åˆå¹¶/åˆ‡åˆ† subword çš„ç­–ç•¥ï¼Œæˆ‘ä»¬çš„åˆè¡·æ˜¯:<br><code>å°½é‡ä¸åˆ‡åˆ†å¸¸ç”¨è¯ï¼Œè€Œæ˜¯å°†ä¸å¸¸ç”¨è¯åˆ‡åˆ†ä¸ºå¸¸ç”¨çš„å­è¯.</code><br>è€Œä¸­æ–‡ä¸­ï¼Œæœ‰æ˜ç¡®çš„å­—/è¯æ¦‚å¿µï¼Œå´æ²¡æœ‰å­è¯çš„æ¦‚å¿µï¼ˆå¦‚è‹±æ–‡ä¸­æœ‰â€appâ€, â€œ##leâ€, ä¸­æ–‡å´æ²¡æœ‰â€è‹¹â€ â€œ##æœâ€ï¼‰ï¼Œè€Œè½¬bytes åå¯¹å­è¯æ›´å‹å¥½ï¼Œæ­¤å¤–ï¼Œä¸­æ–‡é€šå¸¸éœ€è¦3ä¸ªbytesï¼ˆGBKï¼‰æˆ–è€…4ä¸ªbytesï¼ˆChinese-Japanese character setï¼‰ï¼Œå¯¹äºä¸€ä¸ªä¸­æ–‡çš„å­—ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦å¤§äº1ä¸ªtoken æ¥è¡¨ç¤ºï¼Œåè€Œä¼šå¢åŠ tokenize ååºåˆ—çš„é•¿åº¦ï¼Œå¯¹æ¨¡å‹çš„è®­ç»ƒä¸ä½¿ç”¨ä¸åˆ©ï¼›æ­¤å¤–ï¼Œä¸­æ–‡ä¸­ç©ºæ ¼ä¹Ÿæ²¡æœ‰åˆ‡åˆ†è¯/å¥å­ çš„è¯­ä¹‰ï¼Œä¿ç•™ç©ºæ ¼åè€Œä¼šç”±äºå„ç§ç©ºæ ¼çš„é”™è¯¯ä½¿ç”¨å¸¦æ¥é—®é¢˜ï¼Œæœ€ç»ˆçš„æ¨èæ–¹æ¡ˆå°±æ˜¯jieba +  Word Piece/SentencePieceUnigramã€‚<br>è€Œå¤šè¯­è¨€åœºæ™¯ä¸‹ï¼Œæ¨èä½¿ç”¨SentencePieceBPEï¼Œä»–æä¾›ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ–¹æ¡ˆï¼Œè€Œä¸éœ€è¦å†æ ¹æ®ä¸åŒè¯­è¨€è¿›è¡Œä¸åŒçš„pre-tokenize/subword æ ¼å¼ï¼Œæ­¤å¤–ï¼ŒSentencePiece éƒ½æ˜¯bytes ç²’åº¦çš„ï¼Œè¿™æ ·æ—¢èƒ½å¤§å¤§ç¼©å‡è¯è¡¨åˆèƒ½é¿å…unk çš„æƒ…å†µã€‚</p><h1><span id="bu-chong-yue-du">è¡¥å……é˜…è¯»</span><a href="#bu-chong-yue-du" class="header-anchor"></a></h1><p><a href="https://huggingface.co/docs/transformers/tokenizer_summary" target="_blank" rel="noopener">tokenizer summary-huggingface</a><br><a href="https://towardsdatascience.com/difference-between-nfd-nfc-nfkd-and-nfkc-explained-with-python-code-e2631f96ae6c" target="_blank" rel="noopener">Difference Between NFD, NFC, NFKD, and NFKC Explained with Python Code-medium</a><br><a href="https://zhuanlan.zhihu.com/p/86965595" target="_blank" rel="noopener">æ·±å…¥ç†è§£NLP Subwordç®—æ³•ï¼šBPEã€WordPieceã€ULM-çŸ¥ä¹</a><br><a href="https://everdark.github.io/k9/notebooks/ml/natural_language_understanding/subword_units/subword_units.nb.html#121_expectation-maximization" target="_blank" rel="noopener">natural_language_understanding/subword_units/subword_units-github.io</a></p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>æœ¬äººçœŸå®å†™ç…§ğŸ¶</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="BPE" scheme="https://xv44586.github.io/tags/BPE/"/>
    
      <category term="WordPiece" scheme="https://xv44586.github.io/tags/WordPiece/"/>
    
      <category term="Unigram" scheme="https://xv44586.github.io/tags/Unigram/"/>
    
  </entry>
  
  <entry>
    <title>è®­ç»ƒåŠ é€Ÿç¯‡ï¼ˆ3ï¼‰horovodä¹‹å¤šæœºå¤šå¡</title>
    <link href="https://xv44586.github.io/2022/07/06/horovod-multi-nodes/"/>
    <id>https://xv44586.github.io/2022/07/06/horovod-multi-nodes/</id>
    <published>2022-07-06T03:20:31.000Z</published>
    <updated>2022-07-07T09:35:59.557Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#horovod-duo-ji-duo-qia">horovod å¤šæœºå¤šå¡</a><ul><li><a href="#huan-jing-da-jian">ç¯å¢ƒæ­å»º</a></li><li><a href="#rdma">RDMA</a></li><li><a href="#qi-dong-xun-lian">å¯åŠ¨è®­ç»ƒ</a></li></ul></li><li><a href="#xing-neng-dui-bi">æ€§èƒ½å¯¹æ¯”</a></li><li><a href="#ref">ref</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><h1><span id="horovod-duo-ji-duo-qia">horovod å¤šæœºå¤šå¡</span><a href="#horovod-duo-ji-duo-qia" class="header-anchor"></a></h1><p><a href="https://xv44586.github.io/2022/05/25/horovod/">ä¸Šä¸€ç¯‡</a> ä¸­ä»‹ç»äº†å¦‚ä½•åœ¨å•æœºå¤šå¡ä¸‹ä½¿ç”¨horovod è¿›è¡Œè®­ç»ƒï¼Œæœ¬ç¯‡ä»‹ç»å¦‚ä½•åœ¨å¤šæœºå¤šå¡ä¸‹ä½¿ç”¨horovod è¿›è¡Œè®­ç»ƒã€‚<br>è¿™ç¯‡ä¸­çš„æµ‹è¯•GPU ä¸ºV100ï¼Œ ä¸Šç¯‡A100 ä¸­é‡åˆ°çš„ç¯å¢ƒé—®é¢˜åœ¨V100 ä¸­å…¨éƒ½æ²¡æœ‰äº†ï¼Œæ‰€ä»¥æ•´ä¸ªç¯å¢ƒçš„æ­å»ºå°±å¼‚å¸¸ç®€å•äº†ã€‚</p><h2><span id="huan-jing-da-jian">ç¯å¢ƒæ­å»º</span><a href="#huan-jing-da-jian" class="header-anchor"></a></h2><p>æ‹‰å–æœ€æ–°çš„ngc ä¸­çš„imageï¼ŒåŠ è½½é•œåƒå¹¶åœ¨container ä¸­é…ç½®äº’ç›¸å…å¯†ç™»é™†ï¼Œæ³¨æ„docker å¯åŠ¨æ—¶éœ€è¦åŠ å…¥<code>privileged</code>æƒé™ï¼Œä»¥ä¾¿dockerèƒ½å¤Ÿè®¿é—®RDMAç½‘å£<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --rm --gpus all --shm-size=32g --<span class="built_in">ulimit</span> memlock=-1 --<span class="built_in">ulimit</span> stack=67108864 --net=host --privileged -v /data:/data --name horovod tensorflow:22.06-tf1-py3</span><br></pre></td></tr></table></figure></p><p>å®¹å™¨å†…äº’ç›¸å…å¯†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸root ä½¿ç”¨ssh</span></span><br><span class="line">sed -i <span class="string">'s/#PermitRootLogin prohibit-password/PermitRootLogin yes/'</span> /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å®¹å™¨å†… ssh é»˜è®¤ç«¯å£ä¸º2222ï¼Œé˜²æ­¢ä¸ host æ‰€ä½¿ç”¨çš„22ç«¯å£å†²çª</span></span><br><span class="line">sed -i <span class="string">'s/#Port 22/Port 2222/'</span> /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ssh æœåŠ¡</span></span><br><span class="line">service ssh restart &amp;&amp; netstat -tulpn</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® root å¯†ç </span></span><br><span class="line">passwd root</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH Key</span></span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º ~/.ssh/configï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹åï¼Œä¿å­˜å¹¶é€€å‡ºï¼Œå®Œæˆ host alias é…ç½®ã€‚</span></span><br><span class="line"><span class="comment"># ï¼æ³¨æ„ï¼š</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯CVMæœºå‹ï¼Œåˆ™ipæ˜¯ä¸¤å°æœºå™¨`ifconfig eth0`æ˜¾ç¤ºçš„ip</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯é»‘çŸ³RDMAæœºå‹ï¼Œåˆ™ipæ˜¯ä¸¤å°æœºå™¨`ifconfig bond0`æ˜¾ç¤ºçš„ip</span></span><br><span class="line">Host gpu1</span><br><span class="line"> hostname 172.0.0.1</span><br><span class="line"> port 2222</span><br><span class="line">Host gpu2</span><br><span class="line"> hostname 172.0.0.2</span><br><span class="line"> port 2222</span><br></pre></td></tr></table></figure></p><h2><span id="rdma">RDMA</span><a href="#rdma" class="header-anchor"></a></h2><p>ä¸Šé¢æåˆ°äº†RDMAï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨æ•°æ®ä¸­å¿ƒé¢†åŸŸï¼Œè¿œç¨‹ç›´æ¥å†…å­˜è®¿é—®ï¼ˆè‹±è¯­ï¼šremote direct memory accessï¼ŒRDMAï¼‰æ˜¯ä¸€ç§ç»•è¿‡è¿œç¨‹ä¸»æœºæ“ä½œç³»ç»Ÿå†…æ ¸è®¿é—®å…¶å†…å­˜ä¸­æ•°æ®çš„æŠ€æœ¯ï¼Œç”±äºä¸ç»è¿‡æ“ä½œç³»ç»Ÿï¼Œä¸ä»…èŠ‚çœäº†å¤§é‡CPUèµ„æºï¼ŒåŒæ ·ä¹Ÿæé«˜äº†ç³»ç»Ÿååé‡ã€é™ä½äº†ç³»ç»Ÿçš„ç½‘ç»œé€šä¿¡å»¶è¿Ÿï¼Œå°¤å…¶é€‚åˆåœ¨å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—æœºé›†ç¾¤ä¸­æœ‰å¹¿æ³›åº”ç”¨ã€‚</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µè¯å¼•è‡ªwikiï¼Œé€šè¿‡ä½¿ç”¨RDMAæŠ€æœ¯ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨çš„NCCL è¿›è¡Œé€šä¿¡ï¼ŒNCCL æ˜¯æ”¯æŒRDMAçš„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ngc ä¸­æ˜¯åŒ…å«äº†RDMA é©±åŠ¨çš„ï¼Œå¦‚æœimage å†…æœªå®‰è£…ï¼Œå‚è€ƒ<a href="https://cloud.tencent.com/document/product/1573/74101" target="_blank" rel="noopener">å®¹å™¨å®‰è£…ç”¨æˆ·æ€ RDMA é©±åŠ¨</a></p><h2><span id="qi-dong-xun-lian">å¯åŠ¨è®­ç»ƒ</span><a href="#qi-dong-xun-lian" class="header-anchor"></a></h2><p>å¯åŠ¨è®­ç»ƒæ—¶ï¼Œéœ€è¦æ ¹æ®èŠ‚ç‚¹ä¿¡æ¯å’Œé€šä¿¡æ–¹æ¡ˆè°ƒæ•´å‚æ•°ï¼Œå¦‚åœ¨æ”¯æŒRDMA ä¸‹çš„å¯åŠ¨å‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpirun -np 16 -H gpu1:8,gpu2:8 --allow-run-as-root -<span class="built_in">bind</span>-to none -map-by slot -x NCCL_DEBUG=INFO -x NCCL_IB_DISABLE=0 -x NCCL_SOCKET_IFNAME=bond0 -x NCCL_IB_GID_INDEX=3 -x NCCL_NET_GDR_LEVEL=0 -x LD_LIBRARY_PATH -x PATH -mca pml ob1 -mca btl_tcp_if_include bond0 -mca btl ^openib python3 train.py</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ ï¼š<br><code>-H</code> åé¢æŒ‡å®šèŠ‚ç‚¹åŠæ˜¾å¡æ•°ï¼›<br><code>-np</code> éœ€è¦æ ¹æ® <code>-H</code> è°ƒæ•´ä¸ºå…¶æ€»è®¡worker æ•°é‡ï¼›<br><code>btl_tcp_if_include</code> RDMA ä¸‹ä¸ºbond0ï¼Œæ™®é€šç½‘ç»œåˆ™ä¸ºeth0ï¼›<br><code>NCCL_SOCKET_IFNAME</code> ä¸ºç½‘ç»œæ¥å£ï¼ŒRDMA ä¸‹ä¸ºbond0ï¼Œæ™®é€šç½‘ç»œåˆ™éœ€åˆ‡æ¢ä¸º eth0<br><code>NCCL_NET_GDR_LEVEL</code> ä¸ºGDR ç›¸å…³ï¼ŒGDRçš„æ¦‚å¿µæ˜¯è¿è¡ŒGPU ä¸RDMA ç›´æ¥é€šä¿¡ï¼Œå¼€å¯åè¿›ä¸€æ­¥é™ä½é€šä¿¡å»¶è¿Ÿã€‚ä¸è¿‡GDRéœ€è¦é…åˆRDMA ä¸€èµ·ä½¿ç”¨ï¼›</p><p>NCCL ç›¸å…³å˜é‡å«ä¹‰å¯ä»¥å‚è€ƒ<a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html" target="_blank" rel="noopener">Environment Variables</a></p><h1><span id="xing-neng-dui-bi">æ€§èƒ½å¯¹æ¯”</span><a href="#xing-neng-dui-bi" class="header-anchor"></a></h1><p>åœ¨bert-base è§„æ¨¡çš„æ¨¡å‹ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œå…¶ç»“æœå¦‚ä¸‹ï¼š<br>|  GPU | batch size per GPU |   net  |  node           | speed<br>| â€”â€”â€”â€”- |:â€”â€”â€”â€”-:|:â€”â€”â€”â€”-:|:â€”â€”â€”â€”-:|:â€”â€”â€”â€”-:|<br>| A100-40g    | 16 | vpc | single | 430 me/step |<br>| V100        | 8  | vpc | single | 485 ms/step |<br>| V100        | 8  | vpc | multi  | 617 ms/step |<br>| V100        | 8  | rdma | single | 485 ms/step |<br>| V100        | 8  | rdma | multi | 510 ms/step |</p><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡RDMA è¿›ä¸€æ­¥é™ä½ç½‘ç»œå»¶è¿Ÿåï¼Œå¤šæœºå¤šå¡çš„åŠ é€Ÿæ•ˆæœæ¥è¿‘çº¿æ€§åŠ é€Ÿäº†ã€‚å¦‚æœå¼€å¯GDR ç½‘ç»œå»¶è¿Ÿèƒ½è¿›ä¸€æ­¥é™ä½ï¼ŒåŠ é€Ÿæ•ˆæœåº”è¯¥ä¼šæ›´è§£å†³çº¿æ€§åŠ é€Ÿã€‚</p><h1><span id="ref">ref</span><a href="#ref" class="header-anchor"></a></h1><p><a href="https://zhuanlan.zhihu.com/p/55142557" target="_blank" rel="noopener">RDMAæŠ€æœ¯è¯¦è§£ï¼ˆä¸€ï¼‰ï¼šRDMAæ¦‚è¿°</a></p><p><a href="https://zh.m.wikipedia.org/zh-hans/%E8%BF%9C%E7%A8%8B%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE" target="_blank" rel="noopener">è¿œç¨‹ç›´æ¥å†…å­˜è®¿é—®</a></p><p><a href="https://cloud.tencent.com/document/product/1573/74100" target="_blank" rel="noopener">é…ç½®å®¹å™¨ SSH å…å¯†è®¿é—®</a></p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>å¯çˆ±å°çŒ«</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="speed-up" scheme="https://xv44586.github.io/tags/speed-up/"/>
    
      <category term="horovod" scheme="https://xv44586.github.io/tags/horovod/"/>
    
  </entry>
  
  <entry>
    <title>nohupè¸©å‘è®°</title>
    <link href="https://xv44586.github.io/2022/07/05/nohup-debug/"/>
    <id>https://xv44586.github.io/2022/07/05/nohup-debug/</id>
    <published>2022-07-05T02:07:22.000Z</published>
    <updated>2022-07-07T03:38:46.580Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#bei-jing">èƒŒæ™¯</a></li><li><a href="#nohup">nohup</a></li><li><a href="#ti-dai">æ›¿ä»£</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><h1><span id="bei-jing">èƒŒæ™¯</span><a href="#bei-jing" class="header-anchor"></a></h1><p>æœ€è¿‘åœ¨æµ‹è¯•<a href="https://xv44586.github.io/2022/05/25/horovod/">horovod</a>ä¸‹çš„å•æœºå¤šå¡/å¤šæœºå¤šå¡çš„æ€§èƒ½ï¼Œç»“æœé‡åˆ°ä¸€ä¸ªç¥å¥‡çš„ç°è±¡ï¼šè®­ç»ƒæ€»æ˜¯ä¼šåœ¨ä¸€æ®µæ—¶é—´åæ„å¤–åœæ­¢ï¼Œåœæ­¢åä»ç³»ç»Ÿåˆ°ç¨‹åºï¼Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯æ—¥å¿—ã€‚è€Œè®­ç»ƒåœæ­¢è¿™ä¸ªç°è±¡æ€»æ˜¯èƒ½å¤ç°ï¼Œä½†æ˜¯å¤ç°æ—¶åˆä¸å®Œå…¨ä¸€æ ·ï¼Œå³åŒæ ·çš„è®­ç»ƒè„šæœ¬ï¼Œå…¶æ¯æ¬¡è®­ç»ƒæ„å¤–åœæ­¢æ—¶å®Œæˆçš„æ›´æ–°æ¬¡æ•°è¿˜ä¸ä¸€æ ·ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸ªç¥å¥‡çš„bugï¼Œæˆ‘ä»¬å°è¯•ä»ç‰©ç†æœºã€ç³»ç»Ÿèµ„æºã€é©±åŠ¨ã€è½¯ä»¶ç¯å¢ƒã€è®­ç»ƒè„šæœ¬ã€è®­ç»ƒæ•°æ®ç­‰å¤šä¸ªç¯èŠ‚è¿›è¡Œæ£€æŸ¥ï¼Œå‡æœªå‘ç°ä»»ä½•é—®é¢˜ï¼Œæœ€ç»ˆæ— æ„é—´å‘ç°ä½¿ç”¨xshell ï¼ˆä¹‹å‰ä½¿ç”¨çš„WSL2)åè®­ç»ƒåœæ­¢çš„ç°è±¡ä¸åœ¨å‘ç”Ÿã€‚æœ€ç»ˆå‘ç°ç«Ÿç„¶æ˜¯å› ä¸ºå¯¹nohup çš„å‘ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><h1><span id="nohup">nohup</span><a href="#nohup" class="header-anchor"></a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup is a POSIX command which means &quot;no hang up&quot;. Its purpose is to execute a command such that it ignores the HUP (hangup) signal and therefore does not stop when the user logs out.</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µæ˜¯å¼•è‡ª<a href="https://en.wikipedia.org/wiki/Nohup#Overcoming_hanging" target="_blank" rel="noopener">wikipedia</a>ï¼Œå³nohup çš„ä½œç”¨æ˜¯å¿½ç•¥HUP ä¿¡å·ï¼Œä»è€Œè®©ç”¨æˆ·log out æ—¶ï¼Œç¨‹åºä¾ç„¶ä¿æŒæ‰§è¡Œè€Œä¸ä¸­æ–­ã€‚</p><p>ç„¶è€Œæœ‰äº›åœºæ™¯ä¸‹ï¼Œnohup ä¾ç„¶ä¼šå¤±æ•ˆï¼Œå³ä½¿ç”¨äº†nohup åç¨‹åºä¾ç„¶å¯èƒ½è¢«ä¸­æ–­ï¼Œå¦‚<a href="https://unix.stackexchange.com/questions/420594/why-process-killed-with-nohup" target="_blank" rel="noopener">hy-process-killed-with-nohup</a>æåˆ°çš„ä¸¤ä¸ªåœºæ™¯ï¼Œæ­¤å¤–ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨nohup çš„åœºæ™¯æ—¶ssh ä¸‹ï¼Œè€Œssh ä¸ºäº†é¿å…ä¸¢å¤±æ•°æ®ï¼Œä¼šæ‹’ç»log outã€‚ å‚è€ƒwikiä¸­æåˆ°çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Note that nohupping backgrounded jobs is typically used to avoid terminating them when logging off from a remote SSH session. A different issue that often arises in this situation is that ssh is refusing to log off (&quot;hangs&quot;), since it refuses to lose any data from/to the background job(s).[6][7] This problem can also be overcome by redirecting all three I/O streams:</span><br><span class="line"></span><br><span class="line">$ nohup ./myprogram &gt; foo.out 2&gt; foo.err &lt; /dev/null &amp;</span><br></pre></td></tr></table></figure></p><p>æˆ‘çš„è®­ç»ƒè„šæœ¬ä½¿ç”¨æ—¶ï¼Œå¯¹stdout/stderr è¿›è¡Œäº†é‡å®šå‘ï¼Œæœªå¯¹stdin è¿›è¡Œé‡å®šå‘ï¼Œå³ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./myprogram &gt; foo.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆå¯¼è‡´è®­ç»ƒåœ¨è¿›è¡Œä¸€æ®µæ—¶é—´åæ„å¤–ä¸­æ–­è€Œæ²¡æœ‰ä»»ä½•å¼‚å¸¸ä¿¡æ¯ã€‚è€Œè¿™ä¸ªåƒå¹½çµä¸€æ ·æ— å£°æ— æ¯çš„â€œå°é—®é¢˜â€è®©æˆ‘ä»¬èŠ±äº†æ¥è¿‘ä¸‰å‘¨æ—¶é—´debugï¼Œæœ€ç»ˆåœ¨çŒœæµ‹ä¸­å®šä½åˆ°nohup ã€‚</p><h1><span id="ti-dai">æ›¿ä»£</span><a href="#ti-dai" class="header-anchor"></a></h1><p>ç”±ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œnohup å¹¶ä¸æ˜¯ä¸€ä¸ªâ€å¥½â€ çš„åå°æ‰§è¡Œè§£å†³æ–¹æ¡ˆï¼Œè€Œå¯¹åº”çš„æ›¿ä»£å“ï¼Œæ¨èä½¿ç”¨<a href="https://github.com/tmux/tmux/wiki" target="_blank" rel="noopener">tmux</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux is a terminal multiplexer. It lets you switch easily between several programs in one terminal, detach them (they keep running in the background) and reattach them to a different terminal.</span><br></pre></td></tr></table></figure></p><p>tmuxç¨³å®šå¯é ï¼Œåˆ©ç”¨tmuxï¼Œå°†session ä¸ terminal è¿›è¡Œdetachï¼Œä»è€Œè®©ç¨‹åºåœ¨åå°æ‰§è¡Œã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>æ·±åº¦debug</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Programming" scheme="https://xv44586.github.io/categories/Programming/"/>
    
    
      <category term="horovod" scheme="https://xv44586.github.io/tags/horovod/"/>
    
      <category term="nohup" scheme="https://xv44586.github.io/tags/nohup/"/>
    
      <category term="debug" scheme="https://xv44586.github.io/tags/debug/"/>
    
  </entry>
  
  <entry>
    <title>è®­ç»ƒåŠ é€Ÿç¯‡ï¼ˆ2ï¼‰-horovod</title>
    <link href="https://xv44586.github.io/2022/05/25/horovod/"/>
    <id>https://xv44586.github.io/2022/05/25/horovod/</id>
    <published>2022-05-25T02:29:28.000Z</published>
    <updated>2022-06-02T08:53:13.497Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#horovod">horovod</a></li><li><a href="#da-huan-jing">æ­ç¯å¢ƒ</a><ul><li><a href="#docker">docker</a></li></ul></li><li><a href="#local">local</a><ul><li><a href="#nccl">NCCL</a><ul><li><a href="#yan-zheng-yi-xia">éªŒè¯ä¸€ä¸‹</a></li></ul></li><li><a href="#mpirun">mpirun</a></li><li><a href="#nvidia-tensorflow">nvidia-tensorflow</a></li><li><a href="#horovod-1">horovod</a></li></ul></li><li><a href="#huan-jing-zhong-cai-guo-de-keng">ç¯å¢ƒä¸­è¸©è¿‡çš„å‘</a><ul><li><a href="#nccl">nccl</a></li><li><a href="#horovod-2">horovod</a></li></ul></li><li><a href="#dai-ma-ceng-mian-xiu-gai">ä»£ç å±‚é¢ä¿®æ”¹</a></li><li><a href="#run-code">run code</a></li><li><a href="#jia-su-xiao-guo">åŠ é€Ÿæ•ˆæœ</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><h1><span id="horovod">horovod</span><a href="#horovod" class="header-anchor"></a></h1><p><a href="https://github.com/horovod/horovod" target="_blank" rel="noopener">horovod</a>æ˜¯Uber å›¢é˜Ÿå¼€å‘çš„åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶ï¼Œä»–å¯ä»¥æ»¡è¶³è®©ä½ å°½é‡å°‘çš„ä¿®æ”¹ä»£ç å³å¯å°†åœ¨å•å¡è®­ç»ƒçš„è„šæœ¬æ¨ªè¡Œæ‰©å±•ä¸ºå¤šå¡å¹¶è¡Œè®­ç»ƒï¼ŒåŒæ—¶åˆå…¼é¡¾è®­ç»ƒçš„åŠ é€Ÿã€‚ç›®å‰æ”¯æŒtensorflow/keras/pytorch/mxnet.åº•å±‚é€šä¿¡ä¸»è¦ä¾èµ–<a href="https://github.com/NVIDIA/nccl" target="_blank" rel="noopener">NCCL</a>/<a href="https://github.com/facebookincubator/gloo" target="_blank" rel="noopener">Gloo</a>ï¼ˆæµ‹è¯•åNCCLæ˜¯æœ€å¿«çš„ï¼‰,æ”¯æŒMPIï¼ˆCPU è®­ç»ƒæ›´å¿«ï¼‰ã€‚ç”±äºå…¶è®­ç»ƒåŠ é€Ÿæ•ˆæœæ¯”tensorflow åŸç”Ÿçš„distributedStrategy å¿«å¾ˆå¤šï¼Œæ‰€ä»¥åœ¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶ï¼Œæ¨èä½¿ç”¨ã€‚<br>ä¸‹é¢ä¸»è¦é’ˆå¯¹tensorflow1.x ä¸‹åšåˆ†å¸ƒå¼è®­ç»ƒè¿›è¡Œè¯´æ˜ã€‚</p><h1><span id="da-huan-jing">æ­ç¯å¢ƒ</span><a href="#da-huan-jing" class="header-anchor"></a></h1><p>ç¯å¢ƒä¸»è¦ä¾èµ–tensorflow1.x/horovod/nccl/mpi ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼æ­ç¯å¢ƒï¼šlocal/dockerï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§ç¯å¢ƒçš„æ­å»ºåŠè¸©è¿‡çš„å‘ã€‚</p><h2><span id="docker">docker</span><a href="#docker" class="header-anchor"></a></h2><p>ç”±äºè°·æ­Œå®˜æ–¹çš„tensorflow1.x ä¸æä¾›å¯¹A100/3090 åŠæ›´æ–°ç‰ˆæœ¬çš„æ˜¾å¡çš„æ”¯æŒï¼Œè¿™é‡Œæˆ‘ä»¬æ¨èä½¿ç”¨nvidia å®˜æ–¹ç»´æŠ¤çš„<a href="https://github.com/NVIDIA/tensorflow" target="_blank" rel="noopener">nvidia-tensorflow</a>ï¼Œå…¶æä¾›äº†å¯¹A100/3090 ç­‰æ˜¾å¡çš„æ”¯æŒã€‚æ”¯æŒpip/condaå®‰è£…ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å¯¹åº”çš„docker é•œåƒã€‚<br>åœ¨ä½¿ç”¨é•œåƒæ—¶ï¼Œé¦–å…ˆåœ¨<a href="https://catalog.ngc.nvidia.com/orgs/nvidia/containers/tensorflow/tags" target="_blank" rel="noopener">ngc</a> ä¸­å¯»æ‰¾æœ€æ–°é•œåƒå¹¶pull ä¸‹æ¥ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nvcr.io/nvidia/tensorflow:22.04-tf1-py3</span><br></pre></td></tr></table></figure></p><p>åœ¨å¯åŠ¨æ—¶ï¼Œå»ºè®®è®¾ç½®share memory ä¸ºå•å¼ æ˜¾å¡æ˜¾å­˜å·®ä¸å¤šå¤§å°ï¼Œå¦åˆ™æœ‰å¯èƒ½ç”±äºé»˜è®¤share memory size å¤ªå°ï¼ˆ64Mï¼‰å¯¼è‡´nccl é€šä¿¡æ—¶èµ„æºä¸è¶³è¢«killã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --gpus all --net=host --privileged -v /data:/data --name horovod --shm-size=32g --<span class="built_in">ulimit</span> memlock=-1 --<span class="built_in">ulimit</span> stack=67108864 nvcr.io/nvidia/tensorflow:22.04-tf1-py3</span><br></pre></td></tr></table></figure><h1><span id="local">local</span><a href="#local" class="header-anchor"></a></h1><p>åœ¨æœ¬åœ°æ­ç¯å¢ƒï¼Œä¸»è¦éœ€è¦å®‰è£…nvidia-tensorflow/horovod/nccl/mpi,æ­¤å¤–ï¼Œç”±äºnvidia-tensorflow åªæ”¯æŒubuntu20.04ï¼Œå¯¹åº”çš„OS ä¹Ÿè¦è°ƒæ•´ã€‚</p><h2><span id="nccl">NCCL</span><a href="#nccl" class="header-anchor"></a></h2><p>å®‰è£…NCCLï¼Œæ³¨æ„ç‰ˆæœ¬ï¼Œä¸ºäº†å…¼é¡¾A100ï¼Œæ¨èä½¿ç”¨v2.8.3-1 è¿™ä¸ªç‰ˆæœ¬ã€‚<br>ref:<a href="https://github.com/NVIDIA/nccl" target="_blank" rel="noopener">nccl</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘nccl</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/NVIDIA/nccl.git</span><br><span class="line"><span class="built_in">cd</span> nccl &amp;&amp; git checkout v2.8.3-1</span><br><span class="line">make -j src.build</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœç¬¬ä¸€æ¬¡å®‰è£…ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹ä¾èµ–</span></span><br><span class="line"><span class="comment"># Install tools to create debian packages</span></span><br><span class="line">sudo apt install build-essential devscripts debhelper fakeroot</span><br><span class="line"><span class="comment"># Build NCCL deb package</span></span><br><span class="line">make pkg.debian.build</span><br><span class="line">ls build/pkg/deb/</span><br><span class="line"></span><br><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></p><h3><span id="yan-zheng-yi-xia">éªŒè¯ä¸€ä¸‹</span><a href="#yan-zheng-yi-xia" class="header-anchor"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¡®è®¤horovodé“¾æ¥çš„ncclç‰ˆæœ¬è·¯å¾„æ­£ç¡®</span></span><br><span class="line">ldd /usr/<span class="built_in">local</span>/lib/python3.8/dist-packages/horovod/tensorflow/mpi_lib.cpython-38-x86_64-linux-gnu.so</span><br></pre></td></tr></table></figure><h2><span id="mpirun">mpirun</span><a href="#mpirun" class="header-anchor"></a></h2><p>è¿™é‡Œæˆ‘ä»¬å®‰è£…<a href="https://www.open-mpi.org/" target="_blank" rel="noopener">open-mpi</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">apt-get install libnuma-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># mpirun</span></span><br><span class="line">wget https://download.open-mpi.org/release/open-mpi/v4.0/openmpi-4.0.5.tar.gz &amp;&amp; tar xvf openmpi-4.0.5.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openmpi-4.0.5/ &amp;&amp; ./configure --prefix=/usr/<span class="built_in">local</span>/openmpi</span><br><span class="line">make -j$(nproc) &amp;&amp; sudo make install</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=/usr/local/openmpi/bin:$PATH'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export LD_LIBRARY_PATH=/usr/local/openmpi/lib:$LD_LIBRARY_PATH'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">mpirun --version</span><br></pre></td></tr></table></figure><h2><span id="nvidia-tensorflow">nvidia-tensorflow</span><a href="#nvidia-tensorflow" class="header-anchor"></a></h2><p>è¿™é‡Œç›´æ¥ç”¨pip å®‰è£…æˆ–conda å®‰è£…éƒ½è¡Œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install nvidia-pyindex</span><br><span class="line">pip install nvidia-tensorflow</span><br></pre></td></tr></table></figure></p><h2><span id="horovod">horovod</span><a href="#horovod" class="header-anchor"></a></h2><p>horovod åœ¨å®‰è£…æ—¶ï¼Œéœ€è¦å®‰è£…æ”¯æŒNCCL ï¼ŒåŒæ—¶å»ºè®®å®‰è£…æœ€æ–°ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// å®‰è£…horovod</span><br><span class="line">pip show horovod &amp;&amp; pip uninstall horovod</span><br><span class="line">HOROVOD_WITH_MPI=1 HOROVOD_WITHOUT_GLOO=1 HOROVOD_GPU_OPERATIONS=NCCL HOROVOD_WITH_TENSORFLOW=1 HOROVOD_NCCL_LINK=SHARED pip3 install horovod==0.24.3 --no-cache-dir</span><br></pre></td></tr></table></figure><p>éªŒè¯ä¸€ä¸‹horovod ä½¿ç”¨äº†NCCL<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">horovodrun --check-build</span><br></pre></td></tr></table></figure></p><p>å¯¹åº”çš„NCCL å‰é¢å‹¾é€‰åˆ™æ”¯æŒNCCL<br><img src="/2022/05/25/horovod/horovod-nccl.png" alt="horovod-nccl"></p><h1><span id="huan-jing-zhong-cai-guo-de-keng">ç¯å¢ƒä¸­è¸©è¿‡çš„å‘</span><a href="#huan-jing-zhong-cai-guo-de-keng" class="header-anchor"></a></h1><p>å½“å‰åœ¨A100 çš„æœºå™¨ä¸Šè¿›è¡Œå®‰è£…æµ‹è¯•ï¼Œå…¶ä»–å‹å·æ˜¾å¡ä¸ä¸€å®šä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚</p><h2><span id="nccl">nccl</span><a href="#nccl" class="header-anchor"></a></h2><p>é’ˆå¯¹A100ï¼Œngc çš„é•œåƒä¸­ä¾ç„¶å­˜åœ¨ä¸€ä¸ªå‘ï¼Œå…¶å®‰è£…çš„nccl ç‰ˆæœ¬å¤ªé«˜ï¼Œå¯¼è‡´ä½¿ç”¨ä¸­ä¼šæŠ¥é”™ï¼Œå¯¹åº”çš„ä¿®å¤æ–¹å¼æ—¶å¯¹nccl è¿›è¡Œé™çº§ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ç¼–è¯‘nccl</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/NVIDIA/nccl.git</span><br><span class="line"><span class="built_in">cd</span> nccl &amp;&amp; git checkout v2.8.3-1</span><br><span class="line">make -j src.build</span><br><span class="line"></span><br><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h2><span id="horovod">horovod</span><a href="#horovod" class="header-anchor"></a></h2><p>nvcr.io/nvidia/tensorflow:22.04-tf1-py3 ä¸­çš„horovod ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ï¼Œåœ¨ä½¿ç”¨æ¢¯åº¦ç´¯è®¡æ—¶ï¼Œè€ç‰ˆæœ¬é‡Œ<a href="https://github.com/horovod/horovod/issues/2806" target="_blank" rel="noopener">æœ‰é—®é¢˜</a>ï¼Œå¯¹åº”çš„ä¿®å¤åœ¨æ–°ç‰ˆæœ¬çš„horovd ä¸­ã€‚æ‰€ä»¥ï¼Œä¸ç®¡æ˜¯å¦ä½¿ç”¨æ¢¯åº¦ç´¯è®¡ï¼Œéƒ½å»ºè®®å‡çº§ä¸€ä¸‹horovodã€‚PS: å‡çº§æ—¶å‚è€ƒä¸Šé¢å®‰è£…horovod çš„åŠæ³• ï¼Œæ³¨æ„å¯¹NCCL çš„æ”¯æŒã€‚</p><h1><span id="dai-ma-ceng-mian-xiu-gai">ä»£ç å±‚é¢ä¿®æ”¹</span><a href="#dai-ma-ceng-mian-xiu-gai" class="header-anchor"></a></h1><p>ä»£ç å±‚é¢éœ€è¦å¼•å…¥horvodï¼Œç„¶åå°†optimizer ç”¨horovod è¿›è¡Œwrapï¼Œæ­¤å¤–ï¼Œevaluate ç›¸å…³çš„å†…å®¹ï¼Œå°½é‡ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹å³å¯ã€‚<br>ç®€å•çš„demoï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment"># import horovod</span></span><br><span class="line"><span class="keyword">import</span> horovod.tensorflow.keras <span class="keyword">as</span> hvd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Horovod: initialize Horovod.</span></span><br><span class="line">hvd.init()</span><br><span class="line"><span class="comment"># Horovod: pin GPU to be used to process local rank (one GPU per process)</span></span><br><span class="line">config = tf.ConfigProto()</span><br><span class="line">config.gpu_options.allow_growth = <span class="literal">True</span></span><br><span class="line">config.gpu_options.visible_device_list = str(hvd.local_rank())</span><br><span class="line">K.set_session(tf.Session(config=config))</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment"># wrap optimizer</span></span><br><span class="line">optimizer = hvd.DistributedOptimizer(optimizer,</span><br><span class="line">                                    backward_passes_per_step=grad_accum_steps,</span><br><span class="line">                                    average_aggregated_gradients=<span class="literal">True</span>,</span><br><span class="line">                                    sparse_as_dense=<span class="literal">True</span>)</span><br><span class="line">                          </span><br><span class="line">...</span><br><span class="line"><span class="comment"># callback</span></span><br><span class="line">callbacks = [</span><br><span class="line">            <span class="comment"># Horovod: broadcast initial variable states from rank 0 to all other processes.</span></span><br><span class="line">            <span class="comment"># This is necessary to ensure consistent initialization of all workers when</span></span><br><span class="line">            <span class="comment"># training is started with random weights or restored from a checkpoint.</span></span><br><span class="line">            hvd.callbacks.BroadcastGlobalVariablesCallback(<span class="number">0</span>),</span><br><span class="line">            </span><br><span class="line">        ]</span><br><span class="line"><span class="comment"># evaluate only on worker 0 to prevent other workers from corrupting them.  </span></span><br><span class="line"><span class="keyword">if</span> hvd.rank() == <span class="number">0</span>:</span><br><span class="line">    callbacks.append(evaluator)</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>éƒ¨åˆ†é™åˆ¶ï¼š</p><ol><li>ç”±äºhorovod æ˜¯è®©ä½ åœ¨å•å¡çš„ä»£ç èƒ½å¤Ÿå¹³æ»‘çš„è¿ç§»åˆ°å¤šå¡ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œçš„batch size è®¾ç½®çš„æ˜¯é’ˆå¯¹å•å¡çš„ï¼Œä½†æ˜¯æ•´ä¸ªä¼˜åŒ–è¿‡ç¨‹æ˜¯åœ¨å¤šå¡çš„ç»“æœä¸Šè¿›è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦ä½ æ‰‹åŠ¨è°ƒæ•´è‡ªå·±çš„optimizer ä»¥é€‚åº”æœ€ç»ˆçš„batch size(batch_size_node * node_num)</li><li>éœ€è¦ä½¿ç”¨æ¢¯åº¦ç´¯è®¡ä»¥è¾¾åˆ°æ›´å¤§batch size çš„æ•ˆæœæ—¶ï¼Œéœ€è¦ä½¿ç”¨horovod æä¾›çš„æ–¹å¼ï¼Œå³ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optimizer = hvd.DistributedOptimizer(optimizer,</span><br><span class="line">                                    backward_passes_per_step=grad_accum_steps,  <span class="comment"># ç´¯è®¡æ­¥æ•°</span></span><br><span class="line">                                    average_aggregated_gradients=<span class="literal">True</span>,</span><br><span class="line">                                    sparse_as_dense=<span class="literal">True</span>                        <span class="comment"># ç´¯è®¡æ­¥æ•°å¤§äº1å¿…é¡»è®¾ä¸ºTrue</span></span><br><span class="line">                                    )</span><br></pre></td></tr></table></figure></li></ol><p>è€Œç›´æ¥ä½¿ç”¨bert4keras ä¸­çš„å®ç°æ–¹å¼ä¼šæŠ¥é”™ï¼Œå…·ä½“åŸå› æœªçŸ¥ã€‚</p><ol start="3"><li>callback ä¸­åªæ”¯æŒåŸç”Ÿçš„keras çš„æ“ä½œï¼Œå…¶ä»–è‡ªå®šä¹‰çš„æ“ä½œéƒ½ä¼šæŠ¥é”™ï¼Œå¦‚bert4keras ä¸­çš„ <code>Transformer.save_weights_as_checkpoint()</code> å°±ä¸æ”¯æŒã€‚</li></ol><h1><span id="run-code">run code</span><a href="#run-code" class="header-anchor"></a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mpirun -np 8 --allow-run-as-root -<span class="built_in">bind</span>-to none -map-by slot -x NCCL_DEBUG=INFO -mca btl_tcp_if_include eth0 -x LD_LIBRARY_PATH -x PATH python train_hvd.py</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ $-np$ åé¢çš„å‚æ•°æ˜¯æ˜¾å¡æ•°é‡ï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µè‡ªè¡Œè°ƒæ•´ã€‚</p><h1><span id="jia-su-xiao-guo">åŠ é€Ÿæ•ˆæœ</span><a href="#jia-su-xiao-guo" class="header-anchor"></a></h1><p>å¯¹ä¸åŒçš„OS ä¸åŒçš„ç¯å¢ƒè¿›è¡Œäº†è®­ç»ƒé€Ÿåº¦å¯¹æ¯”ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><table><thead><tr><th>local system</th><th style="text-align:center">run where</th><th style="text-align:center">distributed</th><th style="text-align:center">speed</th></tr></thead><tbody><tr><td>centos</td><td style="text-align:center">docker</td><td style="text-align:center">tf-mirroredStrategy</td><td style="text-align:center">520 ms/step</td></tr><tr><td>centos</td><td style="text-align:center">docker</td><td style="text-align:center">horovod-without-nccl</td><td style="text-align:center">440 ms/step</td></tr><tr><td>centos</td><td style="text-align:center">docker</td><td style="text-align:center">horovod-nccl</td><td style="text-align:center">285 ms/step</td></tr><tr><td>ubuntu20.04</td><td style="text-align:center">local</td><td style="text-align:center">tf-mirroredStrategy</td><td style="text-align:center">500 ms/step</td></tr><tr><td>ubuntu20.04</td><td style="text-align:center">local</td><td style="text-align:center">horovod nccl</td><td style="text-align:center">265 ms/step</td></tr><tr><td>ubuntu20.04</td><td style="text-align:center">docker</td><td style="text-align:center">tf-mirroredStrategy</td><td style="text-align:center">500 ms/step</td></tr><tr><td><code>ubuntu20.04</code></td><td style="text-align:center"><code>docker</code></td><td style="text-align:center"><code>horovod-nccl</code></td><td style="text-align:center"><code>240 ms/step</code></td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œç›¸å¯¹äºtf åŸç”Ÿçš„å•æœºå¤šå¡çš„MirroredStrategyï¼Œèƒ½æé€Ÿä¸€å€ä¹‹å¤šï¼ŒåŠ é€Ÿç›¸å½“æƒŠäººäº†ã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>å¯çˆ±çŒ«çŒ«</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="speed-up" scheme="https://xv44586.github.io/tags/speed-up/"/>
    
      <category term="horovod" scheme="https://xv44586.github.io/tags/horovod/"/>
    
  </entry>
  
  <entry>
    <title>faster-decoderä¹‹ decoderè§£ç åŠ é€Ÿ</title>
    <link href="https://xv44586.github.io/2022/05/23/faster-decoder/"/>
    <id>https://xv44586.github.io/2022/05/23/faster-decoder/</id>
    <published>2022-05-23T02:25:43.000Z</published>
    <updated>2022-05-23T10:35:28.847Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#1-bei-jing">1 èƒŒæ™¯</a></li><li><a href="#2-attention-cache">2 attention cache</a><ul><li><a href="#2-1-yuan-li">2.1 åŸç†</a></li><li><a href="#encoder-decoder-cross-attention">encoder-decoder cross-attention</a></li><li><a href="#self-attention">self-attention</a></li><li><a href="#2-2-shi-xian">2.2 å®ç°</a><ul><li><a href="#1-attention-ceng-xiu-gai">1. attention å±‚ä¿®æ”¹</a></li><li><a href="#2-attention-mask-de-jiu-zheng">2. attention mask çš„â€œçº æ­£â€</a></li><li><a href="#3-position-bias-de-jiu-zheng">3. position bias çš„â€œçº æ­£â€</a></li><li><a href="#4-jie-ma-shi-xian">4. è§£ç å®ç°</a></li></ul></li></ul></li><li><a href="#3-onnx">3 onnx</a></li><li><a href="#4-demo">4 demo</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><h1><span id="1-bei-jing">1 èƒŒæ™¯</span><a href="#1-bei-jing" class="header-anchor"></a></h1><p>Transformer æ¨¡å‹èˆå¼ƒäº† step by step çš„æ—¶åºå¾ªç¯ï¼Œä¾é  self-attention çš„å¹¶è¡Œç»“æ„è·å¾—äº†è¿œè¶…åŒé‡çº§ LSTM ç½‘ç»œçš„è®­ç»ƒé€Ÿåº¦ã€‚å³ä½¿åšauto-regresisve ä»»åŠ¡æ—¶ï¼Œé€šè¿‡attention-mask æœºåˆ¶ä¾ç„¶å¯ä»¥åƒencoder ä¸€æ ·å¹¶è¡Œè®¡ç®—ã€‚ç„¶è€Œåœ¨è§£ç æ—¶ï¼Œå´ä»»ç„¶éœ€è¦step by step çš„è¿›è¡Œï¼Œå³éœ€è¦çŸ¥é“ä¸Šä¸€ä¸ªtime step çš„ç»“æœåæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªtime step çš„è§£ç ã€‚æ­¤å¤–ï¼Œé€šå¸¸æˆ‘ä»¬çš„è§£ç ç­–ç•¥æ˜¯åœ¨è·å¾—æ¨¡å‹ç»“æœååœ¨å†…å­˜ä¸­è®¡ç®—çš„ï¼Œéœ€è¦ä¸åœçš„å°†ç»“æœä»GPU load è¿› CPU ç„¶åè®¡ç®—ï¼Œè¿™å°±è¿›ä¸€æ­¥çš„æ‹–æ…¢äº†è§£ç é€Ÿåº¦ã€‚è€Œé€šå¸¸æˆ‘ä»¬åœ¨éƒ¨ç½²æ—¶ï¼Œé¦–é€‰çš„tf-serving éœ€è¦å°†ç»“æœé€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œè¿™å°†è¿›ä¸€æ­¥çš„æ‹–æ…¢è§£ç é€Ÿåº¦ã€‚è€Œé’ˆå¯¹è§£ç æ…¢çš„é—®é¢˜ï¼Œä¸»è¦çš„åŠ é€Ÿæ–¹æ¡ˆæœ‰ï¼š</p><ol><li>å°†è§£ç ç­–ç•¥æ”¾åœ¨GPU ä¸Šè®¡ç®—ï¼Œè¿™æ ·å°†é¿å…ç»“æœåœ¨GPU/CPU ä¹‹é—´è½¬æ¢ä¸ç­‰å¾…ï¼›</li><li>attention cacheï¼Œæ ¹æ®attention å±‚çš„ç‰¹ç‚¹ï¼Œå¯¹attention ä¸­çš„ $K$ / $V$ è¿›è¡Œcacheï¼Œé¿å…å¯¹ä¹‹å‰çš„time step è¿›è¡Œé‡å¤è®¡ç®—ï¼Œå°†attention å±‚çš„è®¡ç®—ç”± $O(n^2)$  é™ä½åˆ° $O(n)$ã€‚</li><li>transformer è®¡ç®—æœ€è€—æ—¶çš„æ˜¯attention å±‚ä¸­çš„softmaxï¼Œå°è¯•ä½¿ç”¨ä¸€äº›çº¿æ€§å‡½æ•°è¿›è¡Œè¿‘ä¼¼æ›¿æ¢</li></ol><h1><span id="2-attention-cache">2 attention cache</span><a href="#2-attention-cache" class="header-anchor"></a></h1><p>ä¸‰ç§æ–¹æ¡ˆä¸­ï¼ŒGPU ä¸Šè¿›è¡Œè§£ç éœ€è¦ä¸€äº›åº•å±‚æŠ€æœ¯è¿›è¡Œå¼€å‘ï¼Œæš‚æ—¶æ²¡èƒ½åŠ›ï¼Œè€Œæ›¿æ¢softmax æ–¹æ¡ˆåˆ™ä¼šæˆ–å¤šæˆ–å°‘çš„æŸå¤±ä¸€äº›ç²¾åº¦ï¼Œæœ¬æ–‡éƒ½ä¸åšè¿›ä¸€æ­¥è®¨è®ºã€‚æœ¬æ–‡èšç„¦åœ¨attention cache æ–¹æ¡ˆä¸Šï¼ŒåŠ é€Ÿçš„åŒæ—¶åˆâ€œä¸ä¼šâ€æŸå¤±ç²¾åº¦ã€‚</p><h2><span id="2-1-yuan-li">2.1 åŸç†</span><a href="#2-1-yuan-li" class="header-anchor"></a></h2><p>attention çš„è®¡ç®—å…¬å¼ï¼š</p><p>$$<br>A = Softmax(QK^{T})* V<br>$$</p><p>åœ¨è§£ç æ—¶ï¼Œæˆ‘ä»¬æ˜¯step by step è¿›è¡Œçš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°†æ—¶åˆ» t çš„attention å†™å‡ºæ¥ï¼š</p><p>$$<br>A = Softmax(Q_{t}K^{T})* V<br>$$</p><p>å³ï¼šå¯¹äºæ—¶åˆ»t æ¥è¯´ï¼Œattention åªéœ€è¦å½“å‰çš„ $Q_{t}$ æ—¶åˆ»ä¿¡æ¯ï¼Œ$K$ / $V$ çš„æ‰€æœ‰æ—¶åˆ»ä¿¡æ¯è¿›è¡Œè®¡ç®—ã€‚è€Œ $Q_{t}$ çš„è®¡ç®—åªéœ€è¦ $Token_{t-t}$ å³å¯ï¼Œå¦‚ä½•åŠ é€Ÿè®¡ç®—çš„å…³é”®å°±å‰©ä¸‹å¦‚ä½•æ›´åŠ é«˜æ•ˆçš„è®¡ç®— $K$ / $V$.</p><h2><span id="encoder-decoder-cross-attention">encoder-decoder cross-attention</span><a href="#encoder-decoder-cross-attention" class="header-anchor"></a></h2><p>å¯¹äºencoder-decoder cross-attention æ¥è¯´ï¼Œå¯¹åº”çš„ $K$ / $V$ éƒ½æ¥è‡ªencoder çš„outputsï¼Œæ‰€ä»¥ç›´æ¥å°†å…¶æ•´ä¸ªè¿›è¡Œcache å³å¯ï¼Œè€Œæ— éœ€æ¯æ­¥éƒ½é‡æ–°è®¡ç®—ã€‚</p><h2><span id="self-attention">self-attention</span><a href="#self-attention" class="header-anchor"></a></h2><p>è€Œå½“attention æ˜¯self-attention æ—¶ï¼Œå¯¹äºæ—¶åˆ» $t$ æ¥è¯´ï¼Œæ­¤æ—¶çš„ $K$ / $V$ ä¸º $K$ / $V$ çš„å‰ $t$ æ—¶åˆ»ä¿¡æ¯ï¼Œå³ $K_{\leq t}$ / $V_{\leq t}$ .æ­¤æ—¶çš„ attention è®¡ç®—ä¸ºï¼š</p><p>$$<br>A = Softmax(Q_{t}K_{\leq t}^{T})* V_{\leq t}<br>$$</p><p>è€Œ $K_{t}$/$V_{t}$ çš„è®¡ç®—åªä¸ $Token_t$ æœ‰å…³ï¼Œä¸å…¶ä»–æ—¶åˆ»çš„ $Token$ æ— å…³ï¼Œä¸”ä¸è®ºæ˜¯æ—¶åˆ» $t$ è¿˜æ˜¯æ—¶åˆ» $t+1$,å¯¹åº”çš„ $K_{t-1}$ / $V_{t-1}$ çš„è®¡ç®—ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œæ¯ä¸ªæ—¶åˆ»éƒ½å¯¹ $K_{\leq t}$ / $V_{\leq t}$ å…¨éƒ¨è®¡ç®—æ˜¯ä½æ•ˆä¸”æµªè´¹çš„ã€‚</p><p>ç”±äº $K_t$ / $V_t$ æœ‰åªéœ€ $Token_t$ è®¡ç®—ä¸”ä¸åŒæ—¶åˆ»ç»“æœâ€œä¸€è‡´â€çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªæ—¶åˆ»çš„ $K_t$ / $V_t$ è¿›è¡Œcacheï¼Œåœ¨è¿›è¡Œattention è®¡ç®—æ—¶ä½¿ç”¨cache ä¸­çš„ $K_{\leq t}$ / $V_{\leq t}$<br>å³å¯ã€‚<br>æ­¤å¤–ï¼Œç”±äºä½¿ç”¨äº†attention cache åï¼Œæ¯æ¬¡è§£ç è¾“å…¥åªéœ€è¦ $Token_t$ è€Œé $Token_{\leq t}$ ï¼Œè¿™æ ·å°†å…¶ä»–å±‚çš„è®¡ç®—é‡ä¹Ÿä¼šéšä¹‹é™ä½ã€‚<br>PSï¼šç”±äºdecoder ä¸­ä¸ºäº†å®ç°auto-regressive è€Œé‡‡ç”¨äº†ä¸‹ä¸‰è§’çš„attention maskï¼Œå› æ­¤ï¼Œä¸åŒæ—¶åˆ»çš„attention mask æ˜¯ä¸åŒçš„ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒæ—¶åˆ»çš„ $K_t$ / $V_t$ çš„ç»“æœç•¥æœ‰ä¸åŒï¼ˆçº¦e-10)ï¼Œä½†æ˜¯è¿™å¹¶ä¸å½±å“æœ€ç»ˆç«¯åˆ°ç«¯çš„ç»“æœã€‚ </p><h2><span id="2-2-shi-xian">2.2 å®ç°</span><a href="#2-2-shi-xian" class="header-anchor"></a></h2><p>attention å±‚åœ¨å®ç°æ—¶ï¼Œé™¤äº†è¿›è¡Œattention è®¡ç®—çš„åŒæ—¶ï¼Œè¿˜ä¼šåŒ…å«attention mask å’Œ position bias ä¸¤ç§ä¿¡æ¯ï¼Œå…¶ä¸­ï¼Œattention mask æ¥å®ç°auto regressiveï¼Œå³å½“å‰ä½ç½®çš„attention åªèƒ½åŒ…å«å½“å‰ä½ç½®åŠä¹‹å‰çš„ä¿¡æ¯ï¼›position bias åˆ™åŒ…æ‹¬å„ç§position ä¿¡æ¯çš„å®ç°ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨attention cache åï¼Œè¿˜éœ€è¦å¯¹è¿™ä¸¤ç§ä¿¡æ¯è¿›è¡Œâ€œçº æ­£â€ã€‚</p><h3><span id="1-attention-ceng-xiu-gai">1. attention å±‚ä¿®æ”¹</span><a href="#1-attention-ceng-xiu-gai" class="header-anchor"></a></h3><p>å…·ä½“å®ç°æ—¶ï¼Œå¯¹äºencoder-decoder cross-attention, æˆ‘ä»¬ä¹‹é—´å°†encoder outputs è®¡ç®—ä¸€æ¬¡åè¿›è¡Œcacheï¼Œæ¯æ¬¡è¿›è¡Œè§£ç æ—¶ä½œä¸ºinputs é€äººdecoderï¼›</p><p>å¯¹äºself-attention ï¼Œæˆ‘ä»¬åœ¨å¾—åˆ° $Q_{t}$/$K_{t}$/$V_{t}$ åï¼Œå°† $K_t$/$V_t$ ä¸ä¹‹å‰çš„ $K_{\leq t-1}$/ $V_{\leq t-1}$ cache è¿›è¡Œæ‹¼æ¥ï¼Œæ„é€ å‡ºå®Œæ•´çš„$K_{\leq t}$ / $V_{\leq t}$, ç„¶åå°†$Q_t$ / $K_{\leq t}$ / $V_{\leq t}$ è¿›å…¥self-attention å±‚è¿›è¡Œè®¡ç®—ã€‚</p><h3><span id="2-attention-mask-de-jiu-zheng">2. attention mask çš„â€œçº æ­£â€</span><a href="#2-attention-mask-de-jiu-zheng" class="header-anchor"></a></h3><p>ç”±äºattention mask çš„ä½œç”¨æ˜¯é˜²æ­¢å½“å‰ä½ç½®çœ‹åˆ°å…¶åä½ç½®çš„ä¿¡æ¯ï¼Œè€Œåœ¨ä½¿ç”¨cache åï¼Œå½“å‰ä½ç½®å³æœ€åæ—¶åˆ»çš„ä½ç½®ï¼Œæ‰€ä»¥æ­¤æ—¶çš„attention mask å·²æ²¡æœ‰å­˜åœ¨çš„å¿…è¦ï¼Œç›´æ¥å–æ¶ˆå³å¯ï¼›PS: ç”±äºè¿™é‡Œç›´æ¥å–æ¶ˆäº†attention maskï¼Œè€Œattention mask çš„å®ç°é€šå¸¸æ˜¯é€šè¿‡åŠ ä¸Šä¸€ä¸ª è´Ÿæ— ç©·(-e12) æ¥å®ç°çš„ï¼Œæ‰€ä»¥åŠ äº†cache åçš„outputs ä¸æ²¡åŠ ä¹‹å‰ä¼šæœ‰ä¸€å®šçš„å·®å¼‚ï¼Œå¤§æ¦‚åœ¨e-10 é‡çº§ã€‚</p><h3><span id="3-position-bias-de-jiu-zheng">3. position bias çš„â€œçº æ­£â€</span><a href="#3-position-bias-de-jiu-zheng" class="header-anchor"></a></h3><p>ç”±äºposition bias é€šå¸¸æ˜¯é€šè¿‡inputs çš„é•¿åº¦è¿›è¡Œè®¡ç®—çš„ï¼Œè€ŒåŠ äº†attention cache åï¼Œæ¯æ¬¡çš„inputs çš„é•¿åº¦å˜ä¸º1 äº†ï¼ˆå½“å‰æ—¶åˆ»çš„$Token_t$ï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶çš„position bias æ’ç­‰äºé•¿åº¦ä¸º1 çš„åºåˆ—ã€‚ä¸ºäº†è¿˜åŸä»–åŸå§‹çš„position biasï¼Œæˆ‘ä»¬ä½¿ç”¨æ‹¼æ¥äº†cache åçš„$K_{\leq t}$ è¿›è¡Œè®¡ç®—å®Œæ•´åºåˆ—çš„position biasï¼Œ ç„¶åå–å‡ºå½“å‰query åœ¨å®Œæ•´åºåˆ—ä¸­ä½ç½®å¯¹åº”çš„position bias å³å¯ã€‚</p><h3><span id="4-jie-ma-shi-xian">4. è§£ç å®ç°</span><a href="#4-jie-ma-shi-xian" class="header-anchor"></a></h3><p>æ­¤å¤–ï¼Œåœ¨è§£ç å‡½æ•°ä¸Šï¼Œä¹Ÿéœ€è¦è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼Œä»¥è·å¾—å½“å‰æ—¶åˆ»çš„$K_t$/$V_t$ , ç„¶åä¸ä¹‹å‰æ—¶åˆ»çš„æ‰€æœ‰ $K_{\leq t-1}$ / $V_{\leq t-1}$ cache è¿›è¡Œæ‹¼æ¥ï¼Œä¸ºä¸‹ä¸€ä¸ªæ—¶åˆ»è®¡ç®—åšå‡†å¤‡ã€‚</p><h1><span id="3-onnx">3 onnx</span><a href="#3-onnx" class="header-anchor"></a></h1><p>ç”±äºtensorflow ä¼šå¯¹å½“å‰æ˜¾å¡çš„æ˜¾å­˜å…¨éƒ¨å ç”¨ï¼Œæ‰€ä»¥ä¸€ä¸ªæ˜¾å¡åªèƒ½å¯åŠ¨ä¸€ä¸ªtensorflow è¿›ç¨‹ï¼Œè¿™æ ·å°±å¯¼è‡´å½“ä¸€ä¸ªæ¨¡å‹çš„æ˜¾å­˜ä¸éœ€è¦å ç”¨æ‰€æœ‰æ˜¾å­˜å³å¯è§£ç æ—¶ï¼Œä½¿ç”¨tensorflow ä¼šæµªè´¹ä¸€éƒ¨åˆ†æ˜¾å­˜ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å…¶è½¬ä¸ºonnx ï¼Œè¿™æ ·åªéœ€è¦å ç”¨æ¨¡å‹éœ€è¦çš„æ˜¾å­˜å³å¯ï¼Œé¿å…æ˜¾å­˜æµªè´¹ã€‚å³ä¸€ä¸ªæ˜¾å¡å¯ä»¥èµ·å¤šä¸ªè§£ç è¿›ç¨‹ã€‚</p><h1><span id="4-demo">4 demo</span><a href="#4-demo" class="header-anchor"></a></h1><p>åœ¨bert4keras çš„åŸºç¡€ä¸Šï¼Œå¯¹ T5/Roformer è¿›è¡Œäº†å®ç°ï¼Œå…·ä½“ä»£ç å‚è€ƒï¼š<a href="https://github.com/xv44586/faster-decoder" target="_blank" rel="noopener">faster-decoder</a></p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>ç½‘ä¸Šæµä¼ çš„æŸä¸ªå¯è¾¾é¸­å½¢è±¡ğŸ˜„</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="faster decoder" scheme="https://xv44586.github.io/tags/faster-decoder/"/>
    
      <category term="T5" scheme="https://xv44586.github.io/tags/T5/"/>
    
      <category term="simbert" scheme="https://xv44586.github.io/tags/simbert/"/>
    
  </entry>
  
  <entry>
    <title>speed-up</title>
    <link href="https://xv44586.github.io/2021/08/14/speed-up/"/>
    <id>https://xv44586.github.io/2021/08/14/speed-up/</id>
    <published>2021-08-14T04:22:06.000Z</published>
    <updated>2022-05-31T07:58:03.723Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#xun-lian-jia-su">è®­ç»ƒåŠ é€Ÿ</a></li><li><a href="#hun-he-jing-du">æ··åˆç²¾åº¦</a><ul><li><a href="#dui-ying-de-ruan-ying-jian-yao-qiu">å¯¹åº”çš„è½¯ç¡¬ä»¶è¦æ±‚</a></li><li><a href="#ru-he-kai-qi">å¦‚ä½•å¼€å¯</a></li><li><a href="#yi-xie-ce-shi-jie-guo">ä¸€äº›æµ‹è¯•ç»“æœ</a></li></ul></li><li><a href="#tui-li-jia-su">æ¨ç†åŠ é€Ÿ</a><ul><li><a href="#ce-shi">æµ‹è¯•</a></li></ul></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>ä¹‹å‰æ–‡ç« ä¸­ä»‹ç»äº†é€šè¿‡æ¨¡å‹å‹ç¼©æ¥åŠ é€Ÿå…¶æ¨ç†é€Ÿåº¦çš„ä¸»è¦æ€è·¯ï¼Œå¹¶å°±çŸ¥è¯†è’¸é¦æ€»ç»“äº†ä¸‰ç¯‡å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ï¼š<a href="https://xv44586.github.io/2020/08/09/bert-of-theseus/">æ¨¡å‹æ›¿æ¢ä¹‹bert-of-theseus</a> ã€<a href="https://xv44586.github.io/2020/08/31/bert-01/">çŸ¥è¯†è¿ç§»</a> å’Œ <a href="https://xv44586.github.io/2020/09/25/fastbert/">çœ‹æ ·æœ¬ä¸‹èœçš„FastBERT</a>ã€‚æœ¬æ–‡æ€»ç»“ä¸¤ç§ä¸æ¨¡å‹æ— å…³çš„åŠ é€Ÿæ–¹æ¡ˆã€‚</p><h1><span id="xun-lian-jia-su">è®­ç»ƒåŠ é€Ÿ</span><a href="#xun-lian-jia-su" class="header-anchor"></a></h1><p>è®­ç»ƒåŠ é€Ÿçš„ä¸»è¦æ–¹æ³•åŒ…æ‹¬pipeline å’Œæ··åˆç²¾åº¦ï¼Œå…¶ä¸­pipelineæ˜¯æŒ‡é€šè¿‡æ„é€ ä¸€ä¸ªinput pipelineå°†æ•°æ®IOä¸GPUè®¡ç®—åˆ†å¼€ï¼Œä»è€Œé¿å…GPUå› IOè€Œç©ºé—²ï¼Œè¿™ä¸ªé—®é¢˜ä¸æ˜¯æœ¬ç¯‡é‡ç‚¹ï¼Œæƒ³è¿›ä¸€æ­¥äº†è§£çš„å¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/27238630?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=43831500210176" target="_blank" rel="noopener">tensorflowæ•°æ®è¯»å–æœºåˆ¶-ä½•ä¹‹æº</a>å’Œ<a href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/data/Dataset" target="_blank" rel="noopener">Doc-tf-data-dataset</a></p><h1><span id="hun-he-jing-du">æ··åˆç²¾åº¦</span><a href="#hun-he-jing-du" class="header-anchor"></a></h1><p>æ··åˆç²¾åº¦æ˜¯æŒ‡è®­ç»ƒæ—¶åœ¨æ¨¡å‹ä¸­åŒæ—¶ä½¿ç”¨ 16 ä½å’Œ32ä½æµ®ç‚¹ç±»å‹ï¼Œä»è€ŒåŠ å¿«è¿è¡Œé€Ÿåº¦ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨çš„ä¸€ç§è®­ç»ƒæ–¹æ³•ã€‚é€šè¿‡è®©æ¨¡å‹çš„æŸäº›éƒ¨åˆ†ä¿æŒä½¿ç”¨ 32 ä½ç±»å‹ä»¥ä¿æŒæ•°å€¼ç¨³å®šæ€§ï¼Œå¯ä»¥ç¼©çŸ­æ¨¡å‹çš„å•æ­¥ç”¨æ—¶ï¼Œè€Œåœ¨è¯„ä¼°æŒ‡æ ‡ï¼ˆå¦‚å‡†ç¡®ç‡ï¼‰æ–¹é¢ä»å¯ä»¥è·å¾—åŒç­‰çš„è®­ç»ƒæ•ˆæœã€‚ï¼ˆ<a href="https://tensorflow.google.cn/guide/mixed_precision?hl=zh-cn" target="_blank" rel="noopener">tf doc</a>)ç®€å•è¯´å°±æ˜¯å¼€å¯æ··åˆç²¾åº¦ï¼Œæ—¢èƒ½æ›´çœæ˜¾å­˜åˆèƒ½åŠ é€Ÿè®­ç»ƒï¼Œä¿è¯æ€§èƒ½çš„å‰æä¸‹ï¼Œå¶å°”è¿˜èƒ½æé«˜æ€§èƒ½ï¼ŒçœŸæ˜¯åˆçœåˆå¿«åˆå¥½ï¼Œäº†è§£æ›´å¤šæ··åˆç²¾åº¦ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/103685761" target="_blank" rel="noopener">æµ…è°ˆæ··åˆç²¾åº¦è®­ç»ƒ</a>.<br>ç„¶è€Œå¾ˆæ—©ä¹‹å‰ç¬”è€…å°±çŸ¥é“å¼€å¯æ··åˆç²¾åº¦çš„å¥½å¤„äº†ï¼Œåœ¨pytorch ä¸‹æœ‰<a href="https://github.com/NVIDIA/apex" target="_blank" rel="noopener">apex</a> å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¼€å¯ï¼Œä½†æ˜¯åœ¨kerasï¼ˆtensorflow 1.xï¼‰ ä¸‹å°è¯•äº†å¤šæ¬¡ï¼Œä¹Ÿæ²¡èƒ½æ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•ï¼Œæœ€è¿‘ç¬”è€…åˆä¸€æ¬¡å°è¯•ï¼Œç»ˆäºæ‰¾åˆ°äº†æ­£ç¡®çš„å§¿åŠ¿ï¼Œè¿™é‡Œä¹Ÿåˆ†äº«ä¸€ä¸‹ã€‚</p><h2><span id="dui-ying-de-ruan-ying-jian-yao-qiu">å¯¹åº”çš„è½¯ç¡¬ä»¶è¦æ±‚</span><a href="#dui-ying-de-ruan-ying-jian-yao-qiu" class="header-anchor"></a></h2><p>tensorflowè¦æ±‚ç‰ˆæœ¬åœ¨1.14+ ï¼Œå¯¹åº”çš„æ˜¾å¡éœ€è¦ç®—åŠ›ï¼ˆcompute capabilityï¼‰åœ¨7åŠä»¥ä¸Š, å¯ä»¥åœ¨<a href="https://developer.nvidia.com/cuda-gpus#compute" target="_blank" rel="noopener">cuda-gpus#compute</a>æŸ¥çœ‹å¯¹åº”å‹å·å¡çš„ç®—åŠ›</p><h2><span id="ru-he-kai-qi">å¦‚ä½•å¼€å¯</span><a href="#ru-he-kai-qi" class="header-anchor"></a></h2><p>å¯¹åº”ä»£ç ä¸­ï¼Œåªéœ€è¦å¢åŠ ä¸€è¡Œä»£ç ï¼Œä¿®æ”¹ä¸€ä¸‹optimizerå³å¯ã€‚ä¸è¿‡ä»æœ‰ä¸¤ç‚¹éå¸¸éœ€è¦æ³¨æ„ï¼š</p><ol><li>ä¿®æ”¹optimizeræœ€å¥½åœ¨build modelå‰å®Œæˆï¼Œå¦åˆ™æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šæŠ¥é”™ã€‚ </li><li>optimizeréœ€è¦æ˜¯tf.train.Optimizer or tf.keras.optimizers.Optimizerç»§æ‰¿æ¥çš„ï¼Œä¸æ”¯æŒkeras åŸç”Ÿçš„optimizerã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...</span><br><span class="line">opt = ...</span><br><span class="line">opt = tf.train.experimental.enable_mixed_precision_graph_rewrite(opt) <span class="comment"># rewrite opt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># build_model</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å½“åœ¨æ‰“å°ä¿¡æ¯ä¸­çœ‹åˆ° <code>tensorflow/core/grappler/optimizers/auto_mixed_precision.cc </code>ç›¸å…³ä¿¡æ¯ï¼Œåˆ™è¯´æ˜å·²æˆåŠŸå¼€å¯æ··åˆç²¾åº¦ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2021-08-04 07:36:24.231900: I tensorflow/core/grappler/optimizers/auto_mixed_precision.cc:1816] Running auto_mixed_precision graph optimizer</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h2><span id="yi-xie-ce-shi-jie-guo">ä¸€äº›æµ‹è¯•ç»“æœ</span><a href="#yi-xie-ce-shi-jie-guo" class="header-anchor"></a></h2><p>ç¬”è€…åœ¨V100 ä¸‹ç”¨bert-base åšäº†éƒ¨åˆ†æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><p><strong>batch_size=32, maxlen=128</strong></p><table><thead><tr><th></th><th>epoch 1</th><th>epoch 2</th><th>epoch 3</th><th>epoch 4</th><th>epoch 5</th></tr></thead><tbody><tr><td>å¼€å¯å‰ï¼š</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td>277s</td><td>246s</td><td>244s</td><td>246s</td><td>244s</td></tr><tr><td></td><td>164ms/step</td><td>147ms/step</td><td>146ms/step</td><td>147ms/step</td><td>146ms/step</td></tr><tr><td></td><td>bset acc:</td><td><code>0.57</code> </td></tr><tr><td>å¼€å¯åï¼š</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td>235s</td><td>200s</td><td>201s</td><td>200s</td><td>201s</td></tr><tr><td></td><td>140ms/step</td><td>120ms/step</td><td>121ms/step</td><td>120ms/step</td><td>121ms/step</td></tr><tr><td></td><td>best acc:</td><td><code>0.576</code></td></tr></tbody></table><p><strong>batch_size=64, maxlen=128</strong></p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">epoch 1</th><th style="text-align:center">epoch 2</th><th style="text-align:center">epoch 3</th><th style="text-align:center">epoch 4</th><th style="text-align:center">epoch 5</th></tr></thead><tbody><tr><td style="text-align:center">å¼€å¯å‰ï¼š</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">234s</td><td style="text-align:center">202s</td><td style="text-align:center">201s</td><td style="text-align:center">203s</td><td style="text-align:center">203s</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">281ms/step</td><td style="text-align:center">242ms/step</td><td style="text-align:center">241ms/step</td><td style="text-align:center">244ms/step</td><td style="text-align:center">244ms/step</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">best acc:</td><td style="text-align:center"><code>0.567</code></td></tr><tr><td style="text-align:center">å¼€å¯å:</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center">180s</td><td style="text-align:center">141s</td><td style="text-align:center">140s</td><td style="text-align:center">140s</td><td style="text-align:center">141s</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">216ms/step</td><td style="text-align:center">169ms/step</td><td style="text-align:center">168ms/step</td><td style="text-align:center">168ms/step</td><td style="text-align:center">169ms/step</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">best acc:</td><td style="text-align:center"><code>0.571</code></td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œbatch sizeè¶Šå¤§ï¼ŒåŠ é€Ÿæ¯”è¶Šå¯è§‚ï¼Œçº¦èƒ½èŠ‚çœ1/3çš„è®­ç»ƒæ—¶é—´ï¼ŒåŒæ—¶ï¼Œæ€§èƒ½ä¸ä¼šå‡ºç°æ˜æ˜¾ä¸‹é™ç”šè‡³å¯èƒ½ä¹Ÿä¼šé«˜ä¸€ç‚¹ç‚¹ã€‚<br>å¦å¤–ï¼Œæµ‹è¯•ä½¿ç”¨çš„bert æ˜¯keras ä»£ç ï¼Œå…¶ä¸­æœ‰ä¸€æ¡æ—¥å¿—æ˜¯<code> converted 1265/17548 nodes to float16 precision</code>ï¼Œæ‰€ä»¥çº¦æœ‰ä¸åˆ°10%çš„èŠ‚ç‚¹ä½¿ç”¨äº†åŠç²¾åº¦ï¼Ÿæ‰€ä»¥çŒœæµ‹ä½¿ç”¨åŠç²¾åº¦çš„èŠ‚ç‚¹è¶Šå¤šåŠ é€Ÿæ¯”è¶Šå¯è§‚ã€‚</p><h1><span id="tui-li-jia-su">æ¨ç†åŠ é€Ÿ</span><a href="#tui-li-jia-su" class="header-anchor"></a></h1><p>æ¨ç†æ—¶é€šå¸¸éœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªSDKæˆ–ä¸€ä¸ªAPI æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬åªè®¨è®ºAPI æœåŠ¡çš„æƒ…å†µã€‚<br>è€ŒAPI æœåŠ¡é€šå¸¸æœ‰ä¸¤ç§åšæ³•ï¼š</p><ol><li>åœ¨server ç«¯load æ¨¡å‹ï¼Œç„¶åç›´æ¥é¢„æµ‹ç»™å‡ºç»“æœï¼›</li><li>backend è°ƒç”¨tf-serving ï¼Œæ¨¡å‹çš„é¢„æµ‹ç”±tf-serving æ¥æä¾›ï¼Œå…¶ä½™çš„ï¼ˆæ•°æ®çš„é¢„å¤„ç†ï¼Œç»“æœçš„åå¤„ç†ç­‰ï¼‰åˆ™åœ¨backend ç«¯è¿›è¡Œã€‚tf-serving å…·æœ‰çƒ­æ›´æ–°ï¼Œæ”¯æŒå¤šæ¨¡å‹å¤šç‰ˆæœ¬ï¼Œå¼‚æ­¥è°ƒç”¨ï¼Œé«˜å¯ç”¨ç­‰ç‰¹æ€§ï¼Œæ‰€ä»¥ä¹Ÿæ¨èä½¿ç”¨tf-servingã€‚ä½¿ç”¨äº†tf-servingåï¼Œå®Œæ•´çš„è·¯çº¿å˜ä¸ºï¼š<br><strong>client â€“&gt; backend â€“&gt; rpc/rest â€“&gt; tf-serving</strong><br>å…¶ä¸­tf-serving æä¾›äº†ä¸¤ç§å½¢å¼çš„apiï¼šrestful api å’Œ grpc<br>å¯¹åº”çš„demo ä»£ç å¯ä»¥æŸ¥çœ‹<a href="https://github.com/xv44586/toolkit4nlp/tree/master/serving" target="_blank" rel="noopener">serving</a></li></ol><h2><span id="ce-shi">æµ‹è¯•</span><a href="#ce-shi" class="header-anchor"></a></h2><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>å¯çˆ±ä¿®ç‹—</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="speed-up" scheme="https://xv44586.github.io/tags/speed-up/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹æ¯”å­¦ä¹ å¿ƒè·¯å†ç¨‹</title>
    <link href="https://xv44586.github.io/2021/07/06/cl2rdrop/"/>
    <id>https://xv44586.github.io/2021/07/06/cl2rdrop/</id>
    <published>2021-07-06T14:25:15.000Z</published>
    <updated>2022-09-08T08:50:09.975Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#qian-yan">å‰è¨€</a></li><li><a href="#dui-bi-xue-xi-fan-shi">å¯¹æ¯”å­¦ä¹ èŒƒå¼</a></li><li><a href="#wu-jian-du-dui-bi-xue-xi">æ— ç›‘ç£å¯¹æ¯”å­¦ä¹ </a></li><li><a href="#you-jian-du-dui-bi-xue-xi">æœ‰ç›‘ç£å¯¹æ¯”å­¦ä¹ </a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><h1><span id="qian-yan">å‰è¨€</span><a href="#qian-yan" class="header-anchor"></a></h1><p>åœ¨ä¹‹å‰çš„<a href="https://xv44586.github.io/2021/01/20/ccf-qa-2/">åšå®¢</a>é‡Œï¼Œç¬”è€…ä»‹ç»äº†åœ¨æœ‰ç›‘ç£ä»»åŠ¡ï¼ˆæ–‡æœ¬åŒ¹é…ï¼‰ä¸Šï¼Œå¢åŠ å¯¹æ¯”å­¦ä¹ æ¥æé«˜æ¨¡å‹æ€§èƒ½çš„å®éªŒï¼Œè€Œå½“æ—¶å°è¯•åå´å‘ç°ï¼Œåœ¨æ–°å¢äº†å¯¹æ¯”å­¦ä¹ çš„ä»»åŠ¡åï¼Œæ¨¡å‹çš„æ€§èƒ½å¹¶æ²¡æœ‰å¾—åˆ°å¯¹åº”çš„æå‡ï¼Œç»è¿‡ç®€å•åˆ†æåï¼Œç¬”è€…ä¹Ÿå°è¯•ç»™å‡ºäº†ä¸€äº›å¯èƒ½çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆã€‚è™½ç„¶ç¬”è€…çš„å®éªŒéƒ½å¤±è´¥äº†ï¼Œä½†æ˜¯ç¬”è€…ä¾ç„¶è®¤ä¸ºå¯¹æ¯”å­¦ä¹ æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹å‘ï¼Œæ‰€ä»¥ä¹Ÿåœ¨æŒç»­å…³æ³¨ï¼Œè¿™ç¯‡å°±ç®—æ˜¯åç»­çš„å¡«å‘ä¸æ€»ç»“å§ã€‚</p><h1><span id="dui-bi-xue-xi-fan-shi">å¯¹æ¯”å­¦ä¹ èŒƒå¼</span><a href="#dui-bi-xue-xi-fan-shi" class="header-anchor"></a></h1><p>ä¹‹å‰ä¹Ÿæåˆ°è¿‡ï¼Œè¿™é‡Œåœ¨ç®€å•ç§°è¿°ä¸€ä¸‹å¯¹æ¯”å­¦ä¹ ç›®å‰çš„ä¸»è¦èŒƒå¼ã€‚å¯¹æ¯”å­¦ä¹ ä¸»è¦æ˜¯é€šè¿‡å¯¹æ¯”ï¼Œæ‹‰è¿‘ç›¸ä¼¼æ ·æœ¬ä¹‹é—´çš„è·ç¦»ï¼Œæ¨è¿œä¸ç›¸ä¼¼æ ·æœ¬ä¹‹é—´çš„è·ç¦»ã€‚è€Œç›¸ä¼¼æ ·æœ¬çš„æ„é€ ï¼Œåˆå¯ä»¥åˆ†ä¸ºæœ‰ç›‘ç£ä¸æ— ç›‘ç£ä¸¤ç§ï¼š</p><ul><li>æœ‰ç›‘ç£å¯¹æ¯”å­¦ä¹ ï¼šé€šè¿‡å°†ç›‘ç£æ ·æœ¬ä¸­çš„ç›¸åŒlabelçš„æ ·æœ¬ä½œä¸ºæ­£æ ·æœ¬ï¼Œä¸åŒlabelçš„æ ·æœ¬ä½œä¸ºè´Ÿæ ·æœ¬ï¼Œæ¥è¿›è¡Œå¯¹æ¯”å­¦ä¹ ï¼›</li><li>æ— ç›‘ç£å¯¹æ¯”å­¦ä¹ ï¼šç”±äºæ²¡æœ‰ç›‘ç£ä¿¡å·ï¼ˆlabelï¼‰ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯¹åŒä¸€ä¸ªæ ·æœ¬æ„é€ ä¸¤ä¸ªviewï¼Œè®©åŒä¸€æ ·æœ¬æ„é€ çš„ä¸¤ä¸ªviewäº’ä¸ºæ­£æ ·æœ¬ï¼Œè€Œå…¶ä»–æ ·æœ¬æ„é€ çš„viewåˆ™å…¨éƒ¨ä¸ºè´Ÿæ ·æœ¬ï¼Œä»¥æ­¤æ¥è¿›è¡Œå¯¹æ¯”å­¦ä¹ ã€‚è€Œç”±åŒä¸€ä¸ªæ ·æœ¬æ„é€ ä¸¤ä¸ªviewï¼Œåˆæ˜¯æ•°æ®æ‰©å¢çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç§°ä½œæ˜¯æ•°æ®æ‰©å±•å¯¹æ¯”å­¦ä¹ ã€‚è€Œä¸ç®¡é‚£ç§èŒƒå¼ï¼Œé€šå¸¸å¯¹æ¯”å­¦ä¹ éƒ½æ˜¯åœ¨batchå†…è¿›è¡Œã€‚</li></ul><h1><span id="wu-jian-du-dui-bi-xue-xi">æ— ç›‘ç£å¯¹æ¯”å­¦ä¹ </span><a href="#wu-jian-du-dui-bi-xue-xi" class="header-anchor"></a></h1><p>ç¬”è€…æ›¾ç»åœ¨å®éªŒä¸­ï¼Œé€šè¿‡å¯¹æ ·æœ¬è¿›è¡Œedaï¼ˆéšæœºæ›¿æ¢ã€éšæœºåˆ é™¤ã€éšæœºé‡å¤å’Œéšæœºäº’æ¢ï¼‰ï¼Œæ¥æ„é€ ä¸åŒviewï¼Œç”±æ­¤è¿›è¡Œå¯¹æ¯”å­¦ä¹ ã€‚å®éªŒå¤±è´¥åï¼Œç¬”è€…ä¹Ÿæåˆ°å¤±è´¥çš„å¯èƒ½åŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼šbatch sizeå¤ªå°ä¸”æ ·æœ¬ä¸Šç›´æ¥è¿›è¡Œæ“ä½œï¼Œè·å¾—çš„æ–°æ ·æœ¬ä¸åŸæ¥çš„è¯­ä¹‰å¯èƒ½ç”±è¾ƒå¤§çš„å·®åˆ«ç”šè‡³æ˜¯å®Œå…¨çš„åä¹‰ã€‚å¦‚ï¼šâ€œæˆ‘ä¸ä¼šå†çˆ±ä½ â€ â€“&gt; â€œæˆ‘ä¼šå†çˆ±ä½ â€,è€Œå¼ºè¡Œè®©è¿™ä¸¤ä¸ªæ ·æœ¬çš„è¯­ä¹‰è·ç¦»ç›¸äº’é è¿‘ï¼Œæ•ˆæœè‡ªç„¶ä¸ä¼šå¥½ï¼›è€Œbatch sizeå¤ªå°çš„é—®é¢˜ï¼Œä¸€æ¥æ˜¯æ¢å¤§çš„GPUï¼ŒäºŒæ¥å¯ä»¥å°è¯•åœ¨ç®—æ³•å±‚é¢è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚å°†Adam æ›¿æ¢ä¸ºAdaFactorï¼Œre-computeç­‰ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæ‰€ä»¥å°±ä¸å†ç»†è¯´äº†ã€‚<br>è€Œé’ˆå¯¹ç›´æ¥å¯¹æ ·æœ¬è¿›è¡Œä¿®æ”¹ä¼šå¯¼è‡´è¯­ä¹‰ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå…¶ä¸»è¦åŸå› æ˜¯NLPä¸­ï¼Œæ ·æœ¬çš„è¾“å…¥æ˜¯one-hotå½¢å¼çš„ï¼Œæˆ‘ä»¬çš„ç›¸ä¼¼æ ·æœ¬åº”è¯¥æ˜¯è¯­ä¹‰ä¸Šç›¸ä¼¼ï¼Œå¯¹åº”çš„ä¿®æ”¹åçš„è¯­ä¹‰è·ç¦»åº”è¯¥å°½å¯èƒ½â€œå°â€ï¼Œè€Œç›´æ¥å¯¹one-hotå½¢å¼è¿›è¡Œä¿®æ”¹ï¼Œå¯¹åº”çš„è·ç¦»æ’å®šæ˜¯$\sqrt{2}$ ï¼Œæ€ä¹ˆçœ‹ä¹Ÿä¸å°ã€‚ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å€Ÿé‰´å¯¹æŠ—è®­ç»ƒåœ¨NLPä¸­çš„æ–¹å¼ï¼Œå°†ä¿®æ”¹æ”¾åœ¨Embedding å±‚ï¼Œç”±äºone-hotä¸Embeddingçš„å¯¹åº”å…³ç³»ï¼Œå°±èƒ½å¤Ÿè·å¾—â€œç›¸ä¼¼è¯­ä¹‰â€çš„æ ·æœ¬äº†ã€‚å¯¹åº”æ€è·¯çš„è®ºæ–‡æœ‰ç¾å›¢ä»Šå¹´çš„<a href="http://arxiv.org/abs/2105.11741" target="_blank" rel="noopener">ConSERT: A Contrastive Framework for Self-Supervised Sentence Representation Transfer</a>,æ€»çš„æ¥è¯´ï¼Œè¿™ç¯‡paperå°±æ˜¯å°†EDAçš„æ€è·¯æ”¾åœ¨embedding å±‚ï¼Œç„¶åæ„å»ºä¸åŒviewåè¿›è¡Œå¯¹æ¯”å­¦ä¹ ï¼Œæœ€åè·å¾—çš„è¯­ä¹‰è¡¨ç¤ºè¶…è¿‡äº†å½“å‰çš„sotaï¼Œåœ¨å¤šä¸ªæ•°æ®é›†ä¸Šè·å¾—äº†æå‡ã€‚ä¸è¿‡å€¼å¾—åæ§½çš„æ˜¯ï¼Œç¾å›¢ä¹Ÿå­¦åäº†ï¼Œç«Ÿç„¶å­¦ä¼šäº†è°·æ­Œé‚£å¥—åœ¨æ›´å¤šæ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒç„¶åè·Ÿåªæœ‰åŸå§‹æ•°æ®çš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œå¯èƒ½æ˜¯è®ºæ–‡æœ¬èº«æ²¡ä»€ä¹ˆäº®ç‚¹ï¼Œåªèƒ½é€šè¿‡â€œå¤§çš„æå‡â€æ¥å¸å¼•çœ¼çƒäº†å§~<br>è€Œåšæ•°æ®æ‰©å¢æ—¶ï¼Œæœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–¹å¼éšæœºåˆ é™¤ä¸éšæœºäº’æ¢ï¼Œè€Œä½ç½®ç¼–ç åœ¨transformer ä¸­èµ·åˆ°çš„ä½œç”¨ä¸æ˜¯å…³é”®æ€§çš„ï¼Œä¸”ç›´æ¥äº’æ¢ä½ç½®ä¹Ÿä¼šå¸¦æ¥è¯­ä¹‰å˜åŒ–è¾ƒå¤§çš„é£é™©ï¼Œé‚£åªä½¿ç”¨éšæœºåˆ é™¤ç­–ç•¥åšæ•°æ®æ‰©å¢ï¼Œè¿›è¡Œå¯¹æ¯”å­¦ä¹ æ•ˆæœå¦‚ä½•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯éå¸¸å¥½ï¼å¥³ç¥é™ˆä¸¹ç¦æœ€è¿‘çš„è®ºæ–‡<a href="https://arxiv.org/abs/2104.08821" target="_blank" rel="noopener">SimCSE: Simple Contrastive Learning of Sentence Embeddings</a>,åªä½¿ç”¨dropout ï¼Œå¯¹åŒä¸€ä¸ªæ ·æœ¬æ„é€ ä¸¤ä¸ªä¸åŒçš„viewï¼Œç„¶åè¿›è¡Œå¯¹æ¯”å­¦ä¹ ï¼Œæœ€ç»ˆçš„æ•ˆæœåœ¨éç›‘ç£å­¦ä¹ ä»»åŠ¡ä¸‹8ä¸ªç‚¹æå‡èµ·æ­¥ï¼Œåœ¨ç›‘ç£ä»»åŠ¡ä¸‹4ä¸ªç‚¹æå‡èµ·æ­¥ï¼Œæ­¤å¤–ï¼Œ<a href="https://github.com/bojone/SimCSE" target="_blank" rel="noopener">è‹ç¥</a>åœ¨ä¸­æ–‡ä»»åŠ¡ä¸Šä¹Ÿè¿›è¡Œäº†å®éªŒï¼Œå†æ¬¡éªŒè¯äº†è¯¥æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚</p><p><img src="/2021/07/06/cl2rdrop/simcse.png" alt="æ•ˆæœå¯¹æ¯”"></p><p>è€Œsimcseå…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿå…¶å®åšæ³•ç›¸å½“ç®€å•ï¼Œå³å°†ä¸€ä¸ªæ ·æœ¬è¿›å…¥æ¨¡å‹ä¸¤æ¬¡ï¼Œç„¶åé€šè¿‡dropout ä¸¤æ¬¡ï¼Œè·å¾—ä¸¤ä¸ªä¸åŒçš„viewï¼Œäº’ä¸ºæ­£æ ·æœ¬ã€‚è€Œdropout ç”±äºæ˜¯åœ¨feature ç»´åº¦è¿›è¡Œéšæœºmaskï¼Œæ‰€ä»¥å°±å¾—åˆ°äº†ä¸åœ¨embeddingå±‚éšæœºmaskç›¸åŒçš„æ•ˆæœï¼Œæ­¤å¤–ï¼Œç”±äºåœ¨transformer ä¸­ï¼Œdropout å¤šæ¬¡ä½¿ç”¨ï¼Œä¹Ÿè¿›ä¸€æ­¥çš„å¢åŠ äº†ä¸¤ä¸ªview çš„å·®å¼‚ã€‚è¯»å®Œè®ºæ–‡ï¼Œçœ‹ç€æ•ˆæœï¼Œç›´å¹â€œå¤§é“è‡³ç®€â€ï¼Œè€Œå¯¹æ¯”åœ¨embedding åšæ‰°åŠ¨ä¸ç›´æ¥ä½¿ç”¨dropoutï¼Œä»æ•ˆæœä¸Šçœ‹dropout ä¹Ÿæ˜¯ä¸€ç§æ›´åŠ æœ‰æ•ˆçš„æ•°æ®æ‰©å¢æ‰‹æ®µã€‚é‚£è¿™ä¸ªæ€è·¯æ˜¯ä¸æ˜¯å¯ä»¥æ‰©å±•åˆ°æœ‰ç›‘ç£ä»»åŠ¡å‘¢ï¼Ÿ<br>å…¶å®è¯»å®ŒSimCSEåï¼Œç¬”è€…å°±è§‰å¾—dropout æ˜¯ä¸€ç§æ›´åŠ æœ‰æ•ˆçš„æ•°æ®æ‰©å¢æ‰‹æ®µï¼Œè‡ªç„¶å¯ä»¥æ‰©å±•åˆ°æœ‰ç›‘ç£ä»»åŠ¡å­¦ä¹ ä¸­ã€‚è¿™é‡Œçš„æœ‰ç›‘ç£ä»»åŠ¡å­¦ä¹ æœ‰åˆ«ä¸æœ‰ç›‘ç£å¯¹æ¯”å­¦ä¹ ï¼Œè¯·è¯»è€…æ³¨æ„åŒºåˆ†ã€‚è€Œåœ¨æœ‰ç›‘ç£ä»»åŠ¡å­¦ä¹ ä¸­çš„æ–¹æ¡ˆä¹Ÿæ˜¯æ¯”è¾ƒç›´è§‚ï¼šå°†æ ·æœ¬è¿›å…¥æ¨¡å‹ä¸¤éï¼Œç„¶ååœ¨åšç›‘ç£ä»»åŠ¡çš„åŒæ—¶ï¼Œå¢åŠ ä¸€ä¸ªå¯¹æ¯”å­¦ä¹ ï¼Œä¸è¿‡ç¬”è€…å®éªŒæ—¶è¢«ä¹‹å‰æ— ç›‘ç£ä»»åŠ¡çš„æ€è·¯æ‰€æŸç¼šäº†ï¼Œä¸€ç›´ä½¿ç”¨encoder output çš„logitsæ¥è¡¨å¾è¯­ä¹‰ï¼Œæ‰€ä»¥è°ƒæ¥è°ƒå»æ•ˆæœæ—¶å¥½æ—¶åï¼Œå¥½çš„æ—¶å€™ä¹Ÿæ²¡æœ‰è¶…è¿‡0.5çš„æå‡ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚<br>è€Œæœ€è¿‘çš„è®ºæ–‡<a href="http://arxiv.org/abs/2106.14448" target="_blank" rel="noopener">R-Drop: Regularized Dropout for Neural Networks</a>å´æˆåŠŸçš„å°†è¿™ä¸ªæ€è·¯å»¶ç»­äº†ä¸‹æ¥ï¼Œåœ¨è¯»å®Œå…¶<a href="https://github.com/dropreg/R-Drop" target="_blank" rel="noopener">ä»£ç </a>åï¼Œæ‰å‘ç°åŸæ¥æ˜¯è‡ªå·±å§¿åŠ¿ä¸å¯¹~<br>R-Dropä¸­çš„å®Œæ•´æ€è·¯æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡å°†æ ·æœ¬é‡å¤çš„è¾“å…¥åˆ°æ¨¡å‹ï¼Œç„¶åé€šè¿‡dropoutï¼Œè·å–ä¸åŒçš„viewï¼Œè€Œdropoutçš„ç›®çš„æ˜¯ä¸ºäº†å°†é›†æˆæ¨¡å‹çš„æ€è·¯å»¶ç»­åˆ°æ·±åº¦å­¦ä¹ ä¸­ï¼Œæœ¬è´¨ç›®çš„æ˜¯å¢åŠ æ¨¡å‹çš„é²æ£’æ€§ã€‚æ‰€ä»¥ï¼Œä¸åŒçš„viewè·å¾—çš„æœ€ç»ˆçš„è¾“å‡ºï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›å…¶å°½å¯èƒ½çš„ä¸€è‡´ã€‚è€Œè®ºæ–‡ä¸­çš„ä»»åŠ¡éƒ½æ˜¯åˆ†ç±»ä»»åŠ¡ï¼Œæ‰€ä»¥æ¨¡å‹æœ€ç»ˆçš„è¾“å‡ºæ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œè¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†åˆ«çš„å·®å¼‚é€šå¸¸ä½¿ç”¨klæ•£åº¦ï¼Œæ‰€ä»¥æœ€ç»ˆçš„losså¢åŠ äº†ä¸€ä¸ªå¯¹åº”viewä¹‹é—´çš„kl-divergenceã€‚<br>å¯¹æ¯”ç¬”è€…ä¹‹å‰çš„æ€è·¯ä¸R-Drop ä¸­çš„æ€è·¯ï¼Œé¦–å…ˆR-Drop ä¸­æ˜¯ç›´æ¥ä½œç”¨åœ¨æœ€ç»ˆçš„probsä¸Šï¼Œè€Œç¬”è€…æ˜¯å¸Œæœ›encoder output logits ä¹‹é—´èƒ½â€œåŒæ€§ç›¸å¸ï¼Œå¼‚æ€§æ’æ–¥â€ï¼Œè€Œç”±äºåœ¨åšåˆ†ç±»ä»»åŠ¡æ—¶ï¼Œåœ¨logits åéƒ½ä¼šæ¥ä¸€ä¸ªdenseå±‚æ¥å‹ç¼©ç»´åº¦ï¼Œè¿™ä¸ªdense å±‚å°±ä¼šå¤§å¤§æŠ‘åˆ¶å‰é¢çš„å¯¹æ¯”å­¦ä¹ çš„æ•ˆæœï¼Œå³å‰é¢çš„logitså¯ä»¥å·®å¼‚å¾ˆå¤§ï¼Œä½†é€šè¿‡æœ€åçš„denseå±‚ï¼Œå´èƒ½å¾—åˆ°ä¸€æ ·çš„é¢„æµ‹ç»“æœï¼ˆlabelç›¸åŒï¼‰ï¼Œè€Œç›´æ¥ä½œç”¨åœ¨æœ€ç»ˆçš„è¾“å‡ºå±‚ï¼Œæ‰ä¼šå¾—åˆ°æƒ³è¦çš„æ•ˆæœï¼›å…¶æ¬¡åœ¨R-Drop ä¸­ï¼Œä¸å†éœ€è¦ä¸å…¶ä»–æ ·æœ¬åšå¯¹æ¯”ï¼Œå³åªè¦ç›¸åŒview çš„è¾“å‡ºè¶³å¤Ÿâ€œæ¥è¿‘â€å³å¯ï¼Œè€Œä¸éœ€è¦å…¶ä¸å…¶ä»–çš„view å°½å¯èƒ½çš„â€œè¿œâ€ï¼Œè€ƒè™‘åˆ°åŒä¸€ä¸ªbatch å†…ï¼Œå­˜åœ¨åŒæ ·labelçš„æ ·æœ¬çš„æ¦‚ç‡æ˜¯æå¤§çš„ï¼Œè€Œè¦æ±‚åŒæ—¶é¢„æµ‹å¯¹labelåˆè¦å…¶ç»“æœä¹‹é—´å°½å¯èƒ½ä¸åŒæ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥å–æ¶ˆæ‰ä¸å…¶ä»–viewä¹‹é—´çš„å¯¹æ¯”ä¹Ÿæ˜¯åˆç†ä¸å¿…è¦çš„ï¼›è€Œç”±äºä¸éœ€è¦å»å…¶ä»–viewåšå¯¹æ¯”ï¼Œå¯¹æ¯”å­¦ä¹ ä¸­å¤§batch sizeçš„è¦æ±‚ä¹Ÿå°±ä¸å†éœ€è¦ï¼Œå³åœ¨å°çš„batch size ä¸‹è¯¥æ–¹æ³•ä¾ç„¶æœ‰æ•ˆï¼ŒçœŸå¯è°“â€œæ–¹æ³•ç®€å•æ•ˆæœå¥½â€ï¼Œåœ¨æ‰€æœ‰çš„NLPä»»åŠ¡ä¸­éƒ½å€¼å¾—å°è¯•ã€‚<br>å‰é¢æåˆ°ç¬”è€…ä¹‹å‰çš„æ€è·¯çš„æœ€å¤§é—®é¢˜æ˜¯å¯¹æ¯”çš„ä¸æ˜¯æœ€åä¸€å±‚çš„è¾“å‡ºï¼Œè€ŒåŒä¸€batchå†…ï¼Œåˆä¸å¯é¿å…çš„ä¼šå‡ºç°ç›¸åŒlabelï¼Œè®©ç›¸åŒlabelçš„logitsä¹‹é—´ç›¸äº’â€œè¿œç¦»â€ä¼¼ä¹ä¸å¤ªåˆç†ï¼Œä½†ä»å¯¹æŠ—è®­ç»ƒæˆ–è€…æ¨¡å‹çš„é²æ£’æ€§ä¸Šè€ƒè™‘ï¼Œè®©åŒä¸€æ ·æœ¬çš„ä¸åŒviewä¹‹é—´ç›¸äº’æ¥è¿‘è€Œä¸å…¶ä»–viewä¹‹é—´ç›¸äº’è¿œç¦»ï¼Œå¯ä»¥è¾¾åˆ°è®©æ ·æœ¬åœ¨ä¸€ä¸ªèŒƒå›´å†…çš„è¾“å‡ºå°½å¯èƒ½çš„ä¿æŒä¸€è‡´ï¼Œä»è€Œèƒ½ä½¿æ¨¡å‹æ›´åŠ çš„é²æ£’ï¼Œè‡ªç„¶ä¼šå¢åŠ ä¸€äº›æ³›åŒ–èƒ½åŠ›ã€‚è¿™ä¸ªæ€è·¯ç¬”è€…ä¹Ÿåœ¨<a href="https://github.com/xv44586/toolkit4nlp/blob/master/examples/classification_tnews_contrastive_learning_dropout.py" target="_blank" rel="noopener">ä¹‹å‰çš„å®éªŒ</a>ä¸Šè¿›è¡Œäº†ä¿®æ”¹å°è¯•ï¼Œç»“æœæ˜¾ç¤ºç¡®å®èƒ½æé«˜ä¸€äº›æ€§èƒ½ï¼Œä½†æ˜¯ä¸åªæ‹‰è¿‘ç›¸åŒviewä¹‹é—´çš„kl-divergenceç›¸æ¯”ï¼Œæå‡å°±ä¸å¤Ÿçœ‹äº†ã€‚</p><h1><span id="you-jian-du-dui-bi-xue-xi">æœ‰ç›‘ç£å¯¹æ¯”å­¦ä¹ </span><a href="#you-jian-du-dui-bi-xue-xi" class="header-anchor"></a></h1><p>æœ‰ç›‘ç£å¯¹æ¯”å­¦ä¹ æ˜¯æŒ‡ç›¸åŒlabelä¹‹é—´äº’ä¸ºæ­£æ ·æœ¬ï¼Œä¸åŒlabelé—´ä¸ºè´Ÿæ ·æœ¬ï¼Œä¸ä¸Šæ–‡æåˆ°çš„æœ‰ç›‘ç£ä»»åŠ¡æ˜¯ä¸åŒçš„ã€‚è€Œæœ‰ç›‘ç£ä»»åŠ¡ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨æ— ç›‘ç£å¯¹æ¯”å­¦ä¹ çš„æ€è·¯ï¼Œå¦‚ä¸Šæ–‡æåˆ°çš„R-Dropï¼Œè€Œæœ‰ç›‘ç£å¯¹æ¯”å­¦ä¹ è‡ªä»<a href="https://arxiv.org/abs/2011.01403" target="_blank" rel="noopener">Supervised Contrastive Learning for Pre-trained Language Model Fine-tuning</a>åï¼Œç¬”è€…è¿˜æœªå…³æ³¨åˆ°æœ‰ä»€ä¹ˆæ–°çš„è¿›å±•ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èåœ¨æœ‰ç›‘ç£ä»»åŠ¡ä¸Šä½¿ç”¨R-Dropæ€è·¯ã€‚</p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬æ–‡ä¸»è¦æ€»ç»“äº†ä»ç¬”è€…ä¹‹å‰å¯¹æ¯”å­¦ä¹ å®éªŒæ—¶ç•™ä¸‹çš„é—®é¢˜ï¼Œåˆ°æœ€è¿‘ä¸€äº›è®ºæ–‡ä¸­æå‡ºçš„è§£å†³æ€è·¯ï¼Œè™½ç„¶æ•´ä¸ªå¿ƒè·¯å†ç¨‹ä¸åŸä½œè€…ä»¬çš„è‚¯å®šä¸ä¸€æ ·ï¼Œä½†å¸Œæœ›èƒ½ç»™è¯»è€…æä¾›å¯¹æ¯”å­¦ä¹ åˆ°ç›®å‰ä¸ºæ­¢çš„ä¸€äº›è¿›å±•è„‰ç»œã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>å›¾ç‰‡æ¥è‡ªå¤§ä½¬åˆ‘æ— åˆ€ï¼ˆé™ˆå¼€æ±Ÿï¼‰çš„æœ‹å‹åœˆï¼šæ®è¯´äººå·¥æ™ºèƒ½ä¸­æœ‰80%çš„éƒ¨åˆ†æ˜¯äººå·¥ğŸ˜„</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="SimCSE" scheme="https://xv44586.github.io/tags/SimCSE/"/>
    
      <category term="R-Drop" scheme="https://xv44586.github.io/tags/R-Drop/"/>
    
  </entry>
  
  <entry>
    <title>å¤šä»»åŠ¡å­¦ä¹ -ä»¥å¤©æ± æ¯”èµ›ä¸ºä¾‹çš„ä¸‰ç§æ€è·¯</title>
    <link href="https://xv44586.github.io/2021/03/28/multi-task/"/>
    <id>https://xv44586.github.io/2021/03/28/multi-task/</id>
    <published>2021-03-28T01:37:01.000Z</published>
    <updated>2021-03-28T03:34:57.816Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#ti-mu-jian-jie">é¢˜ç›®ç®€ä»‹</a></li><li><a href="#baseline">baseline</a></li><li><a href="#yang-ben-qu-fen">æ ·æœ¬åŒºåˆ†</a></li><li><a href="#ruan-qu-fen">è½¯åŒºåˆ†</a></li><li><a href="#shi-yan-jie-guo">å®éªŒç»“æœ</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>å‡ ä¸ªæœˆå‰æ›¾å…³æ³¨è¿‡å¤©æ± çš„å¤šä»»åŠ¡å­¦ä¹ æ¯”èµ›:<a href="https://tianchi.aliyun.com/competition/entrance/531841/information" target="_blank" rel="noopener">NLPä¸­æ–‡é¢„è®­ç»ƒæ¨¡å‹æ³›åŒ–èƒ½åŠ›æŒ‘æˆ˜èµ›</a>,æœ¬æ¥åº”è¯¥ä»£ç å†™å®Œå°±åº”è¯¥å†™è¿™ç¯‡æ€»ç»“ï¼Œä¸è¿‡æ‹–å»¶ç—‡æ‚£è€…æ€»æ˜¯æ— æ³•æŒ‰æ—¶å®Œæˆè®¡åˆ’ï¼</p><h1><span id="ti-mu-jian-jie">é¢˜ç›®ç®€ä»‹</span><a href="#ti-mu-jian-jie" class="header-anchor"></a></h1><p>é¢˜ç›®æ˜¯å¸Œæœ›é€‰æ‰‹èƒ½å¤Ÿé€šè¿‡ç®—æ³•å®ç°æ³›åŒ–èƒ½åŠ›æ›´å¼ºçš„ä¸­æ–‡é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œæ¥æé«˜ä¸‹æ¸¸ä¸šåŠ¡çš„å‡†ç¡®æ€§ï¼Œä¸ºäº†è¯„æµ‹æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œé¢˜ç›®ç»™å‡ºäº†ä¸‰ä¸ªä¸åŒçš„ä»»åŠ¡åŠå¯¹åº”çš„æ•°æ®ã€‚  </p><ul><li>OCNLIï¼šæ˜¯ç¬¬ä¸€ä¸ªéç¿»è¯‘çš„ã€ä½¿ç”¨åŸç”Ÿæ±‰è¯­çš„å¤§å‹ä¸­æ–‡è‡ªç„¶è¯­è¨€æ¨ç†æ•°æ®é›†ï¼›</li><li>OCEMOTIONï¼šæ˜¯åŒ…å«7ä¸ªåˆ†ç±»çš„ç»†ç²’åº¦æƒ…æ„Ÿæ€§åˆ†ææ•°æ®é›†ï¼›</li><li>TNEWSï¼šæ¥æºäºä»Šæ—¥å¤´æ¡çš„æ–°é—»ç‰ˆå—ï¼Œå…±åŒ…å«15ä¸ªç±»åˆ«çš„æ–°é—»ï¼›ç®€å•æ¥è¯´å°±æ˜¯éœ€è¦ç”¨ä¸€ä¸ªæ¨¡å‹ï¼Œæ¥å®ç°å¤šä¸ª</li></ul><p>æ­¤å¤–ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹ï¼Œé¢˜ç›®è¦æ±‚â€å•æ¨¡å‹â€ï¼Œå³ä¸€ä¸ªä»»åŠ¡åªèƒ½æœ‰ä¸€ä¸ªé¢„æµ‹å‡½æ•°ï¼Œæ‰€æœ‰ä»»åŠ¡åªèƒ½ä½¿ç”¨åŒä¸€ä¸ªbertï¼Œåœ¨è®¡ç®—å›¾ä¸­åªèƒ½æœ‰ä¸€ä¸ªbertæ¥å®Œæˆä»»åŠ¡ï¼Œä¸èƒ½é›†æˆå¤šä¸ªæ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼›</p><p>åœ¨éªŒè¯æ³›åŒ–èƒ½åŠ›æ—¶å¼ºåŠ è¿™ä¸ªè¦æ±‚æ˜¯å¦åˆç†è¿™é‡Œä¸åšè®¨è®ºï¼Œä¸è¿‡å¯ä»¥çœ‹å‡ºï¼Œé¢˜ç›®æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å­¦ä¹ çš„é¢˜ç›®ï¼Œä¸è¿‡åˆä¸å¹³æ—¶å¸¸è§çš„å¤šä»»åŠ¡å­¦ä¹ ä¸å¤ªä¸€æ ·ï¼šé€šå¸¸çš„å¤šä»»åŠ¡å­¦ä¹ æ˜¯åœ¨åŒä¸€ä¸ªæ ·æœ¬ä¸Šï¼ŒåŒæ—¶è¿›è¡Œå¤šä¸ªç›®æ ‡çš„ä¼˜åŒ–ï¼Œå¦‚Bertä¸­çš„MLMå’ŒNSPï¼Œè€Œæ­¤æ¬¡é¢˜ç›®å´æ˜¯åœ¨å¤šä¸ªæ ·æœ¬ä¸Šè¿›è¡Œå¤šä¸ªä»»åŠ¡çš„å­¦ä¹ ï¼Œä¸åŒçš„ä»»åŠ¡é—´å¹¶ä¸å…±äº«æ•°æ®ã€‚</p><h1><span id="baseline">baseline</span><a href="#baseline" class="header-anchor"></a></h1><p>å®ç°å¤šä»»åŠ¡å­¦ä¹ æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å…±äº«backboneï¼Œç„¶åå¯¹ä¸åŒçš„ä»»åŠ¡æ‹¼æ¥ä¸åŒçš„åˆ†ç±»å™¨ã€‚å‚è€ƒBERTçš„è®­ç»ƒè¿‡ç¨‹ï¼Œå³åœ¨transformer last layeråé¢æ¥task ç›¸å…³çš„åˆ†ç±»å±‚å³å¯ã€‚ä¸è¿‡ç”±äºä¸åŒæ ·æœ¬å¯¹åº”ä¸åŒçš„ä»»åŠ¡ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯ä¸ªæ ·æœ¬æŒ‡å®šå¯¹åº”çš„åˆ†ç±»å±‚ã€‚ç”±äºç¬”è€…åªä¼šå†™kerasï¼Œè€Œç”±äºtfè¿™ç§é™æ€å›¾ï¼Œå¯¹æ¯ä¸ªæ ·æœ¬è¿›è¡Œswitch ä¸åŒçš„å±‚ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥å®ç°çš„æ—¶å€™å¯¹æ¯ä¸ªæ ·æœ¬éƒ½æ‹¼æ¥äº†ä¸‰ä¸ªåˆ†ç±»å±‚ï¼Œç„¶åå¯¹loss è¿›è¡Œmaskï¼Œæ¥å±è”½æ‰éä»»åŠ¡éƒ¨åˆ†ã€‚<br>å…·ä½“çš„å®ç°ç»†èŠ‚è¿˜æ˜¯çœ‹ä»£ç ï¼Œä»£ç ï¼š<a href="https://github.com/xv44586/tianchi_multitask/blob/master/baseline.ipynb" target="_blank" rel="noopener">multi-task-baseline</a></p><h1><span id="yang-ben-qu-fen">æ ·æœ¬åŒºåˆ†</span><a href="#yang-ben-qu-fen" class="header-anchor"></a></h1><p>ä¸Šé¢çš„baseline æ˜¯é€šè¿‡æ‹¼æ¥ä¸åŒçš„åˆ†ç±»å±‚æ¥å®Œæˆå¤šä»»åŠ¡å­¦ä¹ ï¼Œæœ¬è´¨ä¸Šæ˜¯å¸Œæœ›æ¨¡å‹èƒ½å¯¹ä¸åŒå¯¹ä»»åŠ¡è¿›è¡ŒåŒºåˆ†ï¼Œé‰´äºé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„å¼ºå¤§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ ·æœ¬ä¸Šè¿›è¡ŒåŒºåˆ†ï¼Œè®©æ¨¡å‹â€æ„ŸçŸ¥â€åˆ°ä»»åŠ¡çš„ä¸åŒã€‚è€Œæ ·æœ¬ä¸Šè¿›è¡ŒåŒºåˆ†ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å¢åŠ ä¸€ä¸ªâ€ä»»åŠ¡è¯´æ˜â€äº†ã€‚å¯¹GPTè¿™ç§å•å‘è¯­è¨€æ¨¡å‹ï¼Œå¯ä»¥åœ¨æ ·æœ¬æœ€å‰é¢åŠ ä¸€ä¸ªä»»åŠ¡ç›¸å…³çš„å­—æ®µï¼Œå¦‚â€æ–‡æœ¬å¤šåˆ†ç±»â€/â€œæƒ…æ„Ÿåˆ†æâ€ï¼Œç„¶åå°†æ‰€æœ‰ä»»åŠ¡éƒ½è½¬æˆç”Ÿæˆä»»åŠ¡ã€‚è€Œå¯¹bertè¿™ç§æ©ç è¯­è¨€æ¨¡å‹ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå³å€Ÿé‰´PETçš„æ€è·¯ï¼Œå°†æ‰€æœ‰ä»»åŠ¡éƒ½è½¬æˆåˆ†ç±»ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ä¸åŒçš„pattern æ¥åŒºåˆ†ä¸åŒçš„ä»»åŠ¡ï¼Œpatternçš„ç»“æœæ¥åŒºåˆ†å¯¹åº”çš„ä»»åŠ¡çš„ç»“æœã€‚è€Œpetçš„æ€è·¯å·²ç»å†™è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå¦‚ä¹‹å‰<a href="https://xv44586.github.io/2020/10/25/pet/">PET-æ–‡æœ¬åˆ†ç±»çš„åˆä¸€ä¸ªç§’è§£</a>ã€‚<br>ä¸ç®¡æ˜¯GPTè¿˜æ˜¯BERTä¸‹ï¼Œæœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼šå€Ÿé‰´è¯­è¨€æ¨¡å‹çš„ç”Ÿæˆèƒ½åŠ›ï¼Œè½¬åŒ–ä»»åŠ¡ç±»å‹ï¼Œå¯¹æ ·æœ¬å¢åŠ å›ºå®špatternæ¥åŒºåˆ†ä»»åŠ¡ç±»å‹ï¼Œæœ€ç»ˆé€šè¿‡è®­ç»ƒè¯­è¨€æ¨¡å‹æ¥å®Œæˆä»»åŠ¡ã€‚</p><h1><span id="ruan-qu-fen">è½¯åŒºåˆ†</span><a href="#ruan-qu-fen" class="header-anchor"></a></h1><p>ä¸Šé¢æ ·æœ¬åŒºåˆ†æåˆ°å°†ä»»åŠ¡è½¬åŒ–ä¸ºè¯­è¨€æ¨¡å‹ï¼Œé‚£æ›´è¿›ä¸€æ­¥çš„æƒ³ï¼Œåœ¨è¯­è¨€æ¨¡å‹ï¼ˆseq2seqï¼‰ä¸‹ï¼Œå¤šä»»åŠ¡å­¦ä¹ æ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿç¬”è€…è®¤ä¸ºï¼Œåœ¨è¯­è¨€æ¨¡å‹ä¸‹å¯ä»¥å°†å¤šä»»åŠ¡å­¦ä¹ ç±»æ¯”ä¸ºæœ‰æ¡ä»¶çš„æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œè€Œä¸åŒçš„ä»»åŠ¡ç±»å‹å¯¹åº”ç€ä¸åŒçš„æ¡ä»¶ï¼Œç”±æ­¤å°±å¯ä»¥å€Ÿé‰´æ¡ä»¶æœ¬æ–‡ç”Ÿæˆçš„åšæ³•æ¥åšå¤šä»»åŠ¡äº†ã€‚<br>æ¡ä»¶æ–‡æœ¬ç”Ÿæˆçš„åšæ³•ï¼Œç¬”è€…äº†è§£ä¸å¤šï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å€Ÿé‰´è‹ç¥<a href="https://kexue.fm/archives/7124" target="_blank" rel="noopener">åŸºäºConditional Layer Normalizationçš„æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ</a>é‡Œæåˆ°çš„åšæ³•ï¼Œå³æŠŠæ¡ä»¶èåˆåˆ°Layer Normalizationçš„$Î²$å’Œ$Î³$ä¸­å»ã€‚å¯¹ä¸åŒçš„æ¡ä»¶ï¼Œæ¥è°ƒèŠ‚æ‰€æœ‰çš„LayerNormalizationå±‚çš„å¹³ç§»ç¼©æ”¾å‚æ•°ï¼Œæ¥è¿›è¡Œâ€è½¯åŒºåˆ†â€ã€‚<br>è€Œæ¡ä»¶ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»»åŠ¡ç±»å‹è¿›è¡Œembeddingåæ¥è¡¨è¾¾ã€‚å¯¹åº”çš„å®éªŒä»£ç <a href="https://github.com/xv44586/tianchi_multitask/blob/master/tnews_baseline-adapt.ipynb" target="_blank" rel="noopener">multi-task-adapt</a></p><h1><span id="shi-yan-jie-guo">å®éªŒç»“æœ</span><a href="#shi-yan-jie-guo" class="header-anchor"></a></h1><p>ä¸Šé¢çš„ä¸‰ä¸ªæ€è·¯ä¸­ï¼Œç¬”è€…æ²¡æœ‰æ ·æœ¬åŒºåˆ†çš„æ€è·¯è¿›è¡Œå®éªŒï¼ŒåŸå› æ˜¯å®åœ¨æƒ³ä¸åˆ°ä¸‰ä¸ªé•¿åº¦ç›¸åŒçš„patternï¼Œæ‰€ä»¥å°±æ²¡å†™å®éªŒï½è€Œå¦å¤–ä¸¤ä¸ªæ€è·¯ï¼Œä»ç»“æœä¸Šçœ‹æ•ˆæœå·®åˆ«ä¸å¤§ï¼Œç”šè‡³baseline æ¯”è½¯åŒºåˆ†è¿˜æœ‰æ›´ä¼˜ä¸€ç‚¹ç‚¹ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½åœ¨äºä¸‰ä¸ªä¸åŒä»»åŠ¡çš„æ•°æ®é‡ä¸åŒï¼Œæˆ–ä¸‰ä¸ªä»»åŠ¡çš„æ•°æ®é‡éƒ½åå°‘ï¼Œå¯¼è‡´conditionalå­¦ä¹ çš„ä¸å……åˆ†ï¼Œç†è®ºä¸Šè‡³å°‘åº”è¯¥å­¦åˆ°ä¸æœªåŠ conditionalæ•ˆæœæŒå¹³ï¼Œå³æ­¤æ—¶conditionalæ— æ•ˆã€‚å…·ä½“è°ƒä¼˜å°±ç•™ç»™æ„Ÿå…´è¶£çš„è¯»è€…äº†ã€‚</p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>ä»¥ä¸Šå°±æ˜¯ç¬”è€…ä¸‰ä¸ªæœˆå‰é’ˆå¯¹å¤©æ± æ¯”èµ›å¯¹å¤šä»»åŠ¡å­¦ä¹ è¿›è¡Œçš„ä¸€äº›æ€è€ƒä¸æ€»ç»“ï¼Œä¸è¿‡æ—¶é—´é—´éš”æœ‰äº›ä¹…äº†ï¼Œéš¾å…æœ‰äº›ä¸œè¥¿å¿˜äº†æˆ–è€…è®°é”™äº†ï¼Œå¦‚æœ‰å‘ç°è¿˜æœ›æå‡ºã€‚<br>PSï¼šæ‹–å»¶ç—‡è¯¥ç®¡ç®¡äº†ï¼ï¼</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="multi-task" scheme="https://xv44586.github.io/tags/multi-task/"/>
    
  </entry>
  
  <entry>
    <title>è¾æ—§è¿æ–°</title>
    <link href="https://xv44586.github.io/2021/02/19/happy-new-year/"/>
    <id>https://xv44586.github.io/2021/02/19/happy-new-year/</id>
    <published>2021-02-18T23:31:19.000Z</published>
    <updated>2021-02-20T13:26:37.681Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#ci-jiu">è¾æ—§</a></li><li><a href="#ying-xin">è¿æ–°</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div><br>åœ¨æ–°å¹´è¿™ä¸ªé‡è¦çš„æ—¶é—´èŠ‚ç‚¹ä¸Šï¼Œæ€»åº”è¯¥åšäº›æ€»ç»“ä¸è®¡åˆ’ï¼Œæ¥è¾æ—§è¿æ–°ï¼Œç„¶è€Œæˆ‘æ€»æ˜¯æ‡’æƒ°åŠ æ‹–å»¶ï¼Œåˆ°äº†ä»Šå¤©åˆå…«æ‰æ­£å¼å¼€å†™ï¼Œæ‰€ä»¥æ–°çš„ä¸€å¹´ï¼Œç¬¬ä¸€ä¸ªflagå°±æ˜¯ï¼šå¸Œæœ›èƒ½æ‰¾åˆ°è‰¯è¯åŒ»æ²»ä¸€ä¸‹æˆ‘çš„æ‹–å»¶ç—‡ - -ï¼</p><h1><span id="ci-jiu">è¾æ—§</span><a href="#ci-jiu" class="header-anchor"></a></h1><p>2020å¹´æ˜¯ç¥å¥‡çš„ä¸€å¹´ï¼Œè¿™ä¸€å¹´é‡Œå‘ç”Ÿäº†å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„äº‹ï¼Œç”¨ç½‘å‹ä»¬çš„è¯è®²å°±æ˜¯è¿™ä¸€å¹´æ€»å¿™ç€è§è¯å†å²äº†ã€‚è€Œéœ€è¦è§è¯çš„å†å²å¤ªå¤šï¼Œå¤§å¤šæ•°æˆ‘éƒ½æ²¡å…³æ³¨ï¼Œæ‰€ä»¥åªè®°å½•ä¸€ä¸‹æˆ‘è‡ªå·±â€è§è¯â€çš„å†å²ã€‚<br>é¦–å…ˆæ˜¯è¿‡å¹´å›å®¶ï¼Œåˆšåˆ°å®¶æˆ‘å°±å»å¿é‡Œçš„è¯åº—å±¯äº†å£ç½©å’Œæ„Ÿå†’è¯ï¼Œä¹‹åå°±æ˜¯æŒç»­è‡³ä»Šçš„æ–°å† ï¼Œè€Œç”±äºæ–°å† åˆæœŸï¼Œå¤§å®¶å¯¹å…¶è®¤è¯†å¾ˆå°‘ï¼Œæ‰€ä»¥é™åˆ¶å‡ºè¡Œï¼Œè€Œæˆ‘ä¹Ÿå°±å› æ­¤åº¦è¿‡äº†é«˜ä¸­ä»¥æ¥åœ¨å®¶æœ€ä¹…çš„ä¸€æ¬¡â€å¯’å‡â€â€“æ•´æ•´ä¸‰ä¸ªæœˆï¼Œç›´åˆ°å››æœˆåˆï¼Œæ‰ä¹°åˆ°äº†æœºç¥¨å›æ¥ä¸Šç­ã€‚<br>åœ¨å®¶çš„ä¸‰ä¸ªæœˆï¼Œå¯¹æˆ‘æœ€å¤§çš„å¸®åŠ©å¯èƒ½å°±æ˜¯å¿ƒçµæ²»æ„ˆäº†ï¼Œ<code>äººé—´çƒŸç«æ°”ï¼Œæœ€æŠšå‡¡äººå¿ƒ</code><br>è™½ç„¶åœ¨å®¶é™ªçˆ¶æ¯ï¼Œä½†æ˜¯åæœŸè¿˜æ˜¯éœ€è¦æ­£å¸¸æ‰“å¡çš„ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿé¡ºä¾¿ç ”ç©¶äº†ä¸€ä¸‹è—æ–‡è¯­è¨€æ¨¡å‹å’Œæ–‡æœ¬çº é”™ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ—¶æœŸï¼Œè®©æˆ‘æ›´åšå®šçš„æƒ³è¦ä¸€å°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œæ¥å®éªŒæƒ³æ³•ã€‚äºæ˜¯ï¼Œå›åˆ°åŒ—äº¬åï¼Œæˆ‘å°±å¼€å§‹è°ƒç ”ç¡¬ä»¶ç›¸å…³ï¼Œç„¶åè‡ªå·±åŠ¨æ‰‹æ­äº†ä¸€å°<a href="https://xv44586.github.io/2020/05/05/make-a-computer/">æœåŠ¡å™¨</a>ï¼Œè¿™é‡Œè¿˜è¦æ„Ÿè°¢ä¸€ä¸‹é“¶ç¿”è€å“¥ï¼Œå¸®æˆ‘æŠ¥é”€äº†2080Tiçš„é’±ï¼Œå“ˆå“ˆã€‚<br>æœ‰äº†æœåŠ¡å™¨ï¼Œæˆ‘å°±å¼€å§‹<code>æ”¾å¼ƒå¹»æƒ³ï¼Œæ‹¥æŠ±transformer </code>, å¼€å§‹äº†çœ‹è®ºæ–‡ä¸å†™demo çš„è·¯ç¨‹ï¼ŒæœŸé—´å‚è€ƒ<a href="https://github.com/bojone/bert4keras.git" target="_blank" rel="noopener">bert4keras</a> ä¸ <a href="https://github.com/CyberZHG/keras-bert" target="_blank" rel="noopener">keras-bert</a>, å®ç°äº†ä¸€ä¸‹Bertï¼Œä¸è¿‡ä¸­é—´æœ‰æ¬¡å®éªŒç»“æœæœ‰äº›å¥‡æ€ªï¼Œä¸ºäº†æŸ¥é—®é¢˜ï¼ŒAPIåŸºæœ¬ä¸Šæ”¹æˆbert4kerasä¸€è‡´äº†ã€‚åé¢ä¸€äº›ç›¸transformerç›¸å…³çš„å®éªŒä»£ç åŸºæœ¬ä¹Ÿéƒ½åœ¨<a href="https://github.com/xv44586/toolkit4nlp" target="_blank" rel="noopener">toolkit4nlp</a><br>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°æ’æ›²ï¼Œç‹èŒè€å“¥å¸¦æˆ‘æ‰“äº†ä¸€ä¸ªè„‘ç§‘å­¦çš„æ¯”èµ›ï¼Œæˆ‘ä»¬ä¿©èŠ±äº†ä¸€å¤©æœ€åæ‹¿äº†ä¸ªé“œç‰Œï¼Œè¿™ä¹Ÿè®©æˆ‘äº†è§£åˆ°åœ¨å¾ˆå¤šé¢†åŸŸï¼Œå¯¹æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ è¿˜æ˜¯è¿ç”¨çš„ç›¸å½“å°‘çš„ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºä»»åŠ¡å½¢æ€çš„åŸå› ï¼Œä¸€æ–¹é¢ä¹Ÿæ˜¯è¿™äº›é¢†åŸŸæ¥å—æ–°äº‹ç‰©æ¯”è¾ƒç¼“æ…¢å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºä¸æœºå™¨å­¦ä¹ åšäº¤å‰ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šäº‹å¯ä»¥åšçš„ã€‚<br>æ¥ç€å°±åˆ°äº†åä¸€æœˆï¼Œç”±äºçœ‹åˆ°ç¾¤é‡Œæœ‰äººè®¨è®ºå°å­¦ç”Ÿè§£æ•°å­¦é¢˜çš„æ¯”èµ›ï¼Œå°±å»çœ‹äº†<a href="https://www.datafountain.cn/" target="_blank" rel="noopener">datafountain</a>ï¼Œç„¶åå°±å†™äº†<a href="https://www.datafountain.cn/competitions/474/datasets" target="_blank" rel="noopener">æˆ¿äº§è¡Œä¸šé—®ç­”åŒ¹é…æ¯”èµ›</a>çš„baselineï¼š<a href="https://github.com/xv44586/ccf_2020_qa_match" target="_blank" rel="noopener">ccf_2020_qa_match</a>, å…¶å®æ¯”èµ›åˆ°è¿™å°±ç»“æŸäº†ï¼Œæˆ‘å°±å»çœ‹è®ºæ–‡äº†ï¼Œç„¶è€Œæœ‰æ—¶å€™äº‹æƒ…å°±æ˜¯è¿™ä¹ˆå¥‡å¦™ï¼Œå¾ˆå¤šç¾¤é‡Œçš„åŒå­¦çœ‹åˆ°æˆ‘çš„baseline é‚€è¯·æˆ‘å»ç»„é˜Ÿï¼Œåæ¥ä¸å—å¤§çš„â€é’äººå°å“¥â€åˆ˜çŒ›ç»„é˜Ÿï¼Œæœ€ç»ˆæ‹¿äº†ç¬¬ä¸€è¿˜ã€‚ä¸è¿‡ç­”è¾©æ—¶å‘ç°ï¼Œåœ¨çœ‹è®ºæ–‡ä¸åšå®éªŒçš„çº¬åº¦ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥ä¹Ÿæ˜¯ç¬¬ä¸€äº†- - ï¼æ— è®ºå¦‚ä½•ï¼Œä¹Ÿè¦æ„Ÿè°¢ä¸€ä¸‹åˆ˜çŒ›å°å“¥ï¼Œä¸æ˜¯ä»–é‚€è¯·æˆ‘ï¼Œæˆ‘ä¹Ÿä¸ä¼šæ‹¿åˆ°è¿™ä¸ªé‡‘ç‰Œã€‚æ¯•ç«Ÿbaseline æˆ‘å†™è¿‡ä¸å°‘ï¼Œä½†æ˜¯çœŸçš„è®¤çœŸæ‰“åˆ°æœ€åè¿˜æ˜¯ç¬¬ä¸€æ¬¡ï½ï½</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå»å¹´å‘ç”Ÿäº†æ–°å† ï¼Œç›´åˆ°ç°åœ¨å¤§å®¶è¿˜æ˜¯å¤‡å—å›°æ‰°ï¼Œæˆ‘ä¸ªäººåº¦è¿‡äº†æœ€çˆ½çš„ä¸€ä¸ªå¹´å‡ï¼Œåœ¨NLP ä¸Šä¹Ÿæœ‰äº†å®è¶³çš„è¿›æ­¥ï¼Œä¸è¿‡ä¹Ÿæœ‰å¾ˆå¤šå¹´åˆçš„è®¡åˆ’æ²¡æœ‰å®Œæˆï¼Œæ¯”å¦‚æ¯å‘¨ä¸€ç¯‡blogï¼Œçœ‹å®ŒèŠ±ä¹¦ç­‰ã€‚</p><h1><span id="ying-xin">è¿æ–°</span><a href="#ying-xin" class="header-anchor"></a></h1><p><code>å‡¡äº‹é¢„åˆ™ç«‹ï¼Œä¸é¢„åˆ™åºŸã€‚</code>æ‰€ä»¥ï¼Œflagè¿˜æ˜¯è¦ç«‹çš„ï¼Œæ–°çš„ä¸€å¹´ï¼Œå¸Œæœ›è‡ªå·±æ›´å°‘ä¸€ç‚¹æµ®èºï¼Œåšäº‹èƒ½æ›´å¤šä¸€ç‚¹è¸å®ã€‚</p><ul><li>ç»å…¸è®ºæ–‡è¿˜æœ‰å¾ˆå¤šæ²¡è¯»ï¼Œæœ€æ–°çš„è®ºæ–‡åˆæºæºä¸æ–­ï¼Œæ‰€ä»¥å¸Œæœ›æ–°çš„ä¸€å¹´èƒ½æ‰¾åˆ°é€‚åˆè‡ªå·±çš„è¯»è®ºæ–‡èŠ‚å¥ã€‚</li><li>ä¸€å‘¨ä¸€ç¯‡blog å¯èƒ½å¤ªå›°éš¾äº†ï¼Œå¸Œæœ›èƒ½ä¸€å¹´å†™ä¸‰åç¯‡å§å°±</li><li>æ„Ÿæƒ…ä¸Šä¹Ÿè¦æ›´æˆç†Ÿä¸€äº›ï¼Œå¯¹æœªæ¥è¦æœ‰æ›´æ¸…æ™°çš„è§„åˆ’</li><li>æœ‰ç©ºå°±å¤šè¿åŠ¨</li></ul><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>æˆéƒ½æµ·æ´‹é¦†çš„å¯çˆ±ç™½é²¸</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Life" scheme="https://xv44586.github.io/categories/Life/"/>
    
    
  </entry>
  
  <entry>
    <title>ccfé—®ç­”åŒ¹é…æ¯”èµ›ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•åªç”¨â€œbertâ€å¤ºå† </title>
    <link href="https://xv44586.github.io/2021/01/20/ccf-qa-2/"/>
    <id>https://xv44586.github.io/2021/01/20/ccf-qa-2/</id>
    <published>2021-01-20T12:39:29.000Z</published>
    <updated>2021-02-24T01:00:00.120Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#qian-yan">å‰è¨€</a><ul><li><a href="#sai-ti">èµ›é¢˜</a></li><li><a href="#qa-pair">QA pair</a></li><li><a href="#qa-point">QA Point</a></li><li><a href="#pattern-exploiting-training-pet">Pattern-Exploiting Training (PET)</a></li><li><a href="#concat">Concat</a></li><li><a href="#focal-loss">focal loss</a></li><li><a href="#dui-kang-xun-lian">å¯¹æŠ—è®­ç»ƒ</a></li><li><a href="#post-training">post training</a></li></ul></li><li><a href="#post-training">Post Training</a><ul><li><a href="#mlm">MLM</a></li><li><a href="#nsp">nsp</a></li><li><a href="#model-adaptive">model-adaptive</a></li><li><a href="#geng-xin-ci-shu">æ›´æ–°æ¬¡æ•°</a></li><li><a href="#zui-zhong-jie-guo">æœ€ç»ˆç»“æœ</a></li></ul></li><li><a href="#rong-ru-zhi-shi">èå…¥çŸ¥è¯†</a></li><li><a href="#dui-bi-xue-xi">å¯¹æ¯”å­¦ä¹ </a><ul><li><a href="#fei-jian-du-dui-bi-xue-xi">éç›‘ç£å¯¹æ¯”å­¦ä¹ </a></li><li><a href="#jian-du-dui-bi-xue-xi">ç›‘ç£å¯¹æ¯”å­¦ä¹ </a></li><li><a href="#shi-yan-jie-guo">å®éªŒç»“æœ</a></li></ul></li><li><a href="#shu-ju-zeng-qiang">æ•°æ®å¢å¼º</a><ul><li><a href="#eda">EDA</a></li><li><a href="#wei-biao-qian">ä¼ªæ ‡ç­¾</a></li><li><a href="#shi-yan-jie-guo-1">å®éªŒç»“æœ</a></li></ul></li><li><a href="#zi-zheng-liu">è‡ªè’¸é¦</a></li><li><a href="#shuffle-jie-ma">shuffle è§£ç </a></li><li><a href="#mo-xing-rong-he">æ¨¡å‹èåˆ</a></li><li><a href="#shi-yan-zong-jie">å®éªŒæ€»ç»“</a></li><li><a href="#bi-sai-jie-guo">æ¯”èµ›ç»“æœ</a></li><li><a href="#dai-ma">ä»£ç </a></li><li><a href="#zui-hou">æœ€å</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div><br>ccfé—®ç­”åŒ¹é…æ¯”èµ›ä¹Ÿç»“æŸäº†ä¸€æ®µæ—¶é—´äº†ï¼Œè¿™ç¯‡ç®—æ˜¯ä¸€ä¸ªä¸‹ç¯‡å§ï¼Œæ€»ç»“ä¸€ä¸‹åæœŸä¼˜ï¼ˆå¤ºï¼‰åŒ–ï¼ˆå† ï¼‰çš„å¿ƒè·¯å†ç¨‹ã€‚æ ‡é¢˜ä¸­çš„â€œbertâ€æŒ‡çš„æ˜¯bert-baseç³»åˆ—æ¨¡å‹ï¼ŒåŒ…æ‹¬bert/RoBERTa/NEZHA/MacBERT/ERNIEç­‰ï¼Œè€Œå–è¿™ä¸ªæœ‰ç‚¹â€œæ ‡é¢˜å…šâ€çš„æ ‡é¢˜çš„ä¸»è¦åŸå› ï¼Œä¹Ÿæ˜¯å¯¹ç­”è¾©çœ‹åˆ°æœ‰äº›å›¢é˜Ÿä½¿ç”¨çš„bert+xgbè¿™ç§â€œå¤§åŠ›å‡ºå¥‡è¿¹â€åšæ³•åä¸ªæ§½ã€‚</p><h1><span id="qian-yan">å‰è¨€</span><a href="#qian-yan" class="header-anchor"></a></h1><p>åœ¨<a href="https://xv44586.github.io/2020/11/08/ccf-qa/">ä¸Šä¸€ç¯‡</a>ä¸­,ç¬”è€…å¯¹æ¯”èµ›åšäº†ç®€å•è¯´æ˜ï¼Œæå‡ºäº†å››ç§baselineï¼ˆQA Pair/QA Point/PET/Concat),å¹¶åšäº†éƒ¨åˆ†å°è¯•ï¼ˆfocal loss/å¯¹æŠ—è®­ç»ƒ/æ¢¯åº¦æƒ©ç½š/kfold/post training),æ²¡çœ‹è¿‡çš„åŒå­¦å¯ä»¥å…ˆçœ‹ä¸Šç¯‡ï¼Œè¿™é‡Œåªç®€å•å†ä»‹ç»ä¸€ä¸‹ï¼š</p><h2><span id="sai-ti">èµ›é¢˜</span><a href="#sai-ti" class="header-anchor"></a></h2><p>æœ¬æ¬¡èµ›é¢˜çš„ä»»åŠ¡æ˜¯ï¼šç»™å®šIMäº¤æµç‰‡æ®µï¼Œç‰‡æ®µåŒ…å«ä¸€ä¸ªå®¢æˆ·é—®é¢˜ä»¥åŠéšåçš„ç»çºªäººè‹¥å¹²IMæ¶ˆæ¯ï¼Œä»è¿™äº›éšåçš„ç»çºªäººæ¶ˆæ¯ä¸­æ‰¾å‡ºä¸€ä¸ªæ˜¯å¯¹å®¢æˆ·é—®é¢˜çš„å›ç­”ã€‚</p><ul><li>æ•°æ®ç¤ºä¾‹<br>$$<br>\begin{array}{c|c|c|c|c}<br>\hline<br>\text{å¯¹è¯id} &amp;  \text{å®¢æˆ·é—®é¢˜} &amp; \text{ç»çºªäººå›å¤id} &amp; \text{ç»çºªäººå›å¤å†…å®¹} &amp; \text{å›å¤æ ‡ç­¾} \\<br>\hline<br>1 &amp; \text{æ‚¨å¥½ï¼Œè¯·é—®è¿™ä¸ªæˆ·å‹æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹} &amp; 1 &amp; \text{ä½ æ˜¯æƒ³çœ‹çœ‹è¿™å¥—æˆ¿å­æ˜¯å—} &amp; 0 \\<br>\hline<br>&amp; &amp; \text{2} &amp; \text{åœ¨çš„} &amp;\text{0} \\<br>\hline<br>&amp; &amp; \text{3} &amp; \text{æ­¤æˆ¿æˆ¿å‹æ–¹æ­£ å¾—æˆ¿ç‡é«˜ å¤šå±‚ä¸å¸¦ç”µæ¢¯4/6æ¥¼<br>} &amp;\text{1} \\<br>\hline<br>\end{array}<br>$$</li><li>è¯„æµ‹æ ‡å‡†</li></ul><p>f1ï¼š2 * (ç²¾åº¦ * å¬å›) / (ç²¾åº¦ + å¬å›)</p><h2><span id="qa-pair">QA pair</span><a href="#qa-pair" class="header-anchor"></a></h2><p>ç”±äºå›ç­”åˆ—è¡¨æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥ä¸è€ƒè™‘é—®ç­”ä¹‹é—´çš„é¡ºåºå…³ç³»ï¼Œå°†å…¶æ‹†åˆ†ä¸ºquery-answer pairï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ã€‚<br><img src="/2021/01/20/ccf-qa-2/pair.png" alt="pair"></p><h2><span id="qa-point">QA Point</span><a href="#qa-point" class="header-anchor"></a></h2><p>è€ƒè™‘å¯¹è¯è¿è´¯æ€§ã€ç›¸å…³æ€§ï¼Œå°†æ‰€æœ‰å›ç­”é¡ºåºæ‹¼æ¥åå†ä¸é—®é¢˜æ‹¼æ¥ï¼Œç»„æˆquery-answer listï¼Œæ¨¡å‹å¯¹ä¸€ä¸ªé—®é¢˜çš„æ‰€æœ‰ç­”æ¡ˆè¿›è¡Œé¢„æµ‹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ç»™æ¨¡å‹å¢åŠ äº†â€œå¤§å±€è§‚â€ï¼Œå³æ–°å¢ä¸€ä¸ªä»»åŠ¡æ¥é¢„æµ‹å…¨å±€æ‰€æœ‰å›ç­”ä¸­æ˜¯å¦å­˜åœ¨labelä¸º 1 çš„å›ç­”ã€‚<br><img src="/2021/01/20/ccf-qa-2/point.png" alt="point"></p><h2><span id="pattern-exploiting-training-pet">Pattern-Exploiting Training (PET)</span><a href="#pattern-exploiting-training-pet" class="header-anchor"></a></h2><p>æ­¤æ–¹æ¡ˆé€šè¿‡å¢åŠ ä¸€ä¸ªpatternï¼Œå°†ä»»åŠ¡è½¬æ¢ä¸ºMLMä»»åŠ¡ï¼Œç„¶åé€šè¿‡patternçš„å¾—åˆ†æ¥åˆ¤æ–­å¯¹åº”çš„ç±»åˆ«ã€‚<br>å¦‚æœ¬æ¬¡æ¯”èµ›å¯ä»¥æ·»åŠ ä¸€ä¸ªå‰ç¼€patternï¼šâ€œé—´æ¥å›ç­”é—®é¢˜â€/ â€œç›´æ¥å›ç­”é—®é¢˜â€ï¼Œåˆ†åˆ«å¯¹åº”label 0 / 1ï¼Œpatternçš„å¾—åˆ†åªéœ€çœ‹ç¬¬ä¸€ä¸ªä½ç½®ä¸­â€œé—´â€/â€œç›´â€ä¸¤ä¸ªtokençš„æ¦‚ç‡è°é«˜å³å¯ã€‚å¯¹äºunlabel dataï¼Œå¯ä»¥ä¸å¢åŠ pattern è¿›è¡Œmlmä»»åŠ¡ï¼Œè¿™ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦å¢åŠ äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œé€šè¿‡å¤šä¸ªä¸åŒpatternè¿›è¡Œèåˆä¹Ÿèƒ½è¿›ä¸€æ­¥æé«˜å…¶æ€§èƒ½ã€‚<br><img src="/2021/01/20/ccf-qa-2/pet.png" alt="pet"></p><h2><span id="concat">Concat</span><a href="#concat" class="header-anchor"></a></h2><p>ç”±äºbert ä¸­ä¸åŒçš„transformer å±‚æå–åˆ°çš„è¯­ä¹‰ç²’åº¦ä¸åŒï¼Œè€Œä¸åŒç²’åº¦çš„ä¿¡æ¯å¯¹åˆ†ç±»æ¥è¯´èµ·åˆ°çš„ä½œç”¨ä¹Ÿå¯èƒ½ä¸åŒï¼Œæ‰€ä»¥å¯ä»¥å°†æ‰€æœ‰ç²’åº¦çš„è¯­ä¹‰ä¿¡æ¯æ‹¼æ¥åä½œä¸ºç‰¹å¾è¿›è¡Œåˆ†ç±»ã€‚<br><img src="/2021/01/20/ccf-qa-2/concat.png" alt="concat"></p><h2><span id="focal-loss">focal loss</span><a href="#focal-loss" class="header-anchor"></a></h2><p>ç”±äºé’ˆå¯¹æ€§å›ç­”ä¸éé’ˆå¯¹æ€§å›ç­”åœ¨æ•°é‡ä¸Šæœ‰ä¸å°å·®è·ï¼Œå¤§çº¦3:1ï¼Œæ‰€ä»¥ä¹Ÿæƒ³åˆ°å°è¯•åœ¨lossä¸Šè¿›è¡Œè°ƒèŠ‚ã€‚<br>æœ€ç»ˆç»“æœæ˜¯æ²¡æœ‰å¤šå°‘æå‡ï¼ŒçŒœæµ‹æ ·æœ¬ä¸å‡è¡¡çš„é—®é¢˜å½±å“æ˜¯éå¸¸å°çš„ï¼Œæ‰€ä»¥å°†Binary-Crossentropyè®­ç»ƒåçš„æ¨¡å‹åœ¨train dataä¸Šè¿›è¡Œäº†predictï¼Œå¹¶å€Ÿé‰´ä¹‹å‰<a href="https://xv44586.github.io/2020/10/14/focal-loss/">focal loss</a>ä¸­çš„æ–¹å¼åˆ†æäº†ä¸€ä¸‹ï¼Œç”»å‡ºå¯¹åº”çš„éš¾æ˜“æ ·æœ¬åˆ†å¸ƒã€‚æ ¹æ®å›¾å½¢ä¸Šçš„åˆ†å¸ƒç»“æœï¼Œä¹Ÿè¯å®äº†ä¹‹å‰çš„çŒœæµ‹ã€‚<br><img src="/2021/01/20/ccf-qa-2/focalloss.png" alt="focalloss"></p><h2><span id="dui-kang-xun-lian">å¯¹æŠ—è®­ç»ƒ</span><a href="#dui-kang-xun-lian" class="header-anchor"></a></h2><p>å¯¹æŠ—è®­ç»ƒä¸»è¦å°è¯•äº†<a href="https://kexue.fm/archives/7234" target="_blank" rel="noopener">FGM æ–¹æ³•å¯¹Embeddingè¿›è¡Œæ‰°åŠ¨</a>ï¼Œçº¿ä¸‹å¯¹æ¯”æå‡å¤§çº¦ä¸€ä¸ªç‚¹ä¸Šä¸‹ã€‚<br>çº¿ä¸‹æµ‹è¯•ç»“æœï¼š</p><p>$$<br>\begin{array}{c|c}<br>\hline<br>\text{without adt} &amp; \text{with adt} \\<br>\hline<br>\text{0.831} &amp; \text{0.838} \\<br>\end{array}<br>$$</p><h2><span id="post-training">post training</span><a href="#post-training" class="header-anchor"></a></h2><p>ä¸Šä¸€ç¯‡ä¸­ï¼Œæåˆ°post training åšçš„æ•ˆæœä¸å¥½ï¼Œç„¶è€Œpet çš„æ•ˆæœåˆå¾ˆå¥½ï¼Œä¸¤è€…æ¯”è¾ƒçŸ›ç›¾ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿé‡æ–°é˜…è¯»äº†å‡ ç¯‡å…³äºä¼˜åŒ–bert ä¸post training ç›¸å…³çš„è®ºæ–‡ï¼Œé‡æ–°æ€è€ƒäº†ä¸€ä¸‹ï¼Œè¿™ç¯‡å°±ä»é‡æ–°åšpost trainingå¼€å§‹ã€‚</p><h1><span id="post-training">Post Training</span><a href="#post-training" class="header-anchor"></a></h1><p>post trainingä¸€èˆ¬åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šDomain-Adaptive training å’Œ Task-Adaptive trainingï¼Œé€šè¿‡åœ¨åŒé¢†åŸŸä¸ä»»åŠ¡æ•°æ®ä¸Šç»§ç»­é¢„è®­ç»ƒï¼Œå¯ä»¥è®©æ¨¡å‹æ›´é€‚åº”ä»»åŠ¡ï¼Œæœ‰åˆ©äºæé«˜æ¨¡å‹åœ¨ä¸‹æ¸¸çš„æ€§èƒ½ã€‚è€Œbert åœ¨è®­ç»ƒæ—¶ä¸»è¦æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼šmlm ä¸nsp ï¼Œæ¥ä¸‹æ¥é’ˆå¯¹æ¯ä¸ªä»»åŠ¡è¿›è¡Œè®¨è®ºã€‚</p><h2><span id="mlm">MLM</span><a href="#mlm" class="header-anchor"></a></h2><p>åœ¨post training é˜¶æ®µå°è¯•è¿›ä¸€æ­¥ä¼˜åŒ–çš„åªæ‰¾åˆ°åˆ˜çŸ¥è¿œè€å¸ˆçš„<a href="https://arxiv.org/abs/2004.09733" target="_blank" rel="noopener">Train No Evil: Selective Masking for Task-Guided Pre-Training</a>ï¼Œè®ºæ–‡é‡Œçš„æ€è·¯æ˜¯é€šè¿‡å»ºç«‹ä¸€ä¸ªäºŒåˆ†ç±»æ¨¡å‹ï¼Œæ¥æœ‰é’ˆå¯¹æ€§çš„é€‰æ‹©token æ¥è¿›è¡Œmaskï¼Œä¸è¿‡ç”±äºè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ä¸‰ä¸ªä¸­é—´æ¨¡å‹ï¼Œæ‰€ä»¥æ²¡æœ‰å°è¯•ï¼Œä¸è¿‡è¿™ä¸ªè®ºæ–‡ç»™å‡ºäº†ä¸€ä¸ªç»“è®ºï¼šåœ¨ç»§ç»­é¢„è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œä¼˜åŒ–mask ç­–ç•¥ï¼Œæ˜¯å¯ä»¥è¿›ä¸€æ­¥æé«˜ä¸‹æ¸¸æ€§èƒ½çš„ã€‚<br>è®©æˆ‘ä»¬å›å½’ä¸€ä¸‹bert çš„mask ç­–ç•¥å³åç»­çš„æ”¹è¿›ï¼š<br>$$<br>\begin{array}{c|c|}<br>\hline<br>\text{model} &amp; \text{mask sstrategy} \\<br>\hline<br>\text{bert} &amp; \text{random mask} \\<br>\hline<br>\text{RoBERTa} &amp; \text{dynamic mask} \\<br>\hline<br>\text{RoBERTa-wwm-ext} &amp; \text{whole word mask} \\<br>\hline<br>\text{ERNIE} &amp; \text{entity/phrase mask} \\<br>\hline<br>\text{SpanBERT} &amp; \text{n-gram mask}\\<br>\hline<br>\end{array}<br>$$</p><p>è¿™é‡Œç¬”è€…æ€è€ƒåè®¤ä¸ºï¼Œä¸åŒçš„mask ç­–ç•¥æœ¬è´¨åŒºåˆ«æ˜¯å¯¹æ›´å¤šçš„â€œå›ºå®šæ­é…â€è¿›è¡ŒåŒæ—¶maskï¼Œä»è€Œé™ä½æ¨¡å‹å¯¹å±€éƒ¨ã€æµ…å±‚ä¿¡æ¯çš„è¿‡æ‹Ÿåˆï¼Œå¢åŠ ä»»åŠ¡çš„éš¾åº¦ï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚<br>æ‰€è°“â€œå›ºå®šæ­é…â€ï¼Œä¸ä»…ä»…åŒ…å«è¯ï¼Œæˆ–è€…è¯´æ˜¯æ›´å¹¿ä¹‰çš„â€œè¯â€ã€‚å­—çš„å›ºå®šæ­é…å¯ä»¥æ„æˆè¯ï¼Œè¿›ä¸€æ­¥å›ºå®šæ­é…åˆå¯ä»¥å½¢æˆçŸ­è¯­ã€‚æ¯”å¦‚è€ƒè™‘â€œå¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šâ€ï¼Œâ€œ08åŒ—äº¬å¥¥è¿ä¼šâ€ï¼Œå¦‚æœåªmask å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œæ˜¯æ¯”è¾ƒâ€œå®¹æ˜“â€é€šè¿‡å‰©ä½™çš„éƒ¨åˆ†æ¥è¿˜åŸçš„ã€‚<br>æ—¢ç„¶â€œå›ºå®šæ­é…â€æ˜¯æ›´å¹¿ä¹‰çš„è¯ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ¥æŒ–æ˜è¿™äº›â€œå›ºå®šæ­é…â€äº†ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æ–°è¯/çŸ­è¯­æŒ–æ˜ï¼Œè€Œæ–°è¯/çŸ­è¯­æŒ–æ˜æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯è®¡ç®—å·¦å³ç†µå’Œç´§å¯†åº¦ï¼Œä¸è¿‡è¿™ç§æ–¹å¼è®¡ç®—é‡è¾ƒå¤§ï¼Œè¿™æ¬¡æ¯”èµ›ç¬”è€…èˆå¼ƒäº†è¿™ç§æ–¹å¼ï¼Œé‡‡ç”¨å€Ÿé‰´è‹ç¥çš„åšå®¢<a href="https://kexue.fm/archives/5476" target="_blank" rel="noopener">æœ€å°ç†µåŸç†ï¼ˆäºŒï¼‰ï¼šâ€œå½“æœºç«‹æ–­â€ä¹‹è¯åº“æ„å»º</a>ä¸­çš„æ€è·¯ï¼Œç”¨PMIè¡¨å¾ç´§å¯†åº¦ï¼Œç”¨ç›¸é‚»ä¸¤ä¸ªå­—ä¹‹é—´çš„ç´§å¯†åº¦åˆ¤æ–­ä¸¤è€…æ˜¯å¦å­˜åœ¨â€œå›ºå®šæ­é…â€,æœ€ç»ˆæœªè¢«åˆ‡åˆ†çš„ä¸ºä¸€ä¸ªæ•´ä½“ã€‚æœ€åå°†æŒ–æ˜å‡ºçš„æ–°è¯é€šè¿‡jieba è¿‡æ»¤æ‰å·²åœ¨è¯åº“å†…çš„ï¼Œå¹¶åªä¿ç•™é•¿åº¦2~5çš„æ–°è¯ï¼Œæ·»åŠ åˆ°jiebaçš„è¯åº“å†…ã€‚è¿™é‡Œé€‰æ‹©ç”¨jieba åšåˆ†è¯å·¥å…·çš„åŸå› æ˜¯å› ä¸ºç¬”è€…ç”¨çš„æ˜¯NEZHAï¼Œè€ŒNEZHAåœ¨è®­ç»ƒæ—¶ä½¿ç”¨çš„å°±æ˜¯jieba å¤„ç†çš„æ•°æ®ï¼Œè¿™é‡Œä¸ä»–ä¿æŒä¸€è‡´ï¼Œè€Œé•¿åº¦é€‰æ‹©ä¸Šï¼Œä¸»è¦å€Ÿé‰´spanBertä¸­çš„ç»“è®ºã€‚<br>æœ€åæŒ–æ˜äº†2736ä¸ªæ–°è¯ï¼Œè€Œå¦‚æœæ˜¯å®é™…å·¥ä½œä¸­ï¼Œåˆ™å¯ä»¥è¿›ä¸€æ­¥å°†ç§¯ç´¯çš„è¯ä¹ŸåŠ å…¥ã€‚<br><img src="/2021/01/20/ccf-qa-2/new_words.png" alt="new_words"><br>ä»¥ä¸Šçš„æ–¹å¼ä¸­å…¨ç¨‹æ²¡æœ‰äººä¸ºå‚ä¸ï¼Œæ‰€ä»¥æ–°è¯çš„è´¨é‡æ˜¯æ— æ³•ä¿è¯çš„ï¼Œå³å­˜åœ¨è¯çš„è¾¹ç•Œä¸å‡†ç¡®ã€‚è€Œæ­¤æ—¶çš„å…¨è¯mask é€€åŒ–ä¸ºn-gram maskï¼Œä¾ç„¶æ˜¯ä¸€ç§æœ‰æ•ˆçš„æå‡æ–¹æ¡ˆã€‚</p><h2><span id="nsp">nsp</span><a href="#nsp" class="header-anchor"></a></h2><p>åŸå§‹bert åœ¨è®­ç»ƒæ—¶ï¼Œå¥å­çº§åˆ«çš„ä»»åŠ¡ä¸ºnspï¼Œè€ŒRoBERTa ä¸­ç»™å‡ºçš„ç»“è®ºæ˜¯å¥å­çº§åˆ«çš„ä»»åŠ¡æ²¡ä»€ä¹ˆç”¨ï¼Œæ‰€ä»¥å–æ¶ˆäº†å¥å­çº§åˆ«çš„ä»»åŠ¡ï¼›è€Œalbert ä¸­åˆ™å°†å¥å­çº§åˆ«çš„ä»»åŠ¡åˆ‡æ¢ä¸ºsopï¼Œè€ŒSpanBERTä¸­åˆ™åˆ‡æ¢ä¸ºsboã€‚è¿™é‡Œç¬”è€…è®¤ä¸ºä¸‹æ¸¸ä»»åŠ¡æ˜¯å¥å­çº§åˆ«çš„åˆ†ç±»ä»»åŠ¡ï¼Œæ‰€ä»¥å¥å­çº§åˆ«çš„ä»»åŠ¡æ˜¯æœ‰ç”¨çš„ï¼Œä¸è¿‡ç”±äºnsp ä¼šå¼•å…¥å¤§é‡å™ªéŸ³ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©sop/aopï¼šåœ¨qa pairæ ¼å¼çš„æ ·æœ¬ä¸‹äº’æ¢qa(sop)ï¼Œåœ¨q a-listæ ¼å¼çš„æ ·æœ¬ä¸‹ï¼Œä¿æŒquery åœ¨æœ€å‰é¢ï¼Œåªshuffle a-list(aop)ã€‚</p><p>$$<br>\begin{array}{c|c|c}<br>\hline<br> &amp; \text{without sop/aop} &amp; \text{with sop/aop} \\<br>\hline<br>\text{qa pair} &amp; \text{0.784} &amp; \text{0.79} \\<br>\hline<br>\text{q a-list} &amp; \text{0.799} &amp; \text{0.802} \\<br>\hline<br>\end{array}<br>$$</p><h2><span id="model-adaptive">model-adaptive</span><a href="#model-adaptive" class="header-anchor"></a></h2><p>ç”±äºæ ·æœ¬çš„ç»„ç»‡æ–¹å¼æœ‰qa pair å’Œ q a-listä¸¤ç§æ–¹å¼ï¼Œè€Œtask ç›¸å…³çš„æ•°æ®æ˜¯ç›¸å¯¹è¾ƒå°çš„ï¼Œæ‰€ä»¥è¿™é‡Œç¬”è€…è®¤ä¸ºä¸¤ä¸ªé˜¶æ®µçš„æ ·æœ¬ç»„ç»‡æ–¹å¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¼šæ›´å¥½ï¼Œå³ï¼šç”¨qa pairæ ¼å¼post trainingåçš„æ¨¡å‹ï¼Œæ¥å¾®è°ƒqa pairæ ¼å¼çš„baselineï¼Œq a-listæ ¼å¼post trainingåçš„æ¨¡å‹å¾®è°ƒq a-listæ ¼å¼çš„baselineã€‚</p><h2><span id="geng-xin-ci-shu">æ›´æ–°æ¬¡æ•°</span><a href="#geng-xin-ci-shu" class="header-anchor"></a></h2><p>è¿™é‡Œå‚è€ƒé‚±é”¡é¹è€å¸ˆçš„<a href="http://arxiv.org/abs/1905.05583" target="_blank" rel="noopener">How to Fine-Tune BERT for Text Classification?</a>ï¼Œå®éªŒæ—¶æ¯10 ä¸ªepochsä¿å­˜ä¸€æ¬¡æ¨¡å‹ï¼Œæœ€åé€šè¿‡åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„è¡¨ç°ï¼Œå¾—å‡ºä¸è®ºæ–‡ä¸­åŸºæœ¬ä¸€è‡´çš„ç»“è®ºï¼šæ›´æ–°10K stepså·¦å³æ¨¡å‹åœ¨ä¸‹æ¸¸çš„è¡¨ç°æ˜¯æœ€å¥½çš„ã€‚<br><img src="/2021/01/20/ccf-qa-2/update.png" alt="update"></p><h2><span id="zui-zhong-jie-guo">æœ€ç»ˆç»“æœ</span><a href="#zui-zhong-jie-guo" class="header-anchor"></a></h2><p>$$<br>\begin{array}{c|c|c}<br>\hline<br> \text{post-train/fine-tuning}&amp; \text{pair} &amp; \text{point} \\<br>\hline<br>\text{pair} &amp; \text{0.79} &amp; \text{0.794} \\<br>\hline<br>\text{point} &amp; \text{0.786} &amp; \text{0.802} \\<br>\hline<br>\end{array}<br>$$</p><p>æ­¤æ—¶æˆ‘ä»¬è®¤ä¸ºå·²ç»å°†bertçš„èƒ½åŠ›æœ€å¤§åŒ–äº†ï¼Œäºæ˜¯è¿™é‡Œä¹Ÿå°è¯•äº†åœ¨bert åé¢æ¥ä¸€äº›å¤æ‚çš„åˆ†ç±»å±‚ï¼ˆcnn/rnn/dgcnn/..),å‘ç°éƒ½æ— æ³•è¿›ä¸€æ­¥æé«˜ï¼Œæ‰€ä»¥ä¹Ÿè¯å®äº†ä¹‹å‰çš„åˆ¤æ–­ã€‚</p><h1><span id="rong-ru-zhi-shi">èå…¥çŸ¥è¯†</span><a href="#rong-ru-zhi-shi" class="header-anchor"></a></h1><p>æ—¢ç„¶ä»â€œå†…éƒ¨â€å·²ç»æ— æ³•è¿›ä¸€æ­¥æé«˜bertçš„èƒ½åŠ›ï¼Œæ‰€ä»¥æ­¤æ—¶å°è¯•èå…¥å¤–éƒ¨çŸ¥è¯†æ¥å¢å¼ºã€‚è€Œèåˆçš„æ–¹å¼ä¸»è¦å°è¯•äº†ä¸¤ç§ï¼š  </p><ul><li><p>æœ€åº•å±‚æ³¨å…¥<br>åœ¨Embedding å±‚èå…¥å¤–éƒ¨çš„embeddingã€‚ä¼˜ç‚¹ï¼šæ›´å¤šçš„äº¤äº’<br><img src="/2021/01/20/ccf-qa-2/inside.png" alt> </p></li><li><p>æœ€é¡¶å±‚æ³¨å…¥<br>åœ¨transformer output å±‚èå…¥å¤–éƒ¨Embeddingã€‚ä¼˜ç‚¹ï¼šæ›´çµæ´»ï¼Œä¸å±€é™å¤–éƒ¨çŸ¥è¯†çš„å½¢å¼ï¼ˆå¯ä»¥æ˜¯Embeddingï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å…¶ä»–ç‰¹å¾ï¼Œå¦‚æ‰‹å·¥ç‰¹å¾ï¼‰ã€‚<br><img src="/2021/01/20/ccf-qa-2/outside.png" alt></p></li></ul><p>åœ¨çŸ¥è¯†é€‰æ‹©ä¸Šï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯Graph EMbeddingï¼Œå‚è€ƒ<a href="http://arxiv.org/abs/2004.05707" target="_blank" rel="noopener">VGCN-BERT: Augmenting BERT with Graph Embedding for Text Classification</a>,æˆ‘ä»¬é‡è·‘äº†ä¸€ä¸‹è®ºæ–‡çš„ä»£ç ï¼Œå‘ç°æ— æ³•é‡ç°å…¶ä¸­çš„ç»“è®ºï¼Œè€Œæˆ‘å¯¹Graph Embeddingä¹Ÿä¸ç†Ÿï¼Œæ‰€ä»¥æ”¾å¼ƒäº†è¿™ä¸ªæ–¹æ¡ˆã€‚<br>ç„¶åå°è¯•ç®€å•çš„embeddingï¼Œå³ç”¨gensim åœ¨task dataä¸Šè®­ç»ƒäº†ä¸€ç‰ˆè¯å‘é‡(dims=100),ä½œä¸ºå¤–éƒ¨çŸ¥è¯†æ¥å®éªŒã€‚<br>çº¿ä¸‹æµ‹è¯•ç»“æœï¼š<br>$$<br>\begin{array}{c|c}<br>\hline<br> \text{model} &amp; \text{score} \\<br>\hline<br>\text{bert} &amp; \text{0.831} \\<br>\hline<br>\text{external-embedding bottom} &amp; \text{0.82} \\<br>\hline<br>\text{external-embedding top} &amp; \text{0.83} \\<br>\hline<br>\end{array}<br>$$</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç§æ–¹å¼éƒ½æ˜¯æ— æ³•è¿›ä¸€æ­¥æé«˜çš„ï¼Œä¸»è¦åŸå› å¯èƒ½æ˜¯ï¼š1.è¯å‘é‡çš„è´¨é‡è¾ƒå·®ï¼›2.è¯å‘é‡ä¹Ÿæ˜¯bertçš„â€œå†…éƒ¨â€çŸ¥è¯†ï¼›3.èå…¥çš„æ–¹å¼æˆ–è€…è°ƒå‚æ²¡åšå¥½ã€‚</p><h1><span id="dui-bi-xue-xi">å¯¹æ¯”å­¦ä¹ </span><a href="#dui-bi-xue-xi" class="header-anchor"></a></h1><p>åœ¨æ¨¡å‹ä¸Šï¼Œè¿˜èƒ½é€šè¿‡å¢åŠ æ–°çš„ä»»åŠ¡æ¥å°è¯•æé«˜æ€§èƒ½ã€‚è€Œä»Šå¹´æ¯”è¾ƒçƒ­çš„ä¸€ä¸ªæ€è·¯å°±æ˜¯å¯¹æ¯”å­¦ä¹ ï¼Œæ‰€ä»¥è¿™é‡Œå°è¯•é€šè¿‡å¢åŠ ä¸€ä¸ªå¯¹æ¯”å­¦ä¹ ä»»åŠ¡æ¥æé«˜æ€§èƒ½ã€‚<br>å¯¹æ¯”å­¦ä¹ çš„ä¸»è¦æ€è·¯æ˜¯æ‹‰è¿‘åˆ°æ­£æ ·æœ¬ä¹‹é—´çš„è·ç¦»ï¼Œæ‹‰è¿œåˆ°è´Ÿæ ·æœ¬ä¹‹é—´çš„è·ç¦»ã€‚<br><img src="/2021/01/20/ccf-qa-2/cl.png" alt><br>å¯¹æ¯”å­¦ä¹ ä¸»è¦åˆåˆ†ä¸ºä¸¤ç§ï¼šç›‘ç£å¯¹æ¯”å­¦ä¹ å’Œåˆ†ç›‘ç£å¯¹æ¯”å­¦ä¹ ã€‚ç›‘ç£å¯¹æ¯”å­¦ä¹ ä¸­ï¼Œå°†ç›¸åŒlabelçš„æ ·æœ¬çœ‹åšæ˜¯æ­£ä¾‹ï¼Œå…¶ä»–çš„ä¸ºè´Ÿä¾‹ï¼›è€Œéç›‘ç£å¯¹æ¯”å­¦ä¹ ä¸­ï¼Œåˆ™é€šè¿‡å¯¹æ¯ä¸ªæ ·æœ¬æ„é€ ä¸€å¯¹viewï¼Œviewä¹‹é—´äº’ä¸ºæ­£ä¾‹ï¼Œå…¶ä»–çš„ä¸ºè´Ÿä¾‹ã€‚</p><h2><span id="fei-jian-du-dui-bi-xue-xi">éç›‘ç£å¯¹æ¯”å­¦ä¹ </span><a href="#fei-jian-du-dui-bi-xue-xi" class="header-anchor"></a></h2><p>éç›‘ç£å¯¹æ¯”å­¦ä¹ ä¸­ï¼Œé€šè¿‡äº’æ¢QAä½ç½®ï¼ŒåŒæ—¶éšæœºmask 15% çš„tokenï¼Œæ¥æ„é€ ä¸€å¯¹viewã€‚</p><ul><li>å¯¹åº”çš„lossï¼š</li></ul><p><img src="/2021/01/20/ccf-qa-2/sscl.png" alt></p><ul><li>å¯¹åº”çš„æ¨¡å‹ï¼š</li></ul><p><img src="/2021/01/20/ccf-qa-2/sscl-model.png" alt></p><h2><span id="jian-du-dui-bi-xue-xi">ç›‘ç£å¯¹æ¯”å­¦ä¹ </span><a href="#jian-du-dui-bi-xue-xi" class="header-anchor"></a></h2><p>è¿™é‡Œä¸»è¦follow <a href="http://arxiv.org/abs/2011.01403" target="_blank" rel="noopener">Supervised Contrastive Learning for Pre-trained Language Model Fine-tuning</a>,ä¿®æ”¹å¯¹åº”loss.</p><ul><li>loss</li></ul><p><img src="/2021/01/20/ccf-qa-2/scl.png" alt></p><ul><li>model</li></ul><p><img src="/2021/01/20/ccf-qa-2/sc-model.png" alt></p><h2><span id="shi-yan-jie-guo">å®éªŒç»“æœ</span><a href="#shi-yan-jie-guo" class="header-anchor"></a></h2><ul><li>çº¿ä¸‹ç»“æœï¼š</li></ul><p>$$<br>\begin{array}{c|c}<br>\hline<br> \text{model} &amp; \text{score} \\<br>\hline<br>\text{bert} &amp; \text{0.831} \\<br>\hline<br>\text{self-supervised contrastive learning} &amp; \text{0.80} \\<br>\hline<br>\text{supervised contrastive learning} &amp; \text{0.824} \\<br>\hline<br>\end{array}<br>$$</p><ul><li><p>éç›‘ç£å¯¹æ¯”å­¦ä¹ ç»“æœå¯è§†åŒ–<br><img src="/2021/01/20/ccf-qa-2/ssc-vis.png" alt></p></li><li><p>ç›‘ç£å¯¹æ¯”å­¦ä¹ ç»“æœå¯è§†åŒ–<br><img src="/2021/01/20/ccf-qa-2/sc-vis.png" alt></p></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç§æ–¹å¼éƒ½æ²¡æœ‰å¸¦æ¥æå‡ï¼Œè€Œå¯è§†åŒ–å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œéç›‘ç£å¯¹æ¯”å­¦ä¹ çš„æ•ˆæœå¹¶ä¸å¥½ï¼Œå­˜åœ¨å¤§é‡é‡å ä½†é¢œè‰²ä¸åŒçš„ç‚¹ï¼Œè¯´æ˜å¯¹æ¯”å­¦ä¹ ä»»åŠ¡çš„ç»“æœä¸å¥½ï¼Œè¿™é‡Œçš„åŸå› çŒœæµ‹ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š1.æ¨¡å‹çš„è®¾è®¡ä¸è°ƒå‚æ—¶æœ‰é—®é¢˜ï¼Œbatch sizeï¼ˆ32ï¼‰å¤ªå°ï¼Œæ²¡æœ‰BN å±‚ç­‰ï¼Œéƒ½æœ‰å¯èƒ½æ˜¯æ€§èƒ½ä¸å¥½çš„åŸå› ï¼›2.æ„é€ view çš„æ–¹å¼è¿‡äºç®€å•ç²—æš´ï¼Œç”±äºæ ·æœ¬é•¿åº¦å¤§å¤šè¾ƒçŸ­ï¼Œéšæœºmask åå³æœ‰å¯èƒ½å¼•å…¥é”™è¯¯çš„label ä¿¡æ¯ï¼Œåˆå¯èƒ½å¼•èµ·view é—´è¯­ä¹‰çš„gapè¿‡å¤§ï¼Œæ— æ³•äº’ä¸ºæ­£ä¾‹ã€‚<br>ç›‘ç£å­¦ä¹ æ•ˆæœå›¾ä¸­ï¼Œä¸åŒlabelçš„æ•°æ®è¢«åˆ†åˆ°äº†ä¸åŒçš„ç°‡ä¸­ï¼Œè¯´æ˜å¯¹æ¯”å­¦ä¹ çš„è¿˜æ˜¯ç›¸å½“ä¸é”™ï¼Œä¸è¿‡ç”±äºæ­¤æ¬¡æ¯”èµ›ä¸­çš„label ä»£è¡¨çš„æ˜¯â€œæ˜¯å¦æ˜¯é’ˆå¯¹é—®é¢˜çš„å›ç­”â€ï¼Œlabel ç›¸åŒä½†å†…æ¶µä¸åŒï¼Œæ‰€ä»¥å¼ºè¡Œå°†ç›¸åŒlabelçš„æ ·æœ¬èšåˆï¼Œå¹¶ä¸èƒ½å¸¦æ¥æå‡ã€‚</p><h1><span id="shu-ju-zeng-qiang">æ•°æ®å¢å¼º</span><a href="#shu-ju-zeng-qiang" class="header-anchor"></a></h1><p>æ•°æ®å¢å¼ºä¸»è¦å°è¯•äº†ä¸¤ç§æ–¹å¼ï¼šEDA å’Œä¼ªæ ‡ç­¾ã€‚</p><h2><span id="eda">EDA</span><a href="#eda" class="header-anchor"></a></h2><p>EDAä¸»è¦åŒ…æ‹¬å››ç§æ–¹å¼ï¼šéšæœºæ›¿æ¢ã€éšæœºåˆ é™¤ã€éšæœºé‡å¤å’Œéšæœºäº’æ¢ã€‚<br>ç”±äºè¯å‘é‡è´¨é‡è¾ƒå·®ï¼Œæ‰€ä»¥æ“ä½œæ—¶é€‰æ‹©ä»å½“å‰å¥å­ä¸­éšæœºé€‰å–ä¸€ä¸ªè¯ä½œä¸ºâ€œåŒä¹‰è¯â€è¿›è¡Œæ“ä½œã€‚<br>æ“ä½œæ¯”ä¾‹ä¸º10%ï¼Œæ¯ä¸ªæ ·æœ¬æ„é€ å››ä¸ªæ ·æœ¬ã€‚<br>ç”¨è®­ç»ƒè¿‡çš„æ¨¡å‹å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä¿ç•™ç½®ä¿¡åº¦é«˜(&gt;0.7)çš„æ ·æœ¬ã€‚</p><h2><span id="wei-biao-qian">ä¼ªæ ‡ç­¾</span><a href="#wei-biao-qian" class="header-anchor"></a></h2><p>ç”¨è®­ç»ƒè¿‡çš„æ¨¡å‹åœ¨test data ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œå¯¹é¢„æµ‹ç»“æœæŒ‰0.5 ä¸ºé˜ˆå€¼è®¡ç®—ç½®ä¿¡åº¦å¹¶è¿›è¡Œæ’åºï¼Œä¿ç•™å‰30%çš„æ ·æœ¬åŠ å…¥è®­ç»ƒé›†ã€‚ è¿™é‡Œæ²¡æœ‰å•çº¯æŒ‰ç½®ä¿¡åº¦è¿‡æ»¤æ ·æœ¬ï¼Œæ˜¯å› ä¸ºæ¨¡å‹é¢„æµ‹ç»“æœå¤§å¤šæ•°å¤§äº0.95æˆ–å°äº0.05ï¼Œè€Œè¿‡å¤šçš„æµ‹è¯•æ•°æ®è¿›å…¥è®­ç»ƒé›†ï¼Œä¼šå¯¼è‡´æ¨¡å‹æœ€ç»ˆçš„ç»“æœæ˜¯åœ¨æ‹Ÿåˆè®­ç»ƒé›†ä¸­çš„labelï¼Œè€Œæ— æ³•å¸¦æ¥æé«˜ï¼ˆå……åˆ†å­¦ä¹ åçš„æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„é¢„æµ‹ç»“æœè‡ªç„¶æ˜¯è®­ç»ƒæ—¶çš„labelï¼‰ã€‚</p><h2><span id="shi-yan-jie-guo">å®éªŒç»“æœ</span><a href="#shi-yan-jie-guo" class="header-anchor"></a></h2><ul><li>çº¿ä¸Šç»“æœ</li></ul><p>$$<br>\begin{array}{c|c}<br>\hline<br> \text{without DA} &amp; \text{with DA} \\<br>\hline<br>\text{0.802} &amp; \text{0.806} \\<br>\hline<br>\end{array}<br>$$</p><h1><span id="zi-zheng-liu">è‡ªè’¸é¦</span><a href="#zi-zheng-liu" class="header-anchor"></a></h1><p>å€ŸåŠ©çŸ¥è¯†è’¸é¦ï¼Œæˆ‘ä»¬å°è¯•äº†è‡ªè’¸é¦æ–¹æ¡ˆï¼šå³Teacher ä¸ Student ä¸ºåŒä¸€ä¸ªæ¨¡å‹ï¼ŒTeacheræ¨¡å‹å…ˆå­¦ä¹ ä¸€éåï¼Œå¯¹è®­ç»ƒæ ·æœ¬æ‰“ä¸Šsoft labelsï¼ŒStudent åŒæ—¶å­¦ä¹ true labels ä¸ soft labels. </p><ul><li><p>soft labelsï¼š<br>$$<br>q_i = \frac{exp(\frac{z_i}{T})}{\sum_j exp(\frac{z_j}{T})}<br>$$</p></li><li><p>çº¿ä¸‹æµ‹è¯•ç»“æœï¼š<br>$$<br>\begin{array}{c|c}<br>\hline<br>\text{without KD} &amp; \text{with KD} \\<br>\hline<br>\text{0.831} &amp; \text{0.84} \\<br>\hline<br>\end{array}<br>$$</p></li></ul><h1><span id="shuffle-jie-ma">shuffle è§£ç </span><a href="#shuffle-jie-ma" class="header-anchor"></a></h1><p>å¯¹äºq a-list çš„æ¨¡å‹ï¼Œå¯ä»¥åœ¨é¢„æµ‹æ—¶ï¼Œå¯¹answer list è¿›è¡Œå…¨æ’åˆ—ï¼Œç„¶åå°†ç»“æœæŠ•ç¥¨ï¼Œä¸€æ¥å¯ä»¥å°†answer labelä¹‹é—´çš„å½±å“é™ä½ï¼ŒäºŒæ¥å¯ä»¥åœ¨éå¸¸å°çš„æˆæœ¬ä¸‹èåˆï¼Œä¹Ÿç®—æ˜¯ä¸€ç§trickã€‚ä¸è¿‡æ­¤æ¬¡æ¯”èµ›çš„æ•°æ®å¯¹é¡ºåºæ¯”è¾ƒæ•æ„Ÿï¼Œshuffleåå¤§å¤šæ•°æƒ…å†µä¸‹ä¼šé™ä½æ¨¡å‹çš„æ€§èƒ½ï¼Œæ‰€ä»¥æœ€ç»ˆèåˆåç»“æœæ²¡æå‡åè€Œé™ä½äº†ã€‚</p><h1><span id="mo-xing-rong-he">æ¨¡å‹èåˆ</span><a href="#mo-xing-rong-he" class="header-anchor"></a></h1><p>ä¸ºäº†æé«˜æ¨¡å‹çš„ç¨³å®šæ€§ä¸æ³›åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æ¨¡å‹èåˆã€‚èåˆæ—¶ï¼Œæˆ‘ä»¬æœŸæœ›æ¨¡å‹é—´èƒ½â€œå’Œè€Œä¸åŒâ€ï¼šæ¯ä¸ªå•æ¨¡å‹çš„æ€§èƒ½ä¹‹é—´å·®å¼‚å°ï¼ˆéƒ½è¦æ¥è¿‘æœ€ä¼˜å•æ¨¡å‹ï¼‰ï¼Œä¸”æ¨¡å‹ä¹‹é—´å·®å¼‚å°½é‡å¤§(æ¶æ„æˆ–è€…ä¼˜åŒ–æ–¹æ¡ˆä¸Šå·®å¼‚å°½é‡å¤§ï¼‰ã€‚æ ¹æ®ä»¥ä¸Šç­–ç•¥ï¼Œå¯¹QA Pair ä¸ QA Pointä¸¤ç§æ¨¡å‹è¿›è¡Œèåˆã€‚</p><h1><span id="shi-yan-zong-jie">å®éªŒæ€»ç»“</span><a href="#shi-yan-zong-jie" class="header-anchor"></a></h1><ul><li><p>èƒ½workçš„æ–¹æ¡ˆ<br>$$<br>\begin{array}{c|c}<br>\hline<br>\text{task-adaptive training} &amp; \text{+1.5%~3%} \\<br>\hline<br>\text{åŠ å…¥æ–°è¯} &amp; \text{+0.5%~1%} \\<br>\hline<br>\text{åŠ å…¥sop/aop} &amp; \text{+0.1%~0.3%} \\<br>\hline<br>\text{model-adaptive} &amp; \text{+0.5%~0.7%} \\<br>\hline<br>\text{å¯¹æŠ—è®­ç»ƒ} &amp; \text{+0.5%~0.9%} \\<br>\hline<br>\text{EDA} &amp; \text{+0.3%~0.5%} \\<br>\hline<br>\text{æ¨¡å‹èåˆ} &amp; \text{+0.5%~0.7%} \\<br>\hline<br>\end{array}<br>$$</p></li><li><p>ä¸èƒ½workçš„æ–¹æ¡ˆ<br>$$<br>\begin{array}{c|c}<br>\hline<br>\text{external-embedding bottom} &amp; \text{-0.2%~0%} \\<br>\hline<br>\text{external-embedding top} &amp; \text{-0.1%~0%} \\<br>\hline<br>\text{self-supervised contrastive learning} &amp; \text{-0.4%~-0.2%} \\<br>\hline<br>\text{supervised contrastive learning} &amp; \text{-0.1%~0%} \\<br>\hline<br>\text{focal loss} &amp; \text{0%} \\<br>\hline<br>\text{shuffle trick} &amp; \text{-0.15%~0} \\<br>\end{array}<br>$$</p></li><li><p>çº¿ä¸‹æœ‰æ•ˆä½†æœªæäº¤<br>$$<br>\begin{array}{c|c}<br>\hline<br>\text{è‡ªè’¸é¦} &amp; \text{+0.5%~1%} \\<br>\hline<br>\text{ä¼ªæ ‡ç­¾} &amp; \text{+0.1%~0.3%} \\<br>\hline<br>\end{array}<br>$$</p></li></ul><p>å¯¹äºPET ï¼Œåœ¨post trainingåçš„æ•ˆæœå¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œä¸è¿‡ç”±äºæ²¡æœ‰æ—¶é—´äº†ï¼Œæ‰€ä»¥æ²¡æœ‰ç»§ç»­ä¼˜åŒ–ã€‚è¿™é‡Œæä¸€ä¸‹å¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼š1.å¯ä»¥å¢åŠ è§£ç ç©ºé—´ï¼›2.å¢åŠ å¤šä¸ªpattern è¿›è¡Œèåˆçš„æ–¹å¼å°è¯•ä¼˜åŒ–ã€‚ç¬”è€…æœ¬äººæ˜¯æ¯”è¾ƒå–œæ¬¢PET è¿™ä¸ªæ€è·¯çš„ï¼Œç»Ÿä¸€äº†ä¸¤ä¸ªé˜¶æ®µï¼Œæ‰€ä»¥å¯åšçš„äº‹è¿˜æœ‰å¾ˆå¤šã€‚</p><h1><span id="bi-sai-jie-guo">æ¯”èµ›ç»“æœ</span><a href="#bi-sai-jie-guo" class="header-anchor"></a></h1><p>æ¯”èµ›æœ€ç»ˆçš„çº¿ä¸Šæˆç»©åœ¨A/B æ¦œå‡æ˜¯ç¬¬ä¸€ï¼Œç­”è¾©é˜¶æ®µä¹Ÿå¾—åˆ°äº†ç¬¬ä¸€ã€‚</p><ul><li>Aæ¦œå¾—åˆ†ï¼š<br><img src="/2021/01/20/ccf-qa-2/a-result.png" alt></li><li>Bæ¦œå¾—åˆ†ï¼š<br><img src="/2021/01/20/ccf-qa-2/b-result.png" alt></li><li>ç­”è¾©å¾—åˆ†ï¼š<br><img src="/2021/01/20/ccf-qa-2/last-result.jpg" alt></li></ul><h1><span id="dai-ma">ä»£ç </span><a href="#dai-ma" class="header-anchor"></a></h1><p>æ¯”èµ›ç›¸å…³æ€è·¯çš„ä»£ç å¼€æºåœ¨githubä¸Šï¼š<br><a href="https://github.com/xv44586/ccf_2020_qa_match" target="_blank" rel="noopener">ccf_2020_qa_match</a><br>æ¬¢è¿å¤§å®¶å°è¯•ä½¿ç”¨ï¼Œæœ‰é—®é¢˜æˆ–è€…æƒ³æ³•å¯ä»¥æissueï¼Œä¸€èµ·è®¨è®ºã€‚</p><h1><span id="zui-hou">æœ€å</span><a href="#zui-hou" class="header-anchor"></a></h1><p>æœ¬æ–‡ä¸»è¦æ€»ç»“äº†æ­¤æ¬¡ccf é—®ç­”åŒ¹é…ä¸­çš„å®éªŒæ€è·¯ï¼Œè€Œå…¶ä¸­æå‡ºçš„å››ç§baseline ï¼Œå¯ä»¥æ¨ªå‘æ¨å¹¿è‡³æ‰€æœ‰çš„æ–‡æœ¬åˆ†ç±»ç›¸å…³çš„ä»»åŠ¡ä¸­ï¼Œè€Œä¼˜åŒ–ç›¸å…³çš„æ–¹æ¡ˆï¼Œåˆ™å¯ä»¥åº”ç”¨åœ¨æ‰€æœ‰bert-base æ¨¡å‹ä¸Šã€‚ ä»æœ€åˆæ‰“ç®—â€œç™½å«–â€ä¸€ä»½æ•°æ®ï¼Œåˆ°æœ€ç»ˆæ‹¿åˆ°ç¬¬ä¸€ï¼Œç®—èµ·æ¥è¿™åº”è¯¥æ˜¯ç¬”è€…ç¬¬ä¸€æ¬¡å‚åŠ NLPçš„æ¯”èµ›ï¼Œæ‰€ä»¥å¾ˆå¹¸è¿ä¹Ÿå¾ˆæƒŠå–œã€‚<br>Enjoyï¼</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>ç­”è¾©å¤´å›¾</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="QA" scheme="https://xv44586.github.io/tags/QA/"/>
    
      <category term="CCF" scheme="https://xv44586.github.io/tags/CCF/"/>
    
      <category term="Competition" scheme="https://xv44586.github.io/tags/Competition/"/>
    
  </entry>
  
  <entry>
    <title>é‡æ–°è®¤è¯†çŸ©é˜µ</title>
    <link href="https://xv44586.github.io/2021/01/12/matrix/"/>
    <id>https://xv44586.github.io/2021/01/12/matrix/</id>
    <published>2021-01-12T13:10:17.000Z</published>
    <updated>2021-01-12T13:46:41.019Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#shi-me-shi-1">ä»€ä¹ˆæ˜¯1</a></li><li><a href="#xiang-liang">å‘é‡</a></li><li><a href="#ju-zhen">çŸ©é˜µ</a></li><li><a href="#ju-zhen-cheng-fa">çŸ©é˜µä¹˜æ³•</a></li><li><a href="#xiang-si-ju-zhen">ç›¸ä¼¼çŸ©é˜µ</a></li><li><a href="#xing-lie-shi">è¡Œåˆ—å¼</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>æœ€è¿‘æœ‰ç¯‡å¾ˆç«çš„è®ºæ–‡bert-flowï¼Œå…¶ä¸­çš„flowæ˜¯å‡ºäº†GANå’ŒVAEä¹‹å¤–çš„ç¬¬ä¸‰ç§ç”Ÿæˆæ¨¡å‹ï¼Œæˆ‘ç«Ÿç„¶æ˜¯ç¬¬ä¸€æ¬¡å¬è¯´ï¼Œæ‰€ä»¥å¼•èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œç„¶è€Œçœ‹flowæ¨¡å‹æ—¶ï¼Œå‘ç°é‡Œé¢æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µå°±æ˜¯è¡Œåˆ—å¼ï¼Œæ•°å­¦æ¸£å¤ªä¹…æ²¡ç¢°è¿‡ä»–æ‰€ä»¥å†çœ‹åˆ°æœ‰äº›é™Œç”Ÿï¼Œäºæ˜¯å°±æ‰¾äº†ä¸€äº›æ–‡ç« æ¥é‡æ–°å­¦ä¹ ä¸€ä¸‹ï¼Œåæ¥å‘ç°äº†å­Ÿå²©çš„è®¤è¯†çŸ©é˜µç³»åˆ—åšå®¢ä¸è‹ç¥çš„æ–°è®¤è¯†çŸ©é˜µç³»åˆ—åšå®¢ï¼Œçœ‹å®Œæ„Ÿè§‰å¯¹çŸ©é˜µçš„è®¤è¯†refreshäº†ä¸€ä¸‹ï¼Œæ‰€ä»¥åšä¸€äº›æ€»ç»“è®°å½•ã€‚</p><h1><span id="shi-me-shi-1">ä»€ä¹ˆæ˜¯1</span><a href="#shi-me-shi-1" class="header-anchor"></a></h1><p>é¦–å…ˆæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯<code>1</code>ï¼Œæ‰€è°“1ï¼Œå°±æ˜¯å‚ç…§ç‰©ï¼Œæˆ–è€…æ˜¯åŸºï¼Œè€Œå…¶ä»–çš„æ•°å­—éƒ½æ˜¯åœ¨å‚è€ƒä»–å¾—åˆ°çš„ï¼Œæ¯”å¦‚2,2å°±æ˜¯2 ä¸ª1ï¼Œä¹Ÿå°±æ˜¯1<em>2.<br>è€Œ1åˆæ˜¯ä¸€ä¸ªæŠ½è±¡çš„ä¸œè¥¿ï¼Œä½ æ²¡æ³•ç›´è§‚æ„Ÿå—ä»€ä¹ˆæ˜¯1ï¼Œåªæœ‰åœ¨å‚è€ƒç³»ä¸‹ï¼Œæ‰èƒ½ç›´è§‚æ„Ÿå—åˆ°ä»€ä¹ˆæ˜¯1ï¼Œå¦‚1ç“¶æ°´ï¼Œ1ç±³é•¿ï¼Œè€Œ1 ä¸ä¸€ç±³çš„å…³ç³»å°±åƒç±»ä¸å¯¹è±¡ä¸€æ ·ã€‚æ‰€ä»¥åœ¨å‚è€ƒç³»ä¸‹ï¼Œ2ç±³çš„å«ä¹‰å°±æ˜¯2ä¸ª1ç±³ï¼Œ1ç±³ </em> 2ï¼Œå³åœ¨ä»¥1ç±³ä¸ºåŸºçš„åæ ‡ç³»ä¸‹ï¼Œä»–åœ¨2çš„â€œä½ç½®â€ã€‚è€Œ5ç“¶æ°´ï¼Œå¯¹åº”çš„å«ä¹‰æ˜¯åœ¨ä»¥1ç“¶æ°´ä¸ºåŸºçš„å‚è€ƒç³»ä¸‹ï¼Œ<br>ä»–å¤„åœ¨5çš„â€œä½ç½®â€ã€‚è€Œä¸åŒçš„åæ ‡ç³»ï¼Œåœ¨ä¸åŒçš„æƒ…å†µä¸‹ä¹Ÿæœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œå¦‚åŒæ ·çš„é…’ï¼Œå½“ç”¨æ¥ç»Ÿè®¡é”€å”®é¢æ—¶ï¼Œæˆ‘ä»¬ç”¨â€œç“¶â€æ¥ç»Ÿè®¡å°±æ¯”ç”¨â€œæ¯â€æ¥ç»Ÿè®¡æ–¹ä¾¿ï¼Œè€Œå½“ç”¨æ¥åŠé…’æ—¶ï¼Œç”¨â€œæ¯â€å°±æ˜æ˜¾æ¯”ç”¨â€œç“¶â€è¦åˆé€‚ä¸€äº›ã€‚ä¹Ÿå°±æ˜¯ï¼Œé…’è¿˜æ˜¯é‚£ä¹ˆå¤šé…’ï¼Œä½†æ˜¯å½“ä½ ç”¨ä¸åŒçš„æ–¹å¼æ¥åº¦é‡æ—¶ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ä¸åŒçš„ï¼Œæ˜¯æœ‰ä¼˜åŠ£ä¹‹åˆ†çš„ã€‚</p><h1><span id="xiang-liang">å‘é‡</span><a href="#xiang-liang" class="header-anchor"></a></h1><p>å¯¹äºå‘é‡$A(a, b)$,å…¶å¯¹åº”çš„å«ä¹‰æ˜¯åœ¨ç›´è§’åæ ‡ç³»ï¼ˆä»¥$\vec{i}=(1,0),\vec{j}=(0,1)$ä¸ºåŸºï¼‰ä¸­ï¼ŒAæ˜¯åœ¨xè½´ä¸Šä¸ºa,yè½´ä¸Šä¸ºbçš„ç‚¹ã€‚<br>æ¯”å¦‚ï¼Œåœ¨ä»¥xè½´ä¸ºæ–¤yè½´ä¸ºç“¶çš„ç›´è§’åæ ‡ç³»ï¼ˆä»¥$\vec{i}=(ä¸€æ–¤,0ç“¶), \vec{j}=(0æ–¤,1ç“¶)$ä¸ºåŸºï¼‰ä¸­ï¼Œä¸‰ç“¶500æ¯«å‡çš„è‚¥ä»”æ°´å¯¹åº”çš„å‘é‡å°±æ˜¯B(3,3).æ‰€ä»¥ï¼Œ<code>æ‰€è°“å‘é‡å³åœ¨çº¿æ€§ç©ºé—´å†…ï¼Œé€‰å®šä¸€ç»„åŸºåï¼Œç”¨æ¥åˆ»ç”»ä¸€ä¸ªå¯¹è±¡</code>ã€‚</p><h1><span id="ju-zhen">çŸ©é˜µ</span><a href="#ju-zhen" class="header-anchor"></a></h1><p>é‚£ä½•ä¸ºçŸ©é˜µå‘¢ï¼Ÿæ¯”å¦‚å¯¹äºçŸ©é˜µ<br>$$A=\begin{pmatrix}<br>a &amp; c \\<br>b &amp; d<br>\end{pmatrix}$$<br>æˆ‘ä»¬èƒ½è§‚å¯Ÿåˆ°ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆï¼ŒçŸ©é˜µä¹Ÿæ˜¯ç”±å‘é‡ï¼ˆåˆ—å‘é‡ï¼‰ç»„æˆçš„ï¼Œå¯¹äºå½“å‰çŸ©é˜µAï¼Œä¹Ÿå°±å¯¹åº”ç€$\vec{i}=(a,b),\vec{j}=(c,d)$ ä¸¤ä¸ªå‘é‡ï¼Œç„¶åå°†ä»–ä»¬æŒ‰ä¸€å®šçš„é¡ºåºæ’åˆ—å°±ç»„æˆäº†çŸ©é˜µï¼›æ­¤å¤–ï¼Œè¿™ä¸ªçŸ©é˜µåˆä»£è¡¨äº†ç”±è¿™ä¸¤ä¸ªå‘é‡ä¸ºåŸºç»„æˆçš„åæ ‡ç³»ï¼ˆçº¿æ€§ç©ºé—´ï¼‰ï¼Œåœ¨è¿™ä¸ªç©ºé—´å†…ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½èƒ½é€šè¿‡è¿™ä¸¤ä¸ªåŸºæ¥è¿›è¡Œåˆ»ç”»ï¼Œå³å¯¹åº”äºä¸€ä¸ªâ€œå‘é‡â€ã€‚è¿™é‡Œå¦‚ä½•æ›´ç›´è§‚çš„ç†è§£å‘¢ï¼Ÿè¿˜æ˜¯è€ƒè™‘ä¹‹å‰çš„ä¾‹å­ï¼ŒåŒæ ·æ˜¯é…’ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨â€œæ¯â€æ¥åº¦é‡ï¼Œä¹Ÿå¯ä»¥ç”¨â€œç“¶â€æ¥åº¦é‡ï¼Œå‡å¦‚æˆ‘ä»¬ç”¨â€œæ¯â€ä½œä¸ºæœ€åˆçš„åŸºï¼Œ<br>é‚£çŸ©é˜µå¯¹åº”çš„å°±æ˜¯â€œç“¶â€ä½œä¸ºåŸºæ„æˆçš„åæ ‡ç³»ï¼Œè€Œæ„æˆçŸ©é˜µçš„å‘é‡åˆæ˜¯åœ¨ä»¥â€œæ¯â€ä¸ºåŸºä¸‹åº¦é‡å‡ºæ¥çš„ï¼Œå…¶å¯¹åº”çš„å‘é‡ä¸­çš„å€¼çš„å«ä¹‰å°±æ˜¯â€œç“¶â€çš„åŸºåœ¨â€œæ¯â€è¿™ä¸ªåŸºä¸‹çš„è¡¨ç¤ºï¼Œ<br>åŒæ ·çš„é…’ï¼Œå‡å¦‚åœ¨â€œæ¯â€åæ ‡ç³»ä¸‹ä¸º10ï¼ˆæ¯ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªçŸ©é˜µï¼Œå°±å˜ä¸ºäº†2ï¼ˆç“¶ï¼‰ï¼Œ<code>å³çŸ©é˜µæ˜¯çº¿æ€§ç©ºé—´é‡Œå˜æ¢ï¼ˆè¿åŠ¨ï¼‰çš„æè¿°ã€‚</code></p><h1><span id="ju-zhen-cheng-fa">çŸ©é˜µä¹˜æ³•</span><a href="#ju-zhen-cheng-fa" class="header-anchor"></a></h1><p>é‚£ä½•ä¸ºçŸ©é˜µä¹˜æ³•å‘¢ï¼Ÿæ¯”å¦‚ç°åœ¨æœ‰çŸ©é˜µ<br>$$<br>A=\begin{pmatrix}<br>a &amp; c \\<br>b &amp; d<br>\end{pmatrix}<br>$$<br>å‘é‡$x=(e,f)$,å¯¹äº$Ax$è¿™ä¸ªçŸ©é˜µä¸å‘é‡çš„ä¹˜æ³•ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿä¸Šé¢æˆ‘ä»¬å·²ç»æåˆ°äº†ï¼ŒçŸ©é˜µæ˜¯ç”±åˆ—å‘é‡ç»„æˆçš„ï¼Œè€Œåˆ—å‘é‡åˆå¯ä»¥çœ‹åšæ˜¯å¯¹åº”åæ ‡ç³»ä¸‹çš„ä¸€ç»„åŸºï¼Œé‚£æ ¹æ®ä¹‹å‰æˆ‘ä»¬æåˆ°å‘é‡ä¸åŸºçš„å…³ç³»ï¼Œå°±æ˜¯åœ¨åŸºç¡®å®šåï¼Œç”¨æ¥åˆ»ç”»å…¶ç©ºé—´å†…å¯¹è±¡çš„ï¼Œå¯¹åº”çš„å°±æ˜¯ä¹˜æ³•ï¼Œé‚£è¿™ä¸ªçŸ©é˜µä¸å‘é‡çš„ä¹˜æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥çœ‹å¾…ï¼Œå³çŸ©é˜µä¸å‘é‡çš„ä¹˜æ³•ä»£è¡¨çš„æ˜¯åœ¨çŸ©é˜µå¯¹åº”çš„åˆ—å‘é‡ä¸ºåŸºç»„æˆçš„ç©ºé—´å†…ï¼Œç”±å‘é‡åˆ»ç”»çš„å¯¹è±¡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆçŸ©é˜µä¹˜æ³•è¦æ±‚å¯¹åº”ç»´åº¦è¦ç›¸ç­‰ï¼Œ<br>å¯¹åº”çš„å°±æ˜¯éœ€è¦ç”¨æ‰€æœ‰çš„åŸºï¼Œæ‰èƒ½æ­£ç¡®åˆ»ç”»åœ¨è¿™ç»„åŸºå¯¹åº”åæ ‡ç³»ä¸‹çš„ä½ç½®ï¼ˆå¯¹è±¡ï¼‰ã€‚è€ŒçŸ©é˜µä¸å‘é‡ä¹˜æ³•å°±æ˜¯ç”¨æ–°çš„åŸºæ¥åˆ»ç”»å¯¹è±¡ï¼Œ<code>ä¹Ÿå³çŸ©é˜µä¸å‘é‡çš„ä¹˜æ³•ä»£è¡¨æ–½åŠ å˜æ¢ã€‚</code></p><p>é‚£ä¸ºä»€ä¹ˆçŸ©é˜µçš„ä¹˜æ³•å…¬å¼é‡Œä¸ºå¯¹åº”è¡Œä¸åˆ—ç›¸ä¹˜å¹¶æ±‚å’Œå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæœ€ç»ˆçš„ç»“æœï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å˜æ¢åˆ°å¯¹åº”çš„ç›´è§’åæ ‡ç³»ä¸‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹¦å†™å‡ºæ¥çš„æ‰€æœ‰å‘é‡ï¼Œéƒ½é»˜è®¤æ˜¯åœ¨ç›´è§’åæ ‡ç³»ä¸‹çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†ç»“æœå‘é‡åœ¨æ¯ä¸ªè½´ä¸Šè¿›è¡Œåˆ†è§£ï¼Œç„¶ååˆå¹¶å¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œå¯¹åº”çš„å°±æ˜¯è¡Œä¸åˆ—ç›¸ä¹˜åæ±‚å’Œã€‚</p><p>é‚£ä½•ä¸ºçŸ©é˜µä¸çŸ©é˜µçš„ä¹˜æ³•å‘¢ï¼Ÿå¦‚$A * B$,åŒç†ï¼ŒçŸ©é˜µä¸çŸ©é˜µçš„ä¹˜æ³•ä¹Ÿå¯ä»¥çœ‹åšæ˜¯è¿ç»­å˜æ¢åï¼Œæ„é€ çš„æ–°çš„åæ ‡ç³»ã€‚çŸ©é˜µæ˜¯ç”±å‘é‡ç»„æˆçš„ï¼Œè€ŒçŸ©é˜µä¸å‘é‡ä¹˜æ³•çš„å«ä¹‰æ˜¯åœ¨æ–°çš„åŸºä¸‹åˆ»ç”»çš„å¯¹è±¡è¡¨ç¤ºï¼Œæ‰€ä»¥çŸ©é˜µä¸çŸ©é˜µçš„ä¹˜æ³•ï¼Œå¯¹åº”Bè¿™ä¸ªå˜æ¢åœ¨æ–½åŠ äº†Aè¿™ä¸ªå˜æ¢åï¼Œå½¢æˆçš„æ–°çš„å˜æ¢ï¼Œè€Œæ–½åŠ è¿™ä¸ªå˜æ¢ï¼Œå¯¹åº”Bä¸­çš„åˆ—å‘é‡éƒ½æ˜¯åœ¨Aåæ ‡ä¸‹åˆ»ç”»å¾—åˆ°çš„ã€‚</p><p>é‚£ä½•ä¸ºçº¿æ€§æ–¹ç¨‹å‘¢ï¼Ÿæ¯”å¦‚$Ax = y$, å¯¹åº”çš„çº¿æ€§æ–¹ç¨‹æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿè¿™ä¸ªæ–¹ç¨‹å·¦ä¾§æœ‰å‘é‡æœ‰çŸ©é˜µï¼Œè€Œå³ä¾§ç¼ºåªæœ‰å‘é‡ï¼Œæœ‰ç‚¹ä¸å’Œè°ï¼Œæˆ‘ä»¬å˜æ¢ä¸€ä¸‹ï¼Œè®©ä»–ä»¬å½¢å¼ä¸€æ ·ï¼Œ$Ax = Iy$,è¿™æ ·ï¼Œç­‰å¼æˆç«‹ï¼Œä¸¤è¾¹å½¢å¼ä¹Ÿä¸€æ ·ã€‚é‚£å†™æˆè¿™ä¸ªå˜æ¢ï¼Œæˆ‘ä»¬å°±èƒ½çŒœåˆ°è¿™ä¸ªæ–¹ç¨‹ä¸­ç­‰å¼çš„æ„ä¹‰äº†ï¼šåœ¨ç›´è§’åæ ‡ç³»($I$)ä¸‹çš„yå‘é‡ï¼Œåœ¨Aåæ ‡ç³»ä¸‹è¯¥å¦‚ä½•åˆ»ç”»(x)å‘¢ï¼Ÿé‚£å†æ¥çœ‹çœ‹è¿™ä¸ªæ–¹ç¨‹çš„è§£ï¼Œå³$x = A^{-1}y$ï¼Œè€Œè¿™ä¸ªå¼å­å¯ä»¥ç†è§£ä¸ºå°†æ–½åŠ çš„å˜æ¢â€œé€†â€ç€å†å˜å›å»ï¼Œå°±è¿˜åŸäº†åŸå§‹ä½ç½®ã€‚</p><p>æ™®é€šä¹˜æ³•æœ‰äº¤æ¢å¾‹ã€ç»“åˆå¾‹ã€åˆ†é…å¾‹ï¼Œé‚£çŸ©é˜µä¹˜æ³•æ˜¯å¦ä¹Ÿæ»¡è¶³å‘¢ï¼Ÿå¯¹äºäº¤æ¢å¾‹ï¼ŒçŸ©é˜µä¹˜æ³•æ˜¯ä¸æ»¡è¶³çš„ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œ5â€œç“¶â€é…’æ¢æˆâ€œæ¯â€å¯èƒ½æ˜¯25ï¼Œè€Œ5â€œæ¯â€é…’æ¢æˆâ€œç“¶â€ï¼Œå¯èƒ½ä¹Ÿå°±æ˜¯1äº†ï¼Œæ‰€ä»¥ä¸¤ä¸ªå˜æ¢äº¤æ¢ä½ç½®ï¼Œå¾—åˆ°çš„æ˜¯ä¸åŒçš„å˜æ¢ï¼›è€Œç»“åˆå¾‹ä¸åˆ†é…å¾‹æ˜¯æ»¡è¶³çš„ï¼Œç»“åˆå¾‹å¯ä»¥çœ‹åšæ˜¯å°†å˜æ¢åˆ†æˆâ€œå‡ æ­¥â€èµ°ï¼Œå³å…ˆè¿›è¡Œâ€œå­å˜æ¢aâ€,åœ¨è¿›è¡Œâ€œå­å˜æ¢bâ€ï¼Œå‡ æ­¥èµ°ä¸ä¸€æ­¥åˆ°ä½çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼›è€Œåˆ†é…å¾‹ä¹Ÿæ˜¯ç±»ä¼¼çš„æ€è·¯ã€‚</p><h1><span id="xiang-si-ju-zhen">ç›¸ä¼¼çŸ©é˜µ</span><a href="#xiang-si-ju-zhen" class="header-anchor"></a></h1><p>é‚£ä½•ä¸ºç›¸ä¼¼çŸ©é˜µå‘¢ï¼Ÿå‡è®¾æœ‰ä¸€ä¸ªçŸ©é˜µAï¼Œå¯¹åº”$y=Ax$, è€Œç°åœ¨æœ‰ä¸€ä¸ªæ–°çš„åæ ‡ç³»Pï¼Œå¯¹åº”æœ‰${y}â€™=B{x}â€™$,åœ¨Påæ ‡ç³»ä¸‹ï¼Œxä¸yå¯¹åº”ç€$P{x}â€™=x$, $P{y}â€™=y$,ä»£å…¥åå¾—åˆ°ï¼š$P{x}â€™=AP{y}â€™ = P(P^{-1}AP){x}â€™$ï¼Œå³åœ¨Påæ ‡ç³»ä¸‹ï¼Œä»${x}â€™$ åˆ°${y}â€™$çš„å˜æ¢ç”¨çŸ©é˜µ$B=P^{-1}AP$æ¥è¡¨ç¤ºï¼Œè¿™å°±æ˜¯ç›¸ä¼¼çŸ©é˜µï¼Œ<a href="https://spaces.ac.cn/archives/1777" target="_blank" rel="noopener">å³åŒä¸€ä¸ªçº¿æ€§å˜æ¢åœ¨ä¸åŒåæ ‡ç³»ä¸‹çš„ä¸€ä¸ªæµ‹é‡ç»“æœè€Œå·²ã€‚</a></p><h1><span id="xing-lie-shi">è¡Œåˆ—å¼</span><a href="#xing-lie-shi" class="header-anchor"></a></h1><p>è¡Œåˆ—å¼æ˜¯åœ¨é€šè¿‡<a href="https://zhuanlan.zhihu.com/p/37111386" target="_blank" rel="noopener">é«˜æ–¯æ¶ˆå…ƒæ³•è§£çº¿æ€§æ–¹ç¨‹ç»„æ—¶å¼•å…¥çš„æ•°å­¦å·¥å…·</a>, å¯¹åº”çš„å®šä¹‰ä¸ºï¼š<br>$$<br>D = \sum(-1)^t a_{1p_n}a_{2p_n}â€¦a_{np_n}<br>$$<br>å…¶ä¸­$t$ä¸ºæ’åˆ—$a_{1p_n}a_{2p_n}â€¦a_{np_n}$çš„é€†åºæ•°ï¼Œ$\sum$ ä¸ºå¯¹æ‰€æœ‰å¯èƒ½çš„æ’åˆ—æ±‚å’Œã€‚<br>è¿™ä¸ªè®¡ç®—æ–¹å¼çœ‹èµ·æ¥å¥½å¥‡æ€ªï¼Œè¿˜æœ‰ä¸€ä¸ªé€†åºæ•°ï¼Œæ— æ³•ç›´è§‚çš„ç†è§£ï¼Œé‚£æ€ä¹ˆæ‰èƒ½æœ‰ä¸ªç›´è§‚å°è±¡ï¼Œè®©æˆ‘ä»¬çŸ¥é“ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯è¿™ä¹ˆè®¡ç®—çš„å‘¢ï¼Ÿ<br>è¯´å®è¯æˆ‘è™½ç„¶å‡ å¹´å‰åœ¨ç½‘æ˜“äº‘è¯¾å ‚é‡æ–°å­¦äº†ä¸€éçº¿æ€§ä»£æ•°ï¼Œä½†æ˜¯ä»Šå¤©åˆåŸºæœ¬å…¨å¿˜è®°äº†ï¼Œæ‰€ä»¥è¿™æ¬¡ï¼Œæˆ‘å¸Œæœ›æ‰¾åˆ°ä¸€äº›æ›´â€œç›´è§‚â€çš„ä¸œè¥¿ã€‚<br>å¦‚æœæŒ‰ç…§çŸ©é˜µå°±æ˜¯å¯¹åº”åæ ‡ç³»çš„å˜æ¢ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”åŸºçš„å˜æ¢çš„æ€è·¯ï¼Œé‚£çŸ©é˜µçš„è¡Œåˆ—å¼åº”è¯¥æ˜¯å¯¹åº”ç€å˜æ¢çš„æŸç§åº¦é‡ï¼ˆå®é™…æ˜¯å¯¹åº”åæ ‡ç³»çš„ç¼©æ”¾ï¼Œä¹Ÿå°±æ˜¯åŸºçš„ä½“ç§¯å˜æ¢ï¼‰ã€‚é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œè‹ç¥çš„ä¸€ç¯‡åšæ–‡<a href="https://kexue.fm/archives/2208" target="_blank" rel="noopener">æ–°ç†è§£çŸ©é˜µ5ï¼šä½“ç§¯=è¡Œåˆ—å¼</a>ä¸­ï¼Œé€šè¿‡ä¸¤è€…çš„æ€§è´¨ç›¸åŒï¼Œè¯æ˜äº†è¡Œåˆ—å¼çš„å‡ ä½•æ„ä¹‰ï¼Œå°±æ˜¯å…¶å¯¹åº”çš„nç»´å¹³è¡Œnç»´ä½“çš„ä½“ç§¯ã€‚<br>çŸ¥é“äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•é€šè¿‡è®¡ç®—å¹³è¡Œnç»´ä½“çš„ä½“ç§¯æ¥â€œç›´è§‚â€æ„Ÿå—ä¸€ä¸‹äº†ã€‚<br><img src="/2021/01/12/matrix/det.png" alt></p><p>è¿™é‡Œæˆ‘ä»¬è®¨è®ºäºŒç»´ç©ºé—´ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶ä¸­$\overrightarrow{A}$ä¸$\overrightarrow{B}$åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªå‘é‡ï¼Œè€Œå…¶å›´æˆçš„é¢ç§¯S ä¸º(O,A,I,B)å››ä¸ªç‚¹æ‰€å›´æˆçš„å›¾å½¢ã€‚è€Œè¿™ä¸ªå›¾å½¢åˆå¯ä»¥çœ‹æˆä¸¤ä¸ªéƒ¨åˆ†çš„ç»„åˆï¼šä¸€éƒ¨åˆ†ä¸ºä¸å››è¾¹å½¢(O,Dï¼ŒP,G)é‡å çš„éƒ¨åˆ†ï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºå‰©ä¸‹çš„éƒ¨åˆ†ã€‚è€Œå‰©ä¸‹çš„éƒ¨åˆ†åˆå¯ä»¥é€šè¿‡$PI$åˆ‡åˆ†ä¸ºä¸¤ä¸ªä¸‰è§’å½¢ï¼š$\bigtriangleup BPI$ $\bigtriangleup API$ï¼Œ<br>æˆ‘ä»¬åˆ†åˆ«åšä¸¤ä¸ªä¸‰è§’å½¢çš„é«˜ï¼ˆè“è‰²çº¿ï¼‰$PJ=b, PK=c$ï¼Œæ­¤æ—¶æˆ‘ä»¬å°†$\bigtriangleup BPI$ ä¸ $\bigtriangleup ODA$ è¿›è¡Œå¯¹æ¯”ï¼Œä¸¤è€…çš„é«˜éƒ½æ˜¯$b$,è€Œåº•çš„å·®ä¸º$c$ï¼Œä¹Ÿå°±æ˜¯$S\bigtriangleup ODA - S\bigtriangleup BPI = S\bigtriangleup OCM$ï¼Œ ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å‡º$S\bigtriangleup OBG - S\bigtriangleup API = S\bigtriangleup OFM$,äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªç»“è®ºï¼š<br>$$<br>S_{\square OAIB} = S_{\square ODPG} - S_{\square OCMF} = ad - bc = \begin{Vmatrix}<br>a &amp;b \\<br>c &amp; d<br>\end{Vmatrix} = det(A,B)<br>$$</p><p>è€Œä¸¤ä¸ªå››è¾¹å½¢çš„ä½ç½®éƒ½æ˜¯ç”±å‘é‡åœ¨åæ ‡è½´ä¸ŠæŠ•å½±åç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€è¡Œåˆ—å¼ä¸­çš„â€œæ’åˆ—ç›¸ä¹˜â€ï¼Œè€Œé¢ç§¯ä¸è¶³éœ€è¦è¢«â€œå‡æ‰â€çš„å°é¢ç§¯å°±å¯¹åº”é€†åºæ•°ï¼Œæ‰€ä»¥å®Œæ•´çš„è¿‡ç¨‹å°±æ˜¯â€œé€šè¿‡æ’åˆ—æ±‚é•¿æ–¹å½¢çš„é¢ç§¯ï¼Œç„¶åç”¨å¤§é¢ç§¯å‡å»å°é¢ç§¯â€ã€‚<br>ä»¥ä¸Šçš„æ€è·¯å¯ä»¥æ¨å¹¿åˆ°Nç»´ç©ºé—´ï¼Œæ€æƒ³æ˜¯ä¸€æ ·çš„ã€‚ è€Œç†è§£äº†çŸ©é˜µçš„è¡Œåˆ—å¼å°±æ˜¯å¹³è¡ŒNç»´ä½“çš„ä½“ç§¯åï¼Œå¯¹åº”è¡Œåˆ—å¼çš„è®¡ç®—å…¬å¼ä¹Ÿå°±æ˜¾å¾—ç›¸å½“â€œç›´è§‚â€äº†ã€‚å¦‚ï¼Œå¯¹è¡Œåˆ—å¼çš„æŸä¸€åˆ—ä¹˜ä¸Š$\alpha$ï¼Œåˆ™å¯¹åº”çš„è¡Œåˆ—å¼çš„å€¼ä¹Ÿä¹˜ä¸Š$\alpha$ï¼Œè¿™é‡Œå°±æ˜¯å¯¹åº”å…¶ä¸­çš„ä¸€ä¸ªåŸºå‘é‡æ”¾å¤§äº†$\alpha$å€ï¼Œæ‰€ä»¥ä½“ç§¯æ”¾å¤§äº†$\alpha$å€ã€‚</p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬æ–‡ä¸»è¦æ˜¯å‚è€ƒäº†è®¸å¤šæ–‡ç« åï¼Œå‘ç°å°†çŸ©é˜µçœ‹åšæ˜¯å˜æ¢çš„è¡¨è¿°è¿™ä¸ªè§†è§’ä¸‹ï¼Œå¾ˆå¤šç›¸å…³é—®é¢˜éƒ½å˜å¾—éå¸¸ç›´è§‚åˆå®¹æ˜“ç†è§£ï¼Œæœ€åç»è¿‡æ€è€ƒåšçš„éƒ¨åˆ†æ€»ç»“ï¼Œå¦‚æœå¯¹çŸ©é˜µæ„Ÿå…´è¶£æˆ–è€…æ€»è§‰å¾—ä¸å®¹æ˜“ç†è§£ï¼Œæ¨èå­Ÿå²©çš„<a href="http://blog.csdn.net/myan/article/details/647511" target="_blank" rel="noopener">ç†è§£çŸ©é˜µç³»åˆ—</a>ã€è‹ç¥çš„<a href="[https://kexue.fm/archives/1765">æ–°ç†è§£çŸ©é˜µç³»åˆ—</a>ã€<a href="https://www.matongxue.com/madocs/247/" target="_blank" rel="noopener">é©¬åŒå­¦çš„çŸ©é˜µä¸è¡Œåˆ—å¼ç³»åˆ—</a></p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Math" scheme="https://xv44586.github.io/categories/Math/"/>
    
    
      <category term="Math" scheme="https://xv44586.github.io/tags/Math/"/>
    
      <category term="Matrix" scheme="https://xv44586.github.io/tags/Matrix/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æå‡bertåœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­çš„æ€§èƒ½</title>
    <link href="https://xv44586.github.io/2020/11/24/fine-tune/"/>
    <id>https://xv44586.github.io/2020/11/24/fine-tune/</id>
    <published>2020-11-24T13:44:12.000Z</published>
    <updated>2020-11-25T13:45:14.081Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#further-pre-training">Further Pre-training</a><ul><li><a href="#er-jie-duan-vs-san-jie-duan-vs-si-jie-duan">äºŒé˜¶æ®µ vs ä¸‰é˜¶æ®µ vs å››é˜¶æ®µ</a><ul><li><a href="#san-jie-duan">ä¸‰é˜¶æ®µ</a></li><li><a href="#si-jie-duan">å››é˜¶æ®µ</a></li></ul></li></ul></li><li><a href="#ru-he-further-pre-training">å¦‚ä½•further pre-training</a><ul><li><a href="#how-to-mask">how to mask</a></li><li><a href="#when-to-stop">when to stop</a></li><li><a href="#how-to-fine-tuning">how to fine-tuning</a><ul><li><a href="#optimizer">optimizer</a></li><li><a href="#learning-rate">learning rate</a></li><li><a href="#multi-task">multi-task</a></li><li><a href="#which-layer">which layer</a></li></ul></li></ul></li><li><a href="#self-knowledge-distillation">Self-Knowledge Distillation</a></li><li><a href="#zhi-shi-zhu-ru">çŸ¥è¯†æ³¨å…¥</a></li><li><a href="#shu-ju-zeng-qiang">æ•°æ®å¢å¼º</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>éšç€Transformer åœ¨NLPä¸­çš„è¡¨ç°ï¼ŒBertå·²ç»æˆä¸ºä¸»æµæ¨¡å‹ï¼Œç„¶è€Œå¤§å®¶åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­ä½¿ç”¨æ—¶ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿä¼šå‘ç°æ¨¡å‹çš„æ€§èƒ½æ—¶å¥½æ—¶åï¼Œç”šè‡³ç›¸åŒå‚æ•°åˆ‡æ¢ä¸€ä¸‹éšæœºç§å­ç»“æœéƒ½ä¸ä¸€æ ·ï¼Œåˆæˆ–è€…è‡ªå·±ä¸ç®¡å¦‚ä½•è°ƒï¼Œæ¨¡å‹æ€»è¾¾ä¸åˆ°æƒ³è±¡ä¸­çš„é‚£ä¹ˆå¥½ï¼Œé‚£å¦‚ä½•æ‰èƒ½è®©Bertåœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­è¡¨ç°æ›´å¥½æ›´ç¨³å‘¢ï¼Ÿæœ¬æ–‡ä»¥æ–‡æœ¬åˆ†ç±»ä¸ºä¾‹ï¼Œä»‹ç»å‡ ç§èƒ½å¸®ä½ æé«˜ä¸‹æ¸¸ä»»åŠ¡æ€§èƒ½çš„æ–¹æ³•ã€‚</p><h1><span id="further-pre-training">Further Pre-training</span><a href="#further-pre-training" class="header-anchor"></a></h1><p>æœ€ç¨³å®šä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æå‡ä¸‹æ¸¸ä»»åŠ¡æ€§èƒ½çš„æ‰‹æ®µå°±æ˜¯ç»§ç»­è¿›è¡Œé¢„è®­ç»ƒäº†ã€‚</p><h2><span id="er-jie-duan-vs-san-jie-duan-vs-si-jie-duan">äºŒé˜¶æ®µ vs ä¸‰é˜¶æ®µ vs å››é˜¶æ®µ</span><a href="#er-jie-duan-vs-san-jie-duan-vs-si-jie-duan" class="header-anchor"></a></h2><p>é¦–å…ˆå›é¡¾ä¸€ä¸‹ï¼ŒBert æ˜¯å¦‚ä½•ä½¿ç”¨çš„å‘¢ï¼Ÿæˆ‘ä»¬è®¾é€šç”¨æ³›åŒ–è¯­æ–™ä¸º$D_g$ï¼Œä¸‹æ¸¸ä»»åŠ¡ç›¸å…³çš„æ•°æ®ä¸º$D_t$, Bert å³åœ¨é€šç”¨è¯­æ–™$D_g$ ä¸Šè®­ç»ƒä¸€ä¸ªé€šç”¨çš„Language Modelï¼Œ ç„¶ååˆ©ç”¨è¿™ä¸ªæ¨¡å‹å­¦åˆ°çš„é€šç”¨çŸ¥è¯†æ¥åšä¸‹æ¸¸ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šåšfine-tuneï¼Œè¿™å°±æ˜¯<code>äºŒé˜¶æ®µæ¨¡å¼</code>ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ä¹Ÿéƒ½æ˜¯è¿™ä¹ˆä½¿ç”¨çš„ï¼šä¸‹è½½ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹ï¼Œç„¶ååœ¨è‡ªå·±çš„æ•°æ®ä¸Šç›´æ¥fine-tuneã€‚</p><h3><span id="san-jie-duan">ä¸‰é˜¶æ®µ</span><a href="#san-jie-duan" class="header-anchor"></a></h3><p>åœ¨è®ºæ–‡<a href="http://arxiv.org/abs/1801.06146" target="_blank" rel="noopener">Universal Language Model Fine-tuning for Text Classification</a>ä¸­ï¼Œä½œè€…æå‡ºäº†ä¸€ä¸ªé€šç”¨çš„èŒƒå¼ULMFiTï¼š</p><ol><li><em>åœ¨å¤§é‡çš„é€šç”¨è¯­æ–™ä¸Šè®­ç»ƒä¸€ä¸ªLMï¼ˆPretrainï¼‰ï¼›</em></li><li><em>åœ¨ä»»åŠ¡ç›¸å…³çš„å°æ•°æ®ä¸Šç»§ç»­è®­ç»ƒLMï¼ˆDomain transferï¼‰ï¼›</em></li><li><em>åœ¨ä»»åŠ¡ç›¸å…³çš„å°æ•°æ®ä¸Šåšå…·ä½“ä»»åŠ¡ï¼ˆFine-tuneï¼‰ã€‚</em></li></ol><p>é‚£æˆ‘ä»¬åœ¨ä½¿ç”¨Bert æ—¶èƒ½ä¸èƒ½ä¹ŸæŒ‰è¿™ç§èŒƒå¼ï¼Œè¿›è¡Œä¸‰é˜¶æ®µçš„fine-tune ä»è€Œæé«˜æ€§èƒ½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<code>èƒ½ï¼</code><br>æ¯”å¦‚é‚±é”¡é¹è€å¸ˆçš„è®ºæ–‡<a href="http://arxiv.org/abs/1905.05583" target="_blank" rel="noopener">How to Fine-Tune BERT for Text Classification?</a>å’Œ<a href="arXiv:2004.10964 [cs]" target="_blank" rel="noopener">Donâ€™t Stop Pretraining: Adapt Language Models to Domains and Tasks</a>ä¸­å°±éªŒè¯äº†ï¼Œåœ¨ä»»åŠ¡æ•°æ®$D_t$ ç»§ç»­è¿›è¡Œpretraining ä»»åŠ¡ï¼Œå¯ä»¥æé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚<br>é‚£å¦‚æœæˆ‘ä»¬é™¤äº†ä»»åŠ¡æ•°æ®æ²¡æœ‰åˆ«çš„æ•°æ®æ—¶ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿç®€å•ï¼Œä»»åŠ¡æ•°æ®è‚¯å®šæ˜¯ç›¸åŒé¢†åŸŸçš„ï¼Œæ­¤æ—¶ç›´æ¥å°†ä»»åŠ¡æ•°æ®çœ‹ä½œç›¸åŒé¢†åŸŸæ•°æ®å³å¯ã€‚æ‰€ä»¥ï¼Œåœ¨è¿›è¡Œä¸‹æ¸¸ä»»åŠ¡ä¹‹å‰ï¼Œä¸å¦¨å…ˆåœ¨ä»»åŠ¡æ•°æ®ä¸Šç»§ç»­è¿›è¡Œpre-training ä»»åŠ¡ç»§ç»­è®­ç»ƒLM ï¼Œä¹‹åå†æ­¤åŸºç¡€ä¸Šè¿›è¡Œfine-tuneã€‚</p><h3><span id="si-jie-duan">å››é˜¶æ®µ</span><a href="#si-jie-duan" class="header-anchor"></a></h3><p>æˆ‘ä»¬åœ¨å®é™…å·¥ä½œä¸Šï¼Œä»»åŠ¡ç›¸å…³çš„label data è¾ƒéš¾è·å¾—ï¼Œè€Œunlabeled data å´éå¸¸å¤šï¼Œé‚£å¦‚ä½•åˆç†åˆ©ç”¨è¿™éƒ¨åˆ†æ•°æ®ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿèƒ½æé«˜æ¨¡å‹åœ¨ä¸‹æ¸¸çš„æ€§èƒ½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<code>ä¹Ÿèƒ½ï¼ </code>  </p><ol><li><em>åœ¨å¤§é‡é€šç”¨è¯­æ–™ä¸Šè®­ç»ƒä¸€ä¸ªLMï¼ˆPretrainï¼‰ï¼›</em></li><li><em>åœ¨ç›¸åŒé¢†åŸŸ$D_{in_domain}$ä¸Šç»§ç»­è®­ç»ƒLMï¼ˆDomain transferï¼‰ï¼›</em></li><li><em>åœ¨ä»»åŠ¡ç›¸å…³çš„å°æ•°æ®ä¸Šç»§ç»­è®­ç»ƒLMï¼ˆTask transferï¼‰ï¼›</em></li><li><em>åœ¨ä»»åŠ¡ç›¸å…³æ•°æ®ä¸Šåšå…·ä½“ä»»åŠ¡ï¼ˆFine-tuneï¼‰ã€‚</em>  </li></ol><p>è€Œä¸”ä¸Šè¿°ä¸¤ç¯‡è®ºæ–‡ä¸­ä¹Ÿç»™å‡ºäº†ç»“è®ºï¼šå…ˆDomain transfer å†è¿›è¡ŒTask transfer æœ€åFine-tune æ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚</p><h1><span id="ru-he-further-pre-training">å¦‚ä½•further pre-training</span><a href="#ru-he-further-pre-training" class="header-anchor"></a></h1><h2><span id="how-to-mask">how to mask</span><a href="#how-to-mask" class="header-anchor"></a></h2><p>é¦–å…ˆï¼Œåœ¨further pre-trainingæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿›è¡Œmask å‘¢ï¼Ÿä¸åŒçš„mask æ–¹æ¡ˆæ˜¯ä¸æ˜¯èƒ½èµ·åˆ°æ›´å¥½çš„æ•ˆæœå‘¢ï¼Ÿ<br>åœ¨Roberta ä¸­æå‡ºï¼ŒåŠ¨æ€mask æ–¹æ¡ˆæ¯”å›ºå®šmask æ–¹æ¡ˆæ•ˆæœæ›´å¥½ï¼Œæ­¤å¤–ï¼Œåœ¨åšTask transfer æ—¶ï¼Œç”±äºæ•°æ®é€šå¸¸è¾ƒå°ï¼Œå›ºå®šçš„mask æ–¹æ¡ˆé€šå¸¸ä¹Ÿå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œæ‰€ä»¥further pre-training æ—¶ï¼ŒåŠ¨æ€éšæœºmask æ–¹æ¡ˆé€šå¸¸æ¯”å›ºå®šmask æ•ˆæœæ›´å¥½ã€‚<br>è€ŒERNIE å’Œ SpanBert ä¸­éƒ½ç»™å‡ºäº†ç»“è®ºï¼Œæ›´æœ‰é’ˆå¯¹æ€§çš„mask æ–¹æ¡ˆå¯ä»¥æå‡ä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½ï¼Œé‚£future pre-training æ—¶æ˜¯å¦æœ‰ä»€ä¹ˆæ–¹æ¡ˆèƒ½æ›´æœ‰é’ˆå¯¹æ€§çš„mask å‘¢ï¼Ÿ<br>åˆ˜çŸ¥è¿œè€å¸ˆçš„è®ºæ–‡<a href="http://arxiv.org/abs/2004.09733" target="_blank" rel="noopener">Train No Evil: Selective Masking for Task-Guided Pre-Training</a>å°±æå‡ºäº†ä¸€ç§æ›´æœ‰é’ˆå¯¹æ€§çš„mask æ–¹æ¡ˆ<code>Selective Mask</code>,è¿›è¡Œfurther pre-training æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆçš„æ•´ä½“æ€è·¯æ˜¯ï¼š</p><ol><li><em>åœ¨$D_t$ä¸Šè®­ç»ƒä¸€ä¸ªä¸‹æ¸¸ä»»åŠ¡æ¨¡å‹ $Model_0$;</em></li><li><em>åˆ©ç”¨$Model_0$åˆ¤æ–­token æ˜¯å¦æ˜¯ä¸‹æ¸¸ä»»åŠ¡ä¸­çš„é‡è¦tokenï¼Œå…·ä½“è®¡ç®—å…¬å¼ä¸ºï¼š$S(w_i) = P(y_t|s) - P(y_t|s^{â€˜}_{i-1}W_i)$, å…¶ä¸­$s$ä¸ºå®Œæ•´å¥å­ï¼ˆåºåˆ—ï¼‰ï¼Œ$s^{â€˜}$ä¸ºä¸€ä¸ªåˆå§‹åŒ–ä¸ºç©ºçš„bufferï¼Œæ¯æ¬¡å°†å¥å­ä¸­çš„token å¾€bufferä¸­æ·»åŠ ï¼Œå¦‚æœåŠ å…¥çš„token å¯¹å½“å‰ä»»åŠ¡çš„è¡¨ç°ä¸å®Œæ•´å¥å­åœ¨å½“å‰ä»»åŠ¡çš„è¡¨ç°å·®è·å°äºé˜ˆå€¼ï¼Œåˆ™è®¤ä¸ºè¯¥token ä¸ºé‡è¦tokenï¼Œå¹¶ä»buffer ä¸­å‰”é™¤ï¼›</em></li><li><em>åˆ©ç”¨ä¸Šä¸€æ­¥ä¸­å¾—åˆ°çš„token labelï¼Œè®­ç»ƒä¸€ä¸ªäºŒåˆ†ç±»æ¨¡å‹$Model_b$ï¼Œæ¥åˆ¤æ–­å¥å­ä¸­çš„token æ˜¯å¦ä¸ºé‡è¦tokenï¼›</em></li><li><em>åˆ©ç”¨$Model_b$ï¼Œåœ¨domain æ•°æ®ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œæ ¹æ®é¢„æµ‹ç»“æœè¿›è¡Œmask ï¼›</em></li><li><em>è¿›è¡ŒDomain transfer pre-trainingï¼›</em></li><li><em>åœ¨ä¸‹æ¸¸ä»»åŠ¡è¿›è¡ŒFine-tuningã€‚</em><br>ä¸Šè¿°æ–¹æ¡ˆéªŒè¯äº†æ›´æœ‰é’ˆå¯¹æ€§çš„mask é‡è¦çš„tokenï¼Œä¸‹æ¸¸ä»»åŠ¡ä¸­èƒ½å¾—åˆ°ä¸é”™çš„æå‡ã€‚ç»¼åˆä¸‹æ¥ï¼Œ<code>Selective Mask &gt; Dynamic Mask &gt; Static Mask</code>   </li></ol><p>è™½ç„¶selective mask æœ‰æå‡ï¼Œä½†æ˜¯è®ºæ–‡ç»™å‡ºçš„æ€è·¯å¤ªè¿‡ç¹çäº†ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ¤æ–­token åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„å½±å“ï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºä¸€ä¸ªç¬”è€…è‡ªå·±è„‘æ´çš„ä¸€ä¸ªæ–¹æ¡ˆï¼šé€šè¿‡$Model_0$åœ¨unlabeled çš„Domain data ä¸Šç›´æ¥é¢„æµ‹ï¼Œç„¶åé€šè¿‡ä¸åŒtoken ä¸‹ç»“æœçš„ç†µçš„æ³¢åŠ¨æ¥ç¡®å®štoken å¯¹ä¸‹æ¸¸ä»»åŠ¡çš„å½±å“ã€‚è¿™ä¸ªæ–¹æ¡ˆæˆ‘æ²¡æœ‰åšè¿‡å®éªŒï¼Œæœ‰å…´è¶£çš„å¯ä»¥è¯•è¯•ã€‚  </p><h2><span id="when-to-stop">when to stop</span><a href="#when-to-stop" class="header-anchor"></a></h2><p>åœ¨further pretraining æ—¶ï¼Œè¯¥ä½•æ—¶åœæ­¢å‘¢ï¼Ÿæ˜¯å¦è®­ç»ƒçš„è¶Šä¹…ä¸‹æ¸¸ä»»åŠ¡å°±æå‡çš„è¶Šå¤šå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚åœ¨è¿›è¡ŒTask transfer æ—¶ï¼Œåº”è¯¥è®­ç»ƒå¤šå°‘æ­¥ï¼Œè®ºæ–‡<a href="http://arxiv.org/abs/1905.05583" target="_blank" rel="noopener">How to Fine-Tune BERT for Text Classification?</a>è¿›è¡Œäº†å®éªŒï¼Œæœ€åå¾—å‡ºçš„ç»“è®ºæ˜¯<code>100k</code>æ­¥å·¦å³ï¼Œä¸‹æ¸¸ä»»åŠ¡ä¸Šæå‡æ˜¯æœ€é«˜çš„ï¼Œè¿™ä¹Ÿä¸æˆ‘è‡ªå·±çš„å®éªŒåŸºæœ¬å»åˆï¼Œè®­ç»ƒè¿‡å¤šå°±ä¼šè¿‡æ‹Ÿåˆï¼Œå¯¼è‡´ä¸‹æ¸¸ä»»åŠ¡ä¸Šæå‡å°ç”šè‡³é™ä½ã€‚</p><p><img src="/2020/11/24/fine-tune/step.png" alt></p><p>æ­¤å¤–ï¼Œç”±äºä¸‹æ¸¸ä»»åŠ¡æ•°æ®é‡çš„ä¸åŒï¼Œè¿›è¡Œå¤šå°‘æ­¥ç»“æœæ˜¯æœ€ä¼˜çš„ä¹Ÿè®¸éœ€è¦å®éªŒæµ‹è¯•ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªæ›´å¿«æ·ç¨³å¦¥çš„æ–¹æ¡ˆï¼šå€Ÿé‰´PETæœ¬è´¨ä¸Šä¹Ÿæ˜¯åœ¨è®­ç»ƒMLM ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåˆ©ç”¨åˆ©ç”¨PETåšfine-tuningï¼Œç„¶åå°†æœ€ä¼˜æ¨¡å‹ä½œä¸ºé¢„è®­ç»ƒåçš„æ¨¡å‹æ¥è¿›è¡Œåˆ†ç±»ä»»åŠ¡fine-tuningï¼Œè¿™ç§æ–¹æ¡ˆæˆ‘å®éªŒåçš„ç»“è®ºæ˜¯ä¸ç›´æ¥è¿›è¡ŒTask transferæ€§èƒ½æå‡ä¸Šç›¸å·®ä¸å¤§ã€‚ä¸äº†è§£PETçš„å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰åšæ–‡<a href="https://xv44586.github.io/2020/10/25/pet/">PET-æ–‡æœ¬åˆ†ç±»çš„åˆä¸€ç§å¦™è§£</a>.</p><h2><span id="how-to-fine-tuning">how to fine-tuning</span><a href="#how-to-fine-tuning" class="header-anchor"></a></h2><p>ä¸åŒçš„fine-tuning æ–¹æ³•ä¹Ÿæ˜¯å½±å“ä¸‹æ¸¸ä»»åŠ¡æ€§èƒ½çš„å…³é”®å› ç´ ã€‚</p><h3><span id="optimizer">optimizer</span><a href="#optimizer" class="header-anchor"></a></h3><p>å…³äºä¼˜åŒ–æ–¹æ¡ˆä¸Šï¼ŒBert çš„è®ºæ–‡ä¸­å»ºè®®ä½¿ç”¨ä¸bert é¢„è®­ç»ƒæ—¶ä¸€è‡´çš„æ–¹æ¡ˆè¿›è¡Œfine-tuningï¼Œå³ä½¿ç”¨weighted decayä¿®æ­£åçš„Adamï¼Œå¹¶ä½¿ç”¨warmupç­–ç•¥ æ­é…çº¿æ€§è¡°å‡çš„å­¦ä¹ ç‡ã€‚ä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„åšæ–‡<a href="https://xv44586.github.io/2020/08/01/optimizer-in-bert/">optimizer of bert</a></p><h3><span id="learning-rate">learning rate</span><a href="#learning-rate" class="header-anchor"></a></h3><p>ä¸åˆé€‚çš„learning rateå¯èƒ½ä¼šå¯¼è‡´<code>ç¾éš¾æ€§é—å¿˜</code>,é€šå¸¸learning rate åœ¨$[-e^{-5}, 1e^{-4}]$ä¹‹é—´ï¼Œæ›´å¤§çš„learning rateå¯èƒ½å°±ä¼šå‘ç”Ÿç¾éš¾æ€§é—å¿˜ï¼Œä¸åˆ©äºä¼˜åŒ–ã€‚</p><p><img src="/2020/11/24/fine-tune/lrt.png" alt></p><p>æ­¤å¤–ï¼Œå¯¹transformer é€å±‚é™ä½å­¦ä¹ ç‡ä¹Ÿèƒ½é™ä½å‘ç”Ÿç¾éš¾æ€§é—å¿˜çš„åŒæ—¶æå‡ä¸€äº›æ€§èƒ½ã€‚</p><h3><span id="multi-task">multi-task</span><a href="#multi-task" class="header-anchor"></a></h3><p>Bertåœ¨é¢„è®­ç»ƒæ—¶ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªtaskï¼šNSP å’Œ MLMï¼Œé‚£åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­ï¼Œå¢åŠ ä¸€ä¸ªè¾…åŠ©çš„ä»»åŠ¡æ˜¯å¦èƒ½å¸¦æ¥æå‡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å¦‚æˆ‘ä¹‹å‰å°è¯•è¿‡åœ¨åˆ†ç±»ä»»åŠ¡çš„åŒæ—¶ï¼Œå¢åŠ ä¸€ä¸ªç›¸ä¼¼æ€§ä»»åŠ¡ï¼šè®©æ ·æœ¬ä¸label descçš„å¾—åˆ†é«˜äºæ ·æœ¬ä¸å…¶ä»–æ ·æœ¬çš„å¾—åˆ†ï¼Œä½†æ˜¯æœ€ç»ˆæ€§èƒ½å¹¶æ²¡æœ‰å¾—åˆ°æå‡ã€‚å…·ä½“çš„å®éªŒè¿‡ç¨‹è¯·çœ‹åšæ–‡<a href="https://xv44586.github.io/2020/09/13/classification-label-augment/">æ¨¡å‹å¢å¼ºä¹‹ä»labelä¸‹æ‰‹</a>ã€‚<br>æ­¤å¤–ï¼Œè®ºæ–‡<a href="http://arxiv.org/abs/1905.05583" target="_blank" rel="noopener">How to Fine-Tune BERT for Text Classification?</a>ä¹Ÿä»»åŠ¡multi-taskä¸èƒ½å¸¦æ¥ä¸‹æ¸¸ä»»åŠ¡çš„æå‡ã€‚</p><h3><span id="which-layer">which layer</span><a href="#which-layer" class="header-anchor"></a></h3><p>Bertçš„ç»“æ„ä¸Šæ˜¯ä¸€ä¸ª12å±‚çš„transformerï¼Œåœ¨åšæ–‡æœ¬åˆ†ç±»æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯ç›´æ¥ä½¿ç”¨æœ€åä¸€å±‚çš„<code>[CLS]</code>æ¥åšfine-tuningï¼Œè¿™æ ·æ˜¯æœ€ä¼˜çš„å—ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Ÿ<br>è®ºæ–‡<a href="http://arxiv.org/abs/1905.05583" target="_blank" rel="noopener">How to Fine-Tune BERT for Text Classification?</a>ä¸­é’ˆå¯¹è¿™ä¸ªé—®é¢˜ä¹Ÿåšäº†å®éªŒï¼Œå¯¹æ¯”äº†ä¸åŒçš„layerä¸åŒçš„æŠ½å–ç­–ç•¥ï¼Œæœ€ç»ˆç»“è®ºæ˜¯æ‰€æœ‰å±‚æ‹¼æ¥æ•ˆæœæœ€å¥½ï¼Œä½†æ˜¯ä¸ç›´æ¥ä½¿ç”¨æœ€åä¸€å±‚å·®è·ä¸å¤§ã€‚<br><img src="/2020/11/24/fine-tune/layer.png" alt></p><p>è€Œè®ºæ–‡<a href="http://arxiv.org/abs/2008.06460" target="_blank" rel="noopener">Hate Speech Detection and Racial Bias Mitigation in Social Media based on BERT model</a>ä¸­ï¼Œä½œè€…é€šè¿‡ç»„åˆå¤šç§ç²’åº¦çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå³å°†12å±‚çš„<code>[CLS]</code>æ‹¼æ¥åï¼Œé€äººCNNï¼Œåœ¨Hate Speech Detection ä¸­èƒ½å¸¦æ¥<code>8ä¸ªç‚¹</code>çš„æå‡ï¼<br><img src="/2020/11/24/fine-tuning/cnn.png" alt></p><p>æ‰€ä»¥åœ¨fine-tuningæ—¶ï¼Œä¹Ÿå¯ä»¥æƒ³ä¸€æƒ³åˆ°åº•æ˜¯å“ªç§ç²’åº¦çš„è¯­ä¹‰ä¿¡æ¯å¯¹ä»»åŠ¡æ›´é‡è¦ã€‚</p><h1><span id="self-knowledge-distillation">Self-Knowledge Distillation</span><a href="#self-knowledge-distillation" class="header-anchor"></a></h1><p>self-knowledge distillationï¼ˆè‡ªè’¸é¦ï¼‰ä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„æå‡ä¸‹æ¸¸ä»»åŠ¡çš„æ‰‹æ®µã€‚åšæ³•æ˜¯å…ˆåœ¨Task dataä¸Šfine-tuning ä¸€ä¸ªæ¨¡å‹ï¼Œç„¶åé€šè¿‡æ¨¡å‹å¾—åˆ°Task data çš„soft labelsï¼Œç„¶åä½¿ç”¨soft labels ä»£æ›¿hard label è¿›è¡Œfine-tuningã€‚æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹ä¹‹å‰çš„åšæ–‡<a href="https://xv44586.github.io/2020/08/31/bert-01/">Knowledge Distillationä¹‹çŸ¥è¯†è¿ç§»</a> </p><h1><span id="zhi-shi-zhu-ru">çŸ¥è¯†æ³¨å…¥</span><a href="#zhi-shi-zhu-ru" class="header-anchor"></a></h1><p>é€šè¿‡æ³¨å…¥å¤–éƒ¨çŸ¥è¯†åˆ°bertä¸­ä¹Ÿèƒ½æå‡Bertçš„æ€§èƒ½ï¼Œå¸¸ç”¨çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ol><li><em>åœ¨bert embedding å±‚æ³¨å…¥ï¼šé€šè¿‡å°†å¤–éƒ¨Embedding ä¸Bert token-embedding æ‹¼æ¥ï¼ˆç›¸åŠ ï¼‰è¿›è¡Œèåˆï¼Œç„¶åè¿›è¡Œtransformerä¸€èµ·ä½œç”¨ä¸‹æ¸¸ï¼›</em></li><li><em>åœ¨transformerçš„æœ€åä¸€å±‚ï¼Œæ‹¼æ¥å¤–éƒ¨embeddingï¼Œç„¶åä¸€èµ·ä½œç”¨ä¸‹æ¸¸ã€‚</em><br>å¦‚<a href="http://arxiv.org/abs/1909.08402" target="_blank" rel="noopener">Enriching BERT with Knowledge Graph Embeddings for Document Classification</a>ä¸­ï¼Œé€šè¿‡åœ¨<br>transformerçš„æœ€åä¸€å±‚ä¸­æ‹¼æ¥å…¶ä»–ä¿¡æ¯ï¼Œæé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚<br><img src="/2020/11/24/fine-tune/kg.png" alt></li></ol><h1><span id="shu-ju-zeng-qiang">æ•°æ®å¢å¼º</span><a href="#shu-ju-zeng-qiang" class="header-anchor"></a></h1><p>NLPä¸­æ•°æ®å¢å¼ºä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ä¿æŒè¯­ä¹‰çš„æ•°æ®å¢å¼ºï¼Œä¸€ç§æ˜¯å¯èƒ½ç ´åè¯­ä¹‰çš„å±€éƒ¨æ‰°åŠ¨å¢å¼ºã€‚ä¿æŒè¯­ä¹‰é€šå¸¸é‡‡ç”¨å›è¯‘æ³•ï¼Œå±€éƒ¨æ‰°åŠ¨çš„é€šå¸¸ä½¿ç”¨EDAï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹ä¹‹å‰åšæ–‡<a href="https://xv44586.github.io/2020/11/10/eda/">NLPä¸­çš„æ•°æ®å¢å¼º</a></p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬æ–‡æ€»ç»“äº†ä½¿ç”¨bert æ—¶ï¼Œå½“å‰ä¸»è¦çš„æå‡Bert åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„æ€§èƒ½çš„æ–¹æ³•ï¼Œé‡åˆ°ç›¸å…³é—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="BERT" scheme="https://xv44586.github.io/tags/BERT/"/>
    
  </entry>
  
  <entry>
    <title>Contrastive Learning</title>
    <link href="https://xv44586.github.io/2020/11/23/scl/"/>
    <id>https://xv44586.github.io/2020/11/23/scl/</id>
    <published>2020-11-23T13:21:36.000Z</published>
    <updated>2020-11-23T15:13:38.168Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#dui-bi-xue-xi">å¯¹æ¯”å­¦ä¹ </a></li><li><a href="#dui-bi-xue-xi-de-zi-jian-du-xue-xi">å¯¹æ¯”å­¦ä¹ çš„è‡ªç›‘ç£å­¦ä¹ </a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div><br>æœ€è¿‘çœ‹äº†ä¸¤ç¯‡å…³äºå¯¹æ¯”å­¦ä¹ ï¼ˆContrastive Learningï¼‰çš„è®ºæ–‡ï¼Œè§‰å¾—æ€è·¯æŒºæœ‰æ„æ€ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ã€‚</p><h1><span id="dui-bi-xue-xi">å¯¹æ¯”å­¦ä¹ </span><a href="#dui-bi-xue-xi" class="header-anchor"></a></h1><p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å°æ—¶å€™æŠ½è¯»è¯¾æ–‡çš„å›å¿†ï¼Œå½“è¯»åˆ°ä¸è®¤è¯†è¯»å­—æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šçŒœä»–çš„å‘éŸ³ã€‚çŒœçš„æ—¶å€™å‘¢ï¼Œé€šå¸¸å°±æ˜¯å…ˆçœ‹çœ‹ä»–çš„ç»„æˆéƒ¨åˆ†é‡Œæœ‰æ²¡æœ‰è®¤è¯†çš„ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¯»è®¤è¯†çš„éƒ¨åˆ†çš„å‘éŸ³ï¼Œå³è¯»<code>åŠè¾¹</code>, å¦‚æœæ‹†å¼€çš„éƒ¨åˆ†ä¸æ˜¯ç‹¬ç«‹çš„å­—ï¼Œé‚£æˆ‘ä»¬å°±ä¼šè”æƒ³ä¸€ä¸‹æœ‰å“ªäº›å­—è·Ÿä»–æœ‰å…±åŒçš„éƒ¨åˆ†ï¼Œç„¶åé‚£äº›å­—éƒ½æ˜¯å¦‚ä½•å‘éŸ³çš„ã€‚å³ä¾¿åˆ°äº†ç°åœ¨ï¼Œé‡åˆ°ä¸è®¤è¯†çš„å­—ï¼Œæˆ‘ä¾ç„¶ä¼šä½¿ç”¨è¿™ç§æ–¹æ³•å»<code>è¯»</code>. è€Œè¿™èƒŒåçš„åŸç†å…¶å®å°±æ˜¯æˆ‘ä»¬è®¤ä¸ºï¼Œè¯¥å­—ï¼ˆæ ·æœ¬xï¼‰ä¸å…¶ç›¸ä¼¼çš„å­—ï¼ˆè·ç¦»æ›´è¿‘çš„æ ·æœ¬ï¼‰å…·æœ‰ç›¸åŒçš„å‘éŸ³ï¼ˆlabelï¼‰ã€‚è¿™æ ·ä¸€ä¸ªæ²¡æœ‰ç»è¿‡å¤šå°‘å­¦ä¹ çš„<code>æ¨¡å‹</code>å´åœ¨å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å¥æ•ˆçš„ã€‚<br>è€Œå¯¹æ¯”å­¦ä¹ ä¸è¿™æœ‰ç€ç›¸ä¼¼çš„å«ä¹‰ï¼šæˆ‘ä»¬åœ¨å­¦ä¹ è¡¨ç¤ºçš„æ—¶å€™ï¼Œä¸éœ€è¦å®Œå®Œå…¨å…¨çš„å­¦ä¹ æ ·æœ¬çš„ç»†èŠ‚ï¼Œåªéœ€è¦è®©æ ·æœ¬ç›¸å¯¹å…¶æ­£æ ·æœ¬çš„å¾—åˆ†è¿œè¿œå¤§äºå…¶ç›¸å¯¹è´Ÿæ ·æœ¬çš„å¾—åˆ†å³å¯ï¼š<br>$$<br>s(f(x), f(x^+)) &gt;&gt; s(f(x),f(x^-))<br>$$<br>å…¶ä¸­ $f$æ˜¯æ˜ å°„å‡½æ•°ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„ä¸»è¦å­¦ä¹ ä»»åŠ¡ï¼Œ$s$æ˜¯ä¸€ä¸ªæ‰“åˆ†å‡½æ•°ï¼Œç”¨æ¥è¡¡é‡æ ·æœ¬ä¹‹é—´çš„è·ç¦»ï¼Œæœ€å¸¸ç”¨çš„å¦‚ç‚¹ç§¯ã€‚<br>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹æ¯”å­¦ä¹ çš„æ¡†æ¶ï¼Œè€Œè¦ä½¿ç”¨å¯¹æ¯”å­¦ä¹ ï¼Œæ ¸å¿ƒé—®é¢˜åªæœ‰ä¸¤ä¸ªï¼š</p><ol><li>å¦‚ä½•å®šä¹‰ç›®æ ‡å‡½æ•°ï¼Œä¸Šé¢æåˆ°çš„ç‚¹ç§¯å°±æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•é€šç”¨çš„æ–¹å¼ï¼Œæ­¤å¤–ï¼Œè¿˜å¯ä»¥ç”¨triple-lossç­‰ã€‚</li><li>å¦‚ä½•æ„é€ æ­£è´Ÿæ ·æœ¬ï¼Œæ­£è´Ÿæ ·æœ¬çš„æ„é€ ï¼Œåˆç†çš„æ­£è´Ÿæ ·æœ¬ï¼Œæ‰èƒ½è®©å­¦åˆ°çš„è¡¨ç¤ºæ›´å¥½çš„ä½œç”¨åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸Šã€‚</li></ol><p>æ­¤å¤–ï¼Œå¦‚æœç†Ÿæ‚‰Word2Vecçš„åŒå­¦ä¹Ÿä¼šå‘ç°ï¼Œå…¶å®è´Ÿé‡‡æ ·ä¹Ÿåœ¨å¯¹æ¯”å­¦ä¹ çš„èŒƒç•´ä¸­ï¼Œå³åœ¨ä½¿ç”¨è´Ÿé‡‡æ ·è®­ç»ƒWord2Vec æ—¶ï¼Œæˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æ˜¯è®©æ­£æ ·æœ¬å¯¹ä¹‹é—´çš„æ¦‚ç‡å°½å¯èƒ½çš„å¤§ï¼Œè€Œå…¶ä¸è´Ÿæ ·æœ¬ä¹‹é—´çš„æ¦‚ç‡å°½å¯èƒ½å°ï¼Œä¹Ÿå³æ‹‰è¿‘æ­£æ ·æœ¬å¯¹ä¹‹é—´çš„è·ç¦»ã€‚å…¶ä¸­å®šä¹‰çš„ç›®æ ‡å‡½æ•°ä½¿ç”¨çš„æ˜¯ç‚¹ç§¯ï¼Œè€Œæ­£æ ·æœ¬çš„æ„é€ æ˜¯é€šè¿‡çª—å£å¤§å°æ¥é€‰å–ï¼Œè´Ÿæ ·æœ¬çš„æ„é€ å³è´Ÿé‡‡æ ·ã€‚</p><h1><span id="dui-bi-xue-xi-de-zi-jian-du-xue-xi">å¯¹æ¯”å­¦ä¹ çš„è‡ªç›‘ç£å­¦ä¹ </span><a href="#dui-bi-xue-xi-de-zi-jian-du-xue-xi" class="header-anchor"></a></h1><p>ç›®å‰å­¦ä¹ è¡¨ç¤ºçš„ä¸»æµæ˜¯è‡ªç›‘ç£å­¦ä¹ ï¼Œé‚£ä¸ºäº†å¼•å…¥å¯¹æ¯”å­¦ä¹ ï¼Œæˆ‘ä»¬å°±éœ€è¦æ„é€ æ ·æœ¬çš„æ­£è´Ÿæ ·æœ¬ï¼Œå…¶ä¸­å¯ä»¥å°†æ‰€æœ‰éè‡ªå·±çš„æ ·æœ¬éƒ½è®¤ä¸ºæ˜¯è´Ÿæ ·æœ¬ï¼Œéœ€è¦æ‹‰è¿œï¼Œé‚£å¦‚ä½•æ„é€ æ­£æ ·æœ¬å‘¢ï¼Ÿç­”æ¡ˆæ˜¯data augmentationï¼ˆæ•°æ®å¢å¼ºï¼‰ã€‚åœ¨CV ä¸­é€šå¸¸ç”¨æ—‹è½¬ã€è£å‰ªç­‰</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
  </entry>
  
  <entry>
    <title>è·¨ç•Œä¹‹é˜¿å°”æ»‹æµ·é»˜ç—…çš„åˆ†ç±»ç«èµ›</title>
    <link href="https://xv44586.github.io/2020/11/21/ad-dti/"/>
    <id>https://xv44586.github.io/2020/11/21/ad-dti/</id>
    <published>2020-11-21T09:25:24.000Z</published>
    <updated>2020-11-24T16:23:06.675Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#bi-sai-jie-shao">æ¯”èµ›ä»‹ç»</a></li><li><a href="#shu-ju-te-dian">æ•°æ®ç‰¹ç‚¹</a></li><li><a href="#si-lu">æ€è·¯</a></li><li><a href="#jie-lun">ç»“è®º</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>å‡ å‘¨å‰å—å°ç‹èŒçš„é‚€è¯·ï¼Œå‚åŠ äº†å¤©æ´¥å¤§å­¦åŒ»å­¦éƒ¨ç»„ç»‡çš„ä¸€åœºå…³äº<a href="https://mp.weixin.qq.com/s/KlJOOvwqXkD1ANoVG2AOuw" target="_blank" rel="noopener">åˆ©ç”¨DTIå½±åƒè¿›è¡Œé˜¿å°”æ»‹æµ·é»˜ç—…çš„åˆ†ç±»ç«èµ›</a>ï¼Œç»“æœè™½ç„¶åªå¾—äº†ç¬¬å››åï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è·¨ç•Œå‚åŠ æ¯”èµ›ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ã€‚</p><h1><span id="bi-sai-jie-shao">æ¯”èµ›ä»‹ç»</span><a href="#bi-sai-jie-shao" class="header-anchor"></a></h1><p>å¼¥æ•£ç£å…±æŒ¯å½±åƒï¼ˆDTIï¼‰åœ¨<code>é˜¿å°”èŒ¨æµ·é»˜ç—…ï¼ˆAlzheimerâ€™s disease, ADï¼‰</code>ä¸­åº”ç”¨å¹¿æ³›ï¼Œä»DTIå½±åƒä¸­æå–æ‰©æ•£å‚æ•°å¯ä»¥ç”¨æ¥æè¿°ç™½è´¨ç»“æ„çš„å®Œæ•´æ€§ï¼Œè¿›è€Œæ˜¾ç¤ºADä¸­è„‘ç™½è´¨çš„é€€åŒ–æ¨¡å¼ã€‚åˆ©ç”¨æœºå™¨å­¦ä¹ çš„æ–¹æ³•å¯ä»¥æ¯”è¾ƒæœ‰æ•ˆçš„å¯¹ADè¿›è¡Œè¯Šæ–­å’Œåˆ†ç±»ã€‚æ‰€ä»¥æ¯”èµ›çš„å†…å®¹æ˜¯å¸Œæœ›é€‰æ‰‹é€šè¿‡ç»™å®šçš„18æ¡ä¸»è¦çš„è„‘ç™½è´¨çº¤ç»´æŸçš„æ‰©æ•£æŒ‡æ ‡ä½œä¸ºç‰¹å¾ï¼Œå»ºç«‹å¹¶è¯„ä¼°å‡ºå¯¹ADå’Œå¥åº·äººç¾¤çš„æœ€ä¼˜åˆ†ç±»æ¨¡å‹ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œè¿›ä¸€æ­¥æ¢ç´¢å¯¹è½»åº¦è®¤çŸ¥æŸå®³æ‚£è€…çš„é¢„æµ‹æ€§èƒ½ã€‚<br>è¯´æˆé€šä¿—ä¸€ç‚¹å°±æ˜¯ç»™å®šç”±18ä¸ªæ‰©æ•£æŒ‡æ ‡ç»„æˆçš„ä¸€ç³»åˆ—ç‰¹å¾ï¼Œç„¶åå¸Œæœ›é€‰æ‰‹é€šè¿‡è¿™äº›ç‰¹å¾æ¥å¯¹æ­£å¸¸äººä¸ç—…äººè¿›è¡Œå»ºæ¨¡ï¼Œè€Œè½»åº¦æ‚£è€…ç”±äºæ¯”è¾ƒéš¾åŒºåˆ†ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå¯èƒ½å°±ç»§ç»­åšå…³äºç—…äºº/è½»åº¦æ‚£è€…/æ­£å¸¸äººçš„åˆ†ç±»æ¨¡å‹ã€‚</p><h1><span id="shu-ju-te-dian">æ•°æ®ç‰¹ç‚¹</span><a href="#shu-ju-te-dian" class="header-anchor"></a></h1><p>æœ¬æ¬¡çš„æ•°æ®è™½ç„¶æ˜¯18ä¸ªæ‰©æ•£æŒ‡æ ‡ï¼Œå®é™…ä¸Šæ‹¿åˆ°çš„æ˜¯æ²¿18æ¡è„‘å†…ä¸»è¦çº¤ç»´æŸä¸Š100ä¸ªç‚¹çš„8ç§ä¸åŒçš„æŒ‡æ ‡ï¼Œå³æ¯ä¸ªçº¤ç»´æŸä¸Šæœ‰8ç§ä¸åŒæŒ‡æ ‡ï¼Œæ¯ä¸ªæŒ‡æ ‡æ˜¯æŒ‰é¡ºåºå›ºå®šé—´éš”é‡‡æ ·çš„100ä¸ªç‚¹ï¼Œåˆèµ·æ¥æ¯ä¸ªæ ·æœ¬æœ‰$18 <em> 8 </em> 100 $ä¸ª åŸºç¡€ç‰¹å¾ã€‚è€Œæ ·æœ¬åŒ…å«ä¸‰ä¸ªç±»åˆ«æ‰700ä¸ªå·¦å³ã€‚æ‰€ä»¥æ­¤æ¬¡çš„æ•°æ®æ˜¯ä¸€ä¸ªæ ·æœ¬å°‘è€ŒåŸºç¡€ç‰¹å¾ç‰¹åˆ«å¤šã€‚<br>æŒ‰æ¯ä¸€ç™¾ä¸ªç‚¹ä¸ºä¸€ä¸ªé›†åˆï¼Œé€šè¿‡ç®€å•çš„ç»Ÿè®¡ï¼Œå¤§å¤šæ•°å‡å€¼æ–¹å·®éƒ½åœ¨0ï½1ä¹‹é—´ï¼Œä¹Ÿæœ‰å‡ ä¸ªä¸ºè´Ÿå€¼ï¼Œè¿˜æœ‰å‡ ä¸ªä¸ºå‡ ç™¾çš„å¤§æ•°ã€‚åŒæ—¶æœ‰éƒ¨åˆ†æ•°æ®ä¸ºnanã€‚</p><h1><span id="si-lu">æ€è·¯</span><a href="#si-lu" class="header-anchor"></a></h1><p>åŸºäºä¸Šè¿°ç‰¹ç‚¹ï¼Œé¦–å…ˆè¦è§£å†³çš„æ˜¯æ ·æœ¬æ•°é‡å¤ªå°‘çš„é—®é¢˜ï¼Œå…¶æ¬¡éœ€è¦è§£å†³ç‰¹å¾å¤ªå¤šçš„é—®é¢˜ã€‚<br>é’ˆå¯¹ç‰¹å¾å¤ªå¤šçš„é—®é¢˜ï¼Œå¯ä»¥çœ‹ä½œæ˜¯é«˜ç»´æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡æ ·SVM ä¸ XGBoostä¸¤ç§æ–¹æ¡ˆæ¥åšï¼ŒSVMåœ¨é«˜ç»´ç¨€ç–æ•°æ®ä¸Šæ•ˆæœç›¸å¯¹è¾ƒå¥½ï¼Œè€ŒXGBoostæˆ‘ä»¬å°†å…¶çœ‹ä½œæ˜¯ä¸€ä¸ªç‰¹å¾é€‰æ‹©å™¨ï¼ˆencoderï¼‰ï¼Œç„¶ååœ¨å…¶åé¢æ¥ä¸€ä¸ªLRè¿›è¡Œåˆ†ç±»ã€‚<br>æ­¤å¤–ï¼Œç‰¹å¾è¿‡å¤šæˆ‘ä»¬ä¹Ÿå°è¯•äº†ä¸¤ç§å¹³æ»‘æ–¹æ¡ˆï¼Œå°†æ¯ä¸€ç™¾ä¸ªç‚¹çš„é›†åˆè¿›è¡Œé™çº¬ã€‚1. å¯¹æ¯ä¸€ç™¾ä¸ªç‚¹çš„é›†åˆä¸Šï¼Œæ¯åä¸ªç‚¹è¿›è¡Œæ±‚å‡å€¼æ–¹å·®æ¥ä»£æ›¿åŸå§‹ç‰¹å¾.  2. å¯¹å…¨é‡æ ·æœ¬æŒ‰label æ±‚å–å…¶ä¸­å¿ƒç‚¹ï¼Œç„¶åæ±‚å–å…¶å¯¹ä¸‰ä¸ªä¸­å¿ƒç‚¹çš„ <cdoe>Wasserstein Distance.<br>é’ˆå¯¹æ ·æœ¬å°‘çš„é—®é¢˜ï¼Œä¹Ÿå°è¯•äº†ä¸¤ç§æ–¹æ¡ˆï¼š1. åˆ©ç”¨GAN æ¥ç”Ÿæˆï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯å€Ÿé‰´ä¹‹å‰çœ‹åˆ°çš„ä¸€ç¯‡åˆ©ç”¨GAN æ¥åšCONV-19 çš„æ–‡ç« ï¼Œå…¶ä¸­ç”±äºæ ·æœ¬è¿‡å°‘ï¼Œé€šè¿‡GAN è¿›è¡Œç”Ÿæˆæ–°æ ·æœ¬åï¼Œæé«˜äº†æ¨¡å‹çš„æ€§èƒ½ï¼›å¦ä¸€ä¸ªæ–¹æ¡ˆæ˜¯äº’æ¢ç›¸åŒlabel çš„æ ·æœ¬ä¹‹é—´çš„ç‰¹å¾ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯ç”±GAN è”æƒ³åˆ°çš„ï¼Œå³GAN å®é™…ä¸Šåœ¨ç”Ÿæˆåˆ†å¸ƒç±»ä¼¼çš„ç‰¹å¾ï¼Œç„¶åç»„åˆæˆæ–°æ ·æœ¬ï¼Œä¸å…¶é€šè¿‡ä¸€ä¸ªæ¨¡å‹ç”Ÿæˆç›¸åŒåˆ†å¸ƒç„¶åç»„åˆï¼Œä¸ç„¶ç›´æ¥äº’æ¢ï¼Œè¿™æ ·ä»–ä»¬ä¸€å®šæ˜¯åŒåˆ†å¸ƒçš„ã€‚<br>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°è¯•äº†åˆ©ç”¨CNN æ¥æå–æ ·æœ¬ç‰¹å¾ç„¶åè¿›è¡Œåˆ†ç±»ã€‚</cdoe></p><h1><span id="jie-lun">ç»“è®º</span><a href="#jie-lun" class="header-anchor"></a></h1><ol><li>SVMä¸Šæ•ˆæœå®é™…æ¯”XGB ç•¥å·®ä¸€äº›ï¼Œæ‰€ä»¥æœ€åæ²¡æœ‰é‡‡æ ·SVMã€‚</li><li>XGBçš„æ•ˆæœæœ€åï¼Œå°¤å…¶æ˜¯å°†å…¶çœ‹ä½œç‰¹å¾æå–å™¨ï¼Œåœ¨åé¢æ¥äº†ä¸€ä¸ªåˆ†ç±»å™¨çš„æ¨¡å‹ã€‚</li><li>å¹³å‡æ–¹å·®å¹³æ»‘ä¸WD æ•ˆæœç±»ä¼¼ï¼Œæœ€åä¿ç•™äº†WD </li><li>GAN çš„æ•ˆæœè¾ƒå·®ï¼Œä¸€æ¥æ˜¯ç‰¹å¾è¿‡å¤šï¼ŒäºŒæ¥æ˜¯å¯¹GAN ä¸æ€ä¹ˆç†Ÿï¼Œä¸å¤ªä¼šè°ƒ</li><li>éšæœºäº’æ¢ç‰¹å¾æ•ˆæœæ—¶å¥½æ—¶åï¼Œæ„Ÿè§‰è¿™ä¹Ÿæ­£å¸¸ï¼Œæ¯•ç«Ÿç‰¹å¾ä¹‹é—´æ˜¯æœ‰å…³ç³»çš„</li><li>æ·±åº¦å­¦ä¹ åœ¨è¿™ç§æ•°æ®ä¸ŠåŸºæœ¬ä¸æ”¶æ•›</li></ol><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬ç¯‡ä¸»è¦æ˜¯æ€»ç»“ä¸€ä¸‹è·¨ç•Œå‚åŠ çš„ä¸€ä¸ªè„‘ç§‘å­¦æ¯”èµ›ï¼Œå‡ºå‘ç‚¹æ˜¯è§‰å¾—å¦‚æœèƒ½æœ‰ä»€ä¹ˆå¥½çš„æ•ˆæœï¼Œè¯´ä¸å®šèƒ½åšç‚¹è´¡çŒ®ï¼Œå®é™…å‚åŠ åå‘ç°å¾ˆå¤šé¢†åŸŸçš„é—®é¢˜ç”±äºå„ç§å„æ ·çš„é™åˆ¶ï¼Œå®é™…ä¸Šåº”ç”¨æœºå™¨å­¦ä¹ æ—¶è¿˜æ˜¯æœ‰å¾ˆå¤§éš¾åº¦çš„ã€‚æœ€åï¼Œè´´ä¸€ä¸‹æ’åå§ã€‚</p><p><img src="/2020/11/21/ad-dti/result.png" alt></p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>è¥¿ä¼¯åˆ©äºšæ£®æ—çŒ«</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="MachineLearning" scheme="https://xv44586.github.io/categories/MachineLearning/"/>
    
    
      <category term="Competition" scheme="https://xv44586.github.io/tags/Competition/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸­çš„æ•°æ®å¢å¼º</title>
    <link href="https://xv44586.github.io/2020/11/10/eda/"/>
    <id>https://xv44586.github.io/2020/11/10/eda/</id>
    <published>2020-11-10T14:33:41.000Z</published>
    <updated>2020-11-10T15:55:45.033Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#shu-ju-zeng-qiang">æ•°æ®å¢å¼º</a></li><li><a href="#bao-chi-yu-yi-shu-ju-zeng-qiang">ä¿æŒè¯­ä¹‰æ•°æ®å¢å¼º</a><ul><li><a href="#hui-yi">å›è¯‘</a></li><li><a href="#sheng-cheng">ç”Ÿæˆ</a></li></ul></li><li><a href="#ju-bu-rao-dong">å±€éƒ¨æ‰°åŠ¨</a><ul><li><a href="#tong-yi-ci-ti-huan">åŒä¹‰è¯æ›¿æ¢</a></li><li><a href="#cha-ru">æ’å…¥</a></li><li><a href="#shan-chu">åˆ é™¤</a></li><li><a href="#hu-huan">äº’æ¢</a></li></ul></li><li><a href="#zong-jie">æ€»ç»“</a></li></ul><!-- tocstop --><p></div><br>æœ€è¿‘æœ‰åŒå­¦é—®nlpä¸­å¦‚ä½•åšdata augmentationï¼Œè¿™ç¯‡æ€»ç»“ä¸‹ç›®å‰çŸ¥é“çš„æ–¹æ³•ã€‚</p><h1><span id="shu-ju-zeng-qiang">æ•°æ®å¢å¼º</span><a href="#shu-ju-zeng-qiang" class="header-anchor"></a></h1><p>æ•°æ®å¢å¼ºæŠ€æœ¯å·²ç»æ˜¯å›¾åƒé¢†åŸŸçš„æ ‡é…äº†ï¼Œå¦‚æ—‹è½¬ã€é•œåƒã€ç¿»è½¬ç­‰ã€‚ç”±äºå›¾åƒæœ¬èº«çš„ç‰¹æ€§ï¼Œé€šè¿‡è¿™äº›æ“ä½œåç”Ÿæˆçš„å›¾åƒè™½ç„¶ä¸åŸå§‹å›¾åƒä¸åŒï¼Œä½†å…¶å›¾åƒçš„å†…å®¹ç¡®å®åŸºæœ¬ä¸€è‡´çš„ã€‚æ‰€ä»¥å¯ä»¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§å’Œæ³›åŒ–èƒ½åŠ›ã€‚<br>è€Œåœ¨NLPé¢†åŸŸæƒ…å†µç¡®æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºNLPä¸­æ”¹å˜ä¸€ä¸ªè¯æœ‰å¯èƒ½å˜ä¸ºè¯­ä¹‰å®Œå…¨æƒ³åçš„å¥å­ï¼Œæ¯”å¦‚ï¼š<code>â€œè¿™å¥½åƒå§â€</code> -&gt; <code>â€œè¿™å¥½åƒå—â€</code>.<br>æ‰€ä»¥ï¼ŒNLPä¸­æ•°æ®å¢å¼ºä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ä¿æŒè¯­ä¹‰çš„æ•°æ®å¢å¼ºï¼Œä¸€ç§æ˜¯å¯èƒ½ç ´åè¯­ä¹‰çš„å±€éƒ¨æ‰°åŠ¨å¢å¼ºã€‚</p><h1><span id="bao-chi-yu-yi-shu-ju-zeng-qiang">ä¿æŒè¯­ä¹‰æ•°æ®å¢å¼º</span><a href="#bao-chi-yu-yi-shu-ju-zeng-qiang" class="header-anchor"></a></h1><p>ä¿æŒè¯­ä¹‰çš„æ•°æ®å¢å¼ºä¸»è¦æ˜¯æ„é€ ä¸åŸå¥å­è¯­ä¹‰ä¸€æ ·çš„æ–°å¥å­ï¼Œå¦‚å›è¯‘ã€ç”Ÿæˆç­‰ã€‚  </p><h2><span id="hui-yi">å›è¯‘</span><a href="#hui-yi" class="header-anchor"></a></h2><p>å›è¯‘å³å°†å¥å­ä»å½“å‰è¯­ç§ç¿»è¯‘è‡³æ–°çš„è¯­ç§ï¼Œç„¶åå†ç¿»è¯‘å›æ¥ï¼Œå¾—åˆ°è¯­ä¹‰ç›¸åŒè¡¨è¾¾ä¸åŒçš„å¥å­ã€‚å¦‚å°†å¥å­ä»ä¸­æ–‡ç¿»è¯‘ä¸ºè‹±æ–‡ç„¶åå†ç¿»è¯‘å›ä¸­æ–‡ã€‚å¯ä»¥å€ŸåŠ©å„å¤§äº’è”ç½‘å¹³å°çš„å…è´¹APIæ¥å®Œæˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å¤šç¿»è¯‘å‡ ç»„ä¸­é—´è¯­ç§ï¼Œå¢åŠ å…¶ä¸°å¯Œæ€§ã€‚  </p><h2><span id="sheng-cheng">ç”Ÿæˆ</span><a href="#sheng-cheng" class="header-anchor"></a></h2><p>ç”Ÿæˆçš„æ–¹å¼å³é€šè¿‡æ ·æœ¬æ„å»ºä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼Œç”Ÿæˆä¸æ ·æœ¬è¯­ä¹‰ç›¸åŒçš„å¥å­ã€‚å¦‚<a href="https://arxiv.org/abs/1906.06045" target="_blank" rel="noopener">Learning to Ask Unanswerable Questions for Machine Reading Comprehension</a> å°±æ˜¯é€šè¿‡ç”Ÿæˆæ–°çš„é—®é¢˜æ¥åšSQuAD2.0. æ­¤å¤–ï¼Œä¹‹å‰çš„æ–‡ç« <a href="https://xv44586.github.io/2020/08/22/qa-augmentation/">åˆ©ç”¨NLG å¢å¼ºQA ä»»åŠ¡æ€§èƒ½</a>é‡Œä¹Ÿæ€»ç»“äº†é€šè¿‡ç”Ÿæˆé—®é¢˜åŠé—®é¢˜ç­”æ¡ˆå¯¹æ¥å¢å¼ºqaæ¨¡å‹æ€§èƒ½ï¼Œä¸ç†Ÿæ‚‰çš„å¯ä»¥ç¿»çœ‹ä¸€ä¸‹ã€‚</p><p>ç”±äºä¸¤ç§æ–¹å¼æ„é€ çš„æ–°å¥å­éƒ½æ˜¯ä¸åŸå¥å­è¯­ä¹‰ç›¸åŒçš„å¥å­ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æ–¹å¼è¿›è¡Œæ•°æ®å¢å¼ºè¡¨è¾¾æ¨¡å‹åå¥½æ˜¯ï¼šæ¨¡å‹åº”å¯¹äºä¸åŒè¡¨è¾¾å½¢å¼çš„åŒä¸€è¯­ä¹‰çš„æ–‡æœ¬å…·æœ‰ä¸å˜æ€§ã€‚</p><h1><span id="ju-bu-rao-dong">å±€éƒ¨æ‰°åŠ¨</span><a href="#ju-bu-rao-dong" class="header-anchor"></a></h1><p>å±€éƒ¨æ‰°åŠ¨ä¸»è¦åŒ…æ‹¬åŒä¹‰è¯æ›¿æ¢ã€æ’å…¥ã€åˆ é™¤ã€äº’æ¢å››ç§æ“ä½œï¼Œå‡ºè‡ªè®ºæ–‡<a href="http://arxiv.org/abs/1901.11196" target="_blank" rel="noopener">EDA: Easy Data Augmentation Techniques for Boosting Performance on<br>Text Classification Tasks</a>,å› ä¸ºæ“ä½œç®€å•ï¼Œæ‰€ä»¥ä¹Ÿå«<code>EDA</code>ï¼ˆEasy Data Augmentation)ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™å››ç§ç­–ç•¥ã€‚</p><h2><span id="tong-yi-ci-ti-huan">åŒä¹‰è¯æ›¿æ¢</span><a href="#tong-yi-ci-ti-huan" class="header-anchor"></a></h2><p>ä»å¥å­ä¸­éšæœºæ‰¾å‡º1ä¸ªéåœç”¨è¯ï¼Œå¹¶æ±‚å‡ºå…¶åŒä¹‰è¯ï¼Œç„¶åç”¨åŒä¹‰è¯æ›¿æ¢è¯¥è¯ï¼Œé‡å¤næ¬¡æ“ä½œ</p><h2><span id="cha-ru">æ’å…¥</span><a href="#cha-ru" class="header-anchor"></a></h2><p>ä»å¥å­ä¸­éšæœºæ‰¾å‡ºä¸€ä¸ªéåœç”¨è¯ï¼Œå¹¶æ±‚å‡ºå…¶åŒä¹‰è¯ï¼Œç„¶åå°†åŒä¹‰è¯æ’å…¥å¥å­ä¸­çš„ä¸€ä¸ªéšæœºä½ç½®ï¼Œé‡å¤næ¬¡æ“ä½œã€‚</p><h2><span id="shan-chu">åˆ é™¤</span><a href="#shan-chu" class="header-anchor"></a></h2><p>ä»¥æ¦‚ç‡pï¼Œéšæœºåˆ é™¤å¥å­ä¸­çš„æ¯ä¸€ä¸ªå•è¯</p><h2><span id="hu-huan">äº’æ¢</span><a href="#hu-huan" class="header-anchor"></a></h2><p>éšæœºé€‰æ‹©å¥å­ä¸­çš„ä¸¤ä¸ªè¯ï¼Œç„¶åäº’æ¢å…¶ä½ç½®ï¼Œé‡å¤næ¬¡ã€‚<br>æ­¤å¤–ï¼Œè®ºæ–‡ä¸­ç»™å‡ºäº†æ›¿æ¢åˆ é™¤ç­‰æ“ä½œçš„æ¯”ä¾‹$\alpha$ ä¸æ–°å¢å¥å­æ•°é‡$n$ çš„å»ºè®®å€¼ï¼š<br><img src="/2020/11/10/eda/eda.png" alt>  </p><p>è€Œç°åœ¨æˆ‘ä»¬é€šå¸¸éƒ½ä½¿ç”¨bertç­‰transformeræ¨¡å‹åšä¸‹æ¸¸ä»»åŠ¡ï¼Œæ‰€ä»¥åˆ é™¤æ“ä½œå¯ä»¥ä½¿ç”¨paddingï¼Œå³åˆ é™¤tokenä½†ä¿ç•™å…¶å ä½ï¼Œå³ä¿ç•™å…¶ä½ç½®ç¼–ç ï¼›äº’æ¢æ“ä½œå¯ä»¥é€‰æ‹©æ›´å¤§çš„spanè¿›è¡Œï¼›æ’å…¥å’ŒåŒä¹‰è¯æ›¿æ¢æ“ä½œä¹Ÿå¯ä»¥å°è¯•ä»å½“å‰å¥å­é€‰æ‹©ä¸€ä¸ªè¯ä»£æ›¿åŒä¹‰è¯ç­‰ã€‚<br>æ–‡ç« å¼€å¤´æˆ‘ä»¬ä¹Ÿæåˆ°äº†ï¼Œå¯¹å¥å­ä¸­çš„è¯è¿›è¡Œæ”¹å˜æ—¶ï¼Œå¾ˆå¯èƒ½å¾—åˆ°è¯­ä¹‰å®Œå…¨ç›¸åçš„å¥å­ï¼Œé‚£ä¸Šé¢è¿™å››ç§æ–¹å¼ä¸ºä½•æœ‰æ•ˆå‘¢ï¼Ÿé¦–å…ˆï¼Œå¥å­ä¸­å¼•å…¥çš„æ–°è¯éƒ½æ˜¯åŒä¹‰è¯ï¼Œæ‰€ä»¥è¯­ä¹‰ä¸ä¼šå‘ç”Ÿå¾ˆå¤§çš„å˜æ¢ï¼Œå…¶æ¬¡ï¼Œè®ºæ–‡ä½œè€…é€šè¿‡åˆ†æå‘ç°ï¼Œè™½ç„¶æ„é€ çš„æ–°å¥å­å˜å¾—å¯èƒ½éƒ½ä¸æ˜¯ä¸€ä¸ªé€šé¡ºçš„å¥å­äº†ï¼Œä½†å…¶ç‰¹å¾ç©ºé—´åˆ†å¸ƒä¸‹çš„labelå¹¶æ²¡æœ‰å‘æ•£ï¼Œå³ç»è¿‡EDAå˜æ¢åï¼ŒåŸå§‹æ•°æ®ä¸€æ–¹é¢å¼•å…¥äº†å¾ˆå¤šå™ªå£°ï¼Œæ‰©å¤§äº†æ•°æ®é›†ï¼ŒåŒæ—¶åˆä¿æŒäº†åŸæœ‰çš„æ ‡ç­¾ï¼Œå› è€Œæœ‰æ•ˆçš„æ‰©å¤§äº†æ ·æœ¬é›†çš„ä¿¡æ¯å®¹é‡ã€‚<br>æ­¤å¤–ï¼Œä¸Šé¢çš„æ–¹å¼ç›¸å½“äºå¯¹æ¨¡å‹å¢åŠ äº†ä¸€ä¸ªæ­£åˆ™çº¦æŸï¼Œå…¶æ‰€è¡¨è¾¾çš„æ¨¡å‹åå¥½æ˜¯ï¼šæ¨¡å‹åº”è¯¥å¯¹æ–‡æœ¬çš„å±€éƒ¨å™ªå£°ä¸æ•æ„Ÿ</p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>ä»¥ä¸Šå°±æ˜¯å½“å‰NLPä¸­å¸¸ç”¨çš„å‡ ç§æ•°æ®å¢å¼ºæ–¹æ¡ˆï¼Œå°¤å…¶åœ¨æ ·æœ¬ä¸å‡è¡¡åŠå°æ ·æœ¬ä»»åŠ¡ä¸‹ï¼Œæ•°æ®å¢å¼ºå¾€å¾€èƒ½å¸¦æ¥éå¸¸ä¸é”™çš„æå‡ã€‚æ‰€ä»¥å€¼å¾—å°è¯•ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="EDA" scheme="https://xv44586.github.io/tags/EDA/"/>
    
  </entry>
  
  <entry>
    <title>ccfé—®ç­”åŒ¹é…æ¯”èµ›</title>
    <link href="https://xv44586.github.io/2020/11/08/ccf-qa/"/>
    <id>https://xv44586.github.io/2020/11/08/ccf-qa/</id>
    <published>2020-11-08T02:44:15.000Z</published>
    <updated>2021-02-24T01:00:00.125Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#bi-sai-shuo-ming">æ¯”èµ›è¯´æ˜</a></li><li><a href="#baseline">baseline</a><ul><li><a href="#qa-pair">qa pair</a></li><li><a href="#point">point</a></li><li><a href="#pet">pet</a></li><li><a href="#update-concat">update: concat</a></li></ul></li><li><a href="#dui-bi">å¯¹æ¯”</a></li><li><a href="#chang-shi">å°è¯•</a><ul><li><a href="#post-training">Post-training</a></li><li><a href="#focal-loss">focal loss</a></li><li><a href="#dui-kang-xun-lian-yu-ti-du-cheng-fa">å¯¹æŠ—è®­ç»ƒä¸æ¢¯åº¦æƒ©ç½š</a></li><li><a href="#tricks">tricks</a></li></ul></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>è¿™ä¸¤å‘¨ç©äº†ä¸€ä¸‹ccf 2020 ä¸­çš„<a href="https://www.datafountain.cn/competitions/474" target="_blank" rel="noopener">æˆ¿äº§èŠå¤©é—®ç­”åŒ¹é…</a>æ¯”èµ›ï¼Œè™½ç„¶è¿˜æ²¡å®Œèµ›ï¼Œä½†æ˜¯å…ˆæ€»ç»“ä¸€ä¸‹ç›®å‰çš„æ”¶è·ã€‚</p><h1><span id="bi-sai-shuo-ming">æ¯”èµ›è¯´æ˜</span><a href="#bi-sai-shuo-ming" class="header-anchor"></a></h1><p>é¦–å…ˆï¼Œè¿™ä¸ªæ¯”èµ›çš„ä»»åŠ¡æ˜¯åœ¨ä¸€ç³»åˆ—å›ç­”ä¸­æ‰¾åˆ°é’ˆå¯¹å®¢æˆ·é—®é¢˜çš„å›ç­”ã€‚è€Œå®¢æˆ·æé—®å‰çš„å¯¹è¯åŠå›ç­”å‰çš„å¯¹è¯éƒ½æ˜¯ä¸å¯è§çš„ï¼Œå³æ•´ä¸ªIMä¿¡æ¯æ˜¯ä¸è¿ç»­çš„ï¼Œä»»åŠ¡å°±æ˜¯åœ¨ä¸è¿ç»­çš„å›ç­”ä¸­æ‰¾åˆ°é‚£äº›é’ˆå¯¹å®¢æˆ·é—®é¢˜çš„ç­”æ¡ˆã€‚æ ·æœ¬ç¤ºä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">query: é‡‡è·ä¸€å°æ˜¯åˆ†æ ¡å§ã€‚</span><br><span class="line">reply:</span><br><span class="line">  æ˜¯çš„  <span class="number">0</span></span><br><span class="line">  æ­å·å¸‚é‡‡è·ç¬¬ä¸€å°å­¦é’±æ±Ÿè‹‘æ ¡åŒºï¼Œæ­å·å¸‚é’±æ±Ÿæ–°åŸå®éªŒå­¦æ ¡ã€‚  <span class="number">1</span></span><br><span class="line">  è¿™æ˜¯äº”æ¥¼  <span class="number">0</span></span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ·æœ¬ä¸­æ‰€è°“çš„é’ˆå¯¹é—®é¢˜çš„å›ç­”ï¼Œä¸ä»…ä»…æ˜¯ç›´æ¥å›ç­”é—®é¢˜çš„ç­”æ¡ˆï¼Œè€Œæ˜¯æ›´æœ‰é’ˆå¯¹æ€§å’Œè¯´æ˜çš„å›ç­”ã€‚</p><h1><span id="baseline">baseline</span><a href="#baseline" class="header-anchor"></a></h1><p>æ¨¡å‹é€‰æ‹©ä¸Šï¼Œbaselineå…¨éƒ¨ä½¿ç”¨bertï¼Œé‰´äºç›¸å¯¹ä½ç½®ç¼–ç ä¼˜äºç»å¯¹ä½ç½®ç¼–ç ï¼Œæ‰€ä»¥é€‰æ‹©<a href="https://github.com/huawei-noah/Pretrained-Language-Model/tree/master/NEZHA-TensorFlow" target="_blank" rel="noopener">NEZHA</a>ä½œä¸ºé¢„è®­ç»ƒæƒé‡ã€‚å¤‡é€‰æ–¹æ¡ˆRobertaã€‚</p><h2><span id="qa-pair">qa pair</span><a href="#qa-pair" class="header-anchor"></a></h2><p>ç”±äºå›ç­”æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥å¯ä»¥å°†é—®é¢˜å’Œç­”æ¡ˆä¸€ä¸€å¯¹åº”ï¼Œç»„æˆqa pairï¼Œç„¶ååˆ†åˆ«åˆ¤æ–­æ˜¯å¦æ˜¯é’ˆå¯¹é—®é¢˜çš„å›ç­”ã€‚</p><p><img src="/2020/11/08/ccf-qa/pair.png" alt="pair"></p><h2><span id="point">point</span><a href="#point" class="header-anchor"></a></h2><p>è™½ç„¶å¯¹è¯æ˜¯ä¸è¿ç»­çš„ï¼Œä½†æ˜¯æ˜¯åŒä¸€ä¸ªå¯¹è¯ï¼Œæ‰€ä»¥ä¸åŒçš„å›ç­”èƒ½ç›¸äº’æ”¯æ’‘ï¼Œæä¾›éƒ¨åˆ†ä¿¡æ¯ï¼Œæ‰€ä»¥ï¼Œç¬¬äºŒç§æ€è·¯å°±æ˜¯å°†åŒä¸€ä¸ªé—®é¢˜çš„æ‰€æœ‰å›ç­”éƒ½æ‹¼æ¥åœ¨å½“å‰å›ç­”åé¢ï¼Œç„¶ååŒæ—¶å¯¹æ¯ä¸€ä¸ªå›ç­”è¿›è¡Œåˆ¤æ–­ã€‚</p><p><img src="/2020/11/08/ccf-qa/point.png" alt="point"></p><h2><span id="pet">pet</span><a href="#pet" class="header-anchor"></a></h2><p>ç”±äºé¢„è®­ç»ƒæ¨¡å‹ä½¿ç”¨çš„è¯­æ–™ä¸å½“å‰ä»»åŠ¡æ‰€å¤„é¢†åŸŸæœ‰ä¸€å®šçš„gapï¼Œæ‰€ä»¥ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æƒ³æ³•æ˜¯å…ˆåœ¨ä»»åŠ¡è¯­æ–™ä¸Šè¿›è¡ŒPost-trainingï¼Œç„¶åå†è¿›è¡Œfine-tuningã€‚ä¸è¿‡ï¼Œä¸Šæ¬¡æˆ‘ä»¬ä»‹ç»è¿‡<code>Pattern-Exploiting Training</code>,ä¸äº†è§£çš„å¯ä»¥å‚è€ƒ<a href="https://xv44586.github.io/2020/10/25/pet/">PET-æ–‡æœ¬åˆ†ç±»çš„åˆä¸€ç§å¦™è§£</a>ã€‚å€Ÿé‰´PETçš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†posting-trainingä¸fine-tuningç»“åˆï¼Œå³åœ¨label dataä¸Šè¿›è¡Œpattern exploiting trainingï¼Œåœ¨unlable dataä¸Šè¿›è¡Œmlmä»»åŠ¡è¿›è¡Œpost-traing.</p><p><img src="/2020/11/08/ccf-qa/pet.png" alt="pet"></p><p>ä»¥ä¸Šä¸‰ç§baselineçš„ä»£ç æ”¾åœ¨<a href="https://github.com/xv44586/ccf_2020_qa_match" target="_blank" rel="noopener">ccf_2020_qa_match</a>,æ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥é˜…ã€‚</p><h2><span id="update-concat">update: concat</span><a href="#update-concat" class="header-anchor"></a></h2><p>ç”±äºbert ä¸åŒçš„transformer å±‚æå–åˆ°çš„è¯­ä¹‰ç²’åº¦ä¸åŒï¼Œè€Œä¸åŒç²’åº¦çš„ä¿¡æ¯å¯¹åˆ†ç±»æ¥è¯´èµ·åˆ°çš„ä½œç”¨ä¹Ÿä¸åŒï¼Œæ‰€ä»¥å¯ä»¥concatæ‰€ä»¥ç²’åº¦çš„è¯­ä¹‰ä¿¡æ¯ï¼Œæ‹¼æ¥åä½œä¸ºç‰¹å¾è¿›è¡Œåˆ†ç±»ã€‚<br><img src="/2020/11/08/ccf-qa/concat.png" alt="concat"></p><h1><span id="dui-bi">å¯¹æ¯”</span><a href="#dui-bi" class="header-anchor"></a></h1><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼ˆpair-wiseï¼‰ï¼Œç”±äºç¼ºå°‘ä¸€å®šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŠ ä¸Šå¾ˆå¤šå›ç­”éƒ½éå¸¸çŸ­ï¼ŒåŒæ—¶åˆå¯èƒ½ä¼šç¦»æé—®â€è¾ƒè¿œâ€ï¼Œæ‰€ä»¥æ•ˆæœæ˜¯æœ€å·®çš„ï¼Œä¸è¿‡çº¿ä¸Šæäº¤å•æ¨¡å‹ä¹Ÿæœ‰0.75å·¦å³äº†ï¼Œæ‰€ä»¥bertç¡®å®å¼ºå¤§ï¼<br>ç¬¬äºŒç§æ–¹æ¡ˆï¼ˆpointï¼‰ä¸­ï¼Œå°†æ‰€æœ‰å·²çŸ¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯éƒ½æ•´åˆåˆ°ä¸€èµ·ï¼Œæ‰€ä»¥ç›¸å¯¹ä¸Šä¸€ç§æœ‰æ‰€æå‡ï¼Œä¸è¿‡ç”±äºè¿™ç§ä¸Šä¸‹æ–‡çš„å¯è§æ€§ï¼Œæ‰€ä»¥ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„è¿·æƒ‘ï¼šå³å¯¹æŸä¸€ä¸ªreplyæ¥è¯´ï¼Œå‡å¦‚å…¶ä»–çš„replyä¸­æœ‰ä¸€ä¸ªæ˜¯é’ˆå¯¹æ€§çš„å›ç­”ï¼Œå°±æœ‰å¯èƒ½ä¼šå¹²æ‰°å¯¹å½“å‰replyçš„åˆ¤æ–­ã€‚<br>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼ˆpetï¼‰ä¸­ï¼Œé€šè¿‡mlmè¿›è¡Œpost-trainingï¼Œå¯ä»¥å°†é¢†åŸŸé—´çš„gapç¼©å°ï¼ŒåŒæ—¶ï¼Œç”±äºåœ¨è®­ç»ƒæ—¶â€çœ‹åˆ°â€äº†æµ‹è¯•æ•°æ®ï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°äº†çº¿ä¸Šçº¿ä¸‹çš„å·®è·ï¼Œæ‰€ä»¥æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œå•æ¨¡å‹æœ€å¥½èƒ½è¾¾åˆ°0.765å·¦å³ã€‚</p><h1><span id="chang-shi">å°è¯•</span><a href="#chang-shi" class="header-anchor"></a></h1><h2><span id="post-training">Post-training</span><a href="#post-training" class="header-anchor"></a></h2><p>ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯å°è¯•è¿›è¡Œpost-trainingï¼Œæ¥æå‡æ‰€æœ‰æ–¹æ¡ˆçš„æ€§èƒ½ã€‚ç”±äºé—®ç­”ä¹‹é—´æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨ç»„ç»‡è¯­æ–™ä¸Šè¿›è¡Œäº†ä¸åŒæ–¹å¼ï¼š</p><ol><li>query-reply pair</li><li>query-reply-list pair</li><li>cut-sentence to make pair</li></ol><p>ä»¥ä¸Šæ–‡æåˆ°çš„æ ·æœ¬ä¸ºä¾‹ï¼›</p><ol><li>query-reply pair:</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é‡‡è·ä¸€å°æ˜¯åˆ†æ ¡å§ã€‚</span><br><span class="line">æ˜¯çš„</span><br><span class="line"></span><br><span class="line">é‡‡è·ä¸€å°æ˜¯åˆ†æ ¡å§ã€‚</span><br><span class="line">æ­å·å¸‚é‡‡è·ç¬¬ä¸€å°å­¦é’±æ±Ÿè‹‘æ ¡åŒºï¼Œæ­å·å¸‚é’±æ±Ÿæ–°åŸå®éªŒå­¦æ ¡ã€‚</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="2"><li><p>query-reply-list pair</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é‡‡è·ä¸€å°æ˜¯åˆ†æ ¡å§ã€‚</span><br><span class="line">æ˜¯çš„ æ­å·å¸‚é‡‡è·ç¬¬ä¸€å°å­¦é’±æ±Ÿè‹‘æ ¡åŒºï¼Œæ­å·å¸‚é’±æ±Ÿæ–°åŸå®éªŒå­¦æ ¡ã€‚  è¿™æ˜¯äº”æ¥¼</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>cut-sentence to make pair</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">é‡‡è·ä¸€å°</span><br><span class="line">æ˜¯åˆ†æ ¡å§ã€‚</span><br><span class="line"></span><br><span class="line">æ˜¯</span><br><span class="line">çš„</span><br><span class="line"></span><br><span class="line">æ­å·å¸‚é‡‡è·ç¬¬ä¸€å°å­¦é’±æ±Ÿè‹‘æ ¡åŒºï¼Œ</span><br><span class="line">æ­å·å¸‚é’±æ±Ÿæ–°åŸå®éªŒå­¦æ ¡ã€‚</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ol><p>ç¬¬ä¸€ç§ï¼Œå°†åŒä¸€å¯¹è¯ä½œä¸ºåŒä¸€ç¯‡æ–‡æ¡£é¡ºåºæ’åˆ—ï¼›ç¬¬äºŒç§ï¼Œå°†é—®é¢˜ä½œä¸ºå•ç‹¬æ–‡æ¡£ï¼ŒåŒä¸€é—®é¢˜çš„æ‰€æœ‰å›ç­”ä½œä¸ºå•ç‹¬æ–‡æ¡£ï¼Œç¬¬ä¸‰ç§ï¼Œå°†é—®é¢˜å’Œå›ç­”éƒ½ä½œä¸ºå•ç‹¬æ–‡æ¡£ï¼ŒåŒæ—¶å°†å…¶æ‹†åˆ†ä¸ºå·¦å³ä¸¤ä¸ªéƒ¨åˆ†æ¥åšnspä»»åŠ¡ã€‚<br>åœ¨maské€‰æ‹©ä¸Šï¼Œé€‰æ‹©åŠ¨æ€maskï¼Œå³æ¯ä¸ªepochéƒ½é‡æ–°é€‰æ‹©maskçš„tokenã€‚</p><p>æœ€ç»ˆç»“æœæ˜¯å¦‚æœç›´æ¥ä½¿ç”¨<code>[CLS]</code>åšæœ€ç»ˆç‰¹å¾ï¼Œä»¥ä¸Šä¸‰ç§éƒ½ä¸èƒ½å¸¦æ¥pair-wiseæ–¹æ¡ˆçš„æå‡ï¼Œåè€Œä¼šå¸¦æ¥ä¸å°çš„é™ä½ï¼ŒçŒœæµ‹åŸå› å¯èƒ½ä¸ä»¥ä¸Šä¸‰ç§æ–¹å¼çš„nspä»»åŠ¡ä¸å½“å‰ä»»åŠ¡çš„æ¨¡å¼ä¸åŒï¼Œæ‰€ä»¥åè€Œä¼šå¼•èµ·é™ä½ã€‚è€Œåœ¨bert åé¢æ¥å…¶ä»–å±‚ï¼ˆAttentionPooling1Dï¼ŒDGCNNï¼‰åèƒ½å¸¦æ¥å¤§çº¦ä¸€ä¸ªç‚¹å·¦å³æå‡ã€‚</p><h2><span id="focal-loss">focal loss</span><a href="#focal-loss" class="header-anchor"></a></h2><p>ç”±äºé’ˆå¯¹æ€§å›ç­”ä¸éé’ˆå¯¹æ€§å›ç­”åœ¨æ•°é‡ä¸Šæœ‰ä¸å°å·®è·ï¼Œå¤§çº¦3:1ï¼Œæ‰€ä»¥ä¹Ÿæƒ³åˆ°å°è¯•åœ¨lossä¸Šè¿›è¡Œè°ƒèŠ‚ã€‚<br>æœ€ç»ˆç»“æœæ˜¯æ²¡æœ‰å¤šå°‘æå‡ï¼Œæœ€åå°†æ™®é€šlossè®­ç»ƒåçš„æ¨¡å‹åœ¨train dataä¸Šè¿›è¡Œäº†predictï¼Œå¹¶å€Ÿé‰´ä¹‹å‰<a href="https://xv44586.github.io/2020/10/14/focal-loss/">focal loss</a>ä¸­çš„æ–¹å¼åˆ†æäº†ä¸€ä¸‹ï¼Œç”»å‡ºå¯¹åº”çš„éš¾æ˜“æ ·æœ¬åˆ†å¸ƒã€‚<br><img src="/2020/11/08/ccf-qa/focalloss.png" alt></p><p>ä¸Šå›¾ä¸­ä¸éš¾å‘ç°å…¶éš¾æ ·æœ¬å¹¶ä¸å¤šä¹Ÿä¸èšé›†ï¼Œæ‰€ä»¥focal losså¹¶ä¸èƒ½å¸¦æ¥æå‡ã€‚</p><h2><span id="dui-kang-xun-lian-yu-ti-du-cheng-fa">å¯¹æŠ—è®­ç»ƒä¸æ¢¯åº¦æƒ©ç½š</span><a href="#dui-kang-xun-lian-yu-ti-du-cheng-fa" class="header-anchor"></a></h2><p>å¯¹æŠ—è®­ç»ƒä¸æ¢¯åº¦æƒ©ç½šä¹Ÿæ˜¯ä¸¤ç§æ¯”è¾ƒæœ‰æ•ˆçš„æå‡æ¨¡å‹æ³›åŒ–æ€§èƒ½çš„æ–¹æ³•ã€‚å…¶ä¸­å¯¹æŠ—é‡‡ç”¨çš„FGMã€‚<br>æœ€ç»ˆå®éªŒåå‘ç°ä¸¤è€…éƒ½èƒ½å¸¦æ¥çº¿ä¸Šçº¿ä¸‹çš„æå‡ï¼Œå°¤å…¶æ˜¯å¯¹æŠ—ï¼Œæœ€é«˜èƒ½æå‡ä¸‰ä¸ªç‚¹ï¼Œä¸è¿‡ç›¸åŒå‚æ•°ä¸‹ç»“æœä¹Ÿä¼šå·®äºŒä¸ªç‚¹å·¦å³ï¼Œæ‰€ä»¥æ¯ä¸ªæ¨¡å‹éƒ½è¦å°‘ä¸äº†è°ƒå‚çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥é€‚åˆåæœŸæé«˜æ—¶ä½¿ç”¨ã€‚</p><h2><span id="tricks">tricks</span><a href="#tricks" class="header-anchor"></a></h2><p>ç”±äºä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡åšæ¯”èµ›ï¼Œæ‰€ä»¥èµ°äº†ä¸å°‘å¼¯è·¯ï¼Œä¹Ÿå­¦åˆ°äº†ä¸€äº›trickï¼š</p><ol><li>å¯¹æ ·æœ¬è¿›è¡Œkfoldç„¶åè®­ç»ƒï¼Œå¾—åˆ°kä¸ªæ¨¡å‹å†è¿›è¡Œensembleã€‚å…¶ä¸­kä»5å¢åŠ åˆ°10ï¼Œä¹Ÿä¼šæœ‰æå‡ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯å¯ä»¥è®©æ›´å¤šçš„æ•°æ®å‚ä¸åˆ°è®­ç»ƒï¼ŒåŒæ—¶å¤šä¸ªæ¨¡å‹è¿›è¡ŒæŠ•ç¥¨ï¼Œä¹Ÿä¼šå¸¦æ¥æˆ–å¤šæˆ–å°‘çš„æå‡ã€‚</li><li>å¯¹æ•°æ®è¿›è¡Œpost-trainingï¼Œè™½ç„¶æˆ‘çš„å°è¯•æš‚æ—¶æ²¡æœ‰èµ·åˆ°æå‡ï¼Œä½†æ˜¯äº¤æµæ—¶æœ‰å…¶ä»–ç»„çš„åŒå­¦é€šè¿‡è¿™ä¸ªæ–¹æ³•å°±è¾¾åˆ°å•æ¨¡å‹0.77ä»¥ä¸Šã€‚è€Œæˆ‘ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ï¼Œpetçš„æ–¹å¼ä¹Ÿæ˜¯æœ€å¥½çš„ï¼Œæ‰€ä»¥ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šè¯´æ˜è¿™ç§æ–¹å¼çš„æœ‰æ•ˆæ€§ã€‚</li><li>bertåæ¥æ–°çš„å±‚ï¼Œå¦‚cnn,dgcnnç­‰ã€‚è™½ç„¶bertçš„ç‰¹å¾æå–èƒ½åŠ›å¼ºå¤§ï¼Œä½†æ˜¯åœ¨bertåé¢æ¥ä¸€äº›æ–°çš„å±‚ï¼Œæ€»èƒ½å¸¦æ¥ä¸€å®šçš„æå‡ï¼Œå°¤å…¶æ˜¯DGCNNã€‚è¿™ç§æ–¹å¼å¯ä»¥çœ‹ä½œæ˜¯ä¸¤ç§æ¨¡å‹çš„stackingï¼Œå³åˆ©ç”¨bertåšç‰¹å¾æå–ï¼Œåé¢çš„æ¨¡å‹åœ¨å…¶ä¸Šåšä¸‹æ¸¸ä»»åŠ¡ã€‚</li><li>ä¸åŒæ¨¡å‹è¿›è¡Œensembleï¼Œå¦‚å°†ä¸Šè¿°ä¸‰ç§æ–¹æ¡ˆè¿›è¡Œensembleï¼Œç”±äºä¸åŒæ¨¡å‹å…³æ³¨ç‚¹ä¸åŒï¼Œèåˆåä¼šå¸¦æ¥ä¸€å®šæå‡ã€‚</li><li>æ›´å¤§çš„æ¨¡å‹ï¼Œå¦‚bert-xxlargeç­‰ã€‚è™½ç„¶æˆ‘çš„æ˜¾å¡æ²¡æ³•å®éªŒè¿™ç§æ–¹æ¡ˆï¼Œä½†æ˜¯äº¤æµåå‘ç°å¾ˆå¤šåŒå­¦éƒ½æ˜¯ä½¿ç”¨çš„å¤§æ¨¡å‹ï¼Œbaselineå°±å¯ä»¥è¾¾åˆ°0.77ä»¥ä¸Šäº†ï¼Œæ‰€ä»¥æœ‰æ—¶å€™è¿˜æ˜¯éœ€è¦ä¸€äº›â€é’èƒ½åŠ›â€.</li><li>æ•°æ®æ¸…æ´—ä¸å¢å¼ºã€‚äº¤æµä¸­æœ‰äººæåˆ°ç”¨å¤–éƒ¨æ•°æ®åšå¢å¼ºï¼Œæ‰€ä»¥å¦‚æœæœ‰èƒ½åŠ›ï¼Œå…ˆåšæ¸…æ´—ä¸å¢å¼ºï¼Œç»“æœä¹Ÿä¼šæå‡å¾ˆå¤šã€‚</li></ol><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>ä»¥ä¸Šå°±æ˜¯å¯¹å½“å‰æ¯”èµ›çš„ä¸€äº›æ€è€ƒä¸æ€»ç»“ï¼Œç°åœ¨å•æ¨¡å‹æœ€å¥½çš„æˆç»©ä¸ºçº¿ä¸Š<code>0.7779</code>, è™½ç„¶åªæ’åˆ°61åï¼Œä¸è¿‡é‰´äºæˆ‘ä½¿ç”¨çš„æ˜¯baseæ¨¡å‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å•æ¨¡å‹ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–åç»­å¤„ç†ï¼Œæ‰€ä»¥ç»“æœæ„Ÿè§‰è¿˜è¡Œã€‚åç»­å®Œèµ›åå¦‚æœæœ‰æ–°çš„æ”¶è·å†æ›´æ–°ä¸€ç¯‡å§ã€‚æœ€åï¼Œé™„ä¸Šæš‚æ—¶æ’åæˆªå›¾ã€‚</p><p><img src="/2020/11/08/ccf-qa/leadboard.png" alt></p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="QA" scheme="https://xv44586.github.io/tags/QA/"/>
    
      <category term="CCF" scheme="https://xv44586.github.io/tags/CCF/"/>
    
      <category term="Competition" scheme="https://xv44586.github.io/tags/Competition/"/>
    
  </entry>
  
  <entry>
    <title>PET-æ–‡æœ¬åˆ†ç±»çš„åˆä¸€ç§å¦™è§£</title>
    <link href="https://xv44586.github.io/2020/10/25/pet/"/>
    <id>https://xv44586.github.io/2020/10/25/pet/</id>
    <published>2020-10-25T03:30:31.000Z</published>
    <updated>2020-10-27T13:11:56.892Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#classification-to-nlg">Classification to NLG</a></li><li><a href="#mlm">MLM</a></li><li><a href="#ren-wu-zhuan-huan">ä»»åŠ¡è½¬æ¢</a></li><li><a href="#pattern-exploiting-training">Pattern-Exploiting Training</a></li><li><a href="#yu-nlg-chai-yi">ä¸NLGå·®å¼‚</a></li><li><a href="#shi-yan">å®éªŒ</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div><br>ä¹‹å‰çš„ä¸€ç¯‡<a href="https://xv44586.github.io/2020/09/13/classification-label-augment/">ã€Šæ¨¡å‹å¢å¼º-ä»labelä¸‹æ‰‹ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†é€šè¿‡è½¬æ¢labelï¼Œå°†åˆ†ç±»è½¬æ¢ä¸ºNLGçš„æ–¹æ³•ï¼Œè€Œç”±äºæ€§èƒ½æ²¡æœ‰å¾—åˆ°å¢åŠ ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ç»§ç»­å¾€ä¸‹åšã€‚ä»Šå¤©çœ‹åˆ°ä¸¤ç¯‡æ–‡ç« ï¼Œæ€è·¯ç•¥å¾®ç›¸ä¼¼ï¼Œä¹Ÿè®©æˆ‘çœ¼å‰ä¸€äº®ï¼Œå‘ç°åŸæ¥æˆ‘ä¸é¡¶ä¼šæ€è·¯è¿™ä¹ˆè¿‘ï¼ˆè¯¯ï¼‰ï¼Œæ‰€ä»¥æ€»ç»“å¯¹æ¯”ä¸€ä¸‹ã€‚</p><h1><span id="classification-to-nlg">Classification to NLG</span><a href="#classification-to-nlg" class="header-anchor"></a></h1><p>å¯¹äºåˆ†ç±»ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªç”Ÿæˆä»»åŠ¡ã€‚æ¯”å¦‚æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªæ ·æœ¬ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"contextï¼š'ã€Œå¤©å¤©ç‰¹ä»·æˆ¿ã€ååº­ä»å’Œå›½é™… 3å®¤2å…2å«ä»…å”®65ä¸‡', label: 'æˆ¿äº§', label_id: 0"</span></span><br></pre></td></tr></table></figure></p><p>é€šå¸¸æˆ‘ä»¬ç›´æ¥é¢„æµ‹å¯¹åº”çš„label idï¼Œè€Œç”±äºå…¶ä¹Ÿæœ‰labelï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªNLGä»»åŠ¡ï¼Œå³ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"contextï¼š['ã€Œå¤©å¤©ç‰¹ä»·æˆ¿ã€ååº­ä»å’Œå›½é™… 3å®¤2å…2å«ä»…å”®65ä¸‡', 'æˆ¿äº§']"</span></span><br></pre></td></tr></table></figure></p><p>å³é€šè¿‡æ ·æœ¬ç”Ÿæˆlabelå¯¹åº”çš„tokenã€‚å€ŸåŠ©UniLMåŒæ—¶å…·æœ‰NLUä¸NLGçš„èƒ½åŠ›ï¼Œåªéœ€è¦å¾ˆå°çš„æ”¹åŠ¨å°±å¯ä»¥åˆ©ç”¨BERTåšè¯¥ä»»åŠ¡äº†ï¼Œå¯¹åº”çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><img src="/2020/10/25/pet/unilm.png" alt></p><p>ä¸è¿‡å½“æ—¶è€ƒè™‘åˆ°UniLMä¸­æåˆ°seq2seqçš„è®­ç»ƒ<code>ä¸èƒ½</code>æé«˜NLUçš„èƒ½åŠ›ï¼Œæ‰€ä»¥å½“æ—¶å¹¶æ²¡æœ‰é€‰æ‹©ä½¿ç”¨MLMæ¥å°è¯•ï¼Œæœ€åå¾—åˆ°çš„ç»“è®ºæ˜¯ï¼š</p><p>1.<em> å°†åˆ†ç±»è½¬ä¸ºç”Ÿæˆåï¼Œæ€§èƒ½åŸºæœ¬ä¸€è‡´ï¼›</em><br>2.<em> å°†åˆ†ç±»ä¸ç”Ÿæˆè”åˆèµ·æ¥è®­ç»ƒï¼Œæ€§èƒ½ä¸å•ä¸ªä»»åŠ¡æ€§èƒ½åŸºæœ¬ä¸€è‡´ã€‚</em></p><h1><span id="mlm">MLM</span><a href="#mlm" class="header-anchor"></a></h1><p>MLM,å³Masked Language Model,ä¸­æ–‡ç¿»è¯‘åˆå«â€œæ©ç è¯­è¨€æ¨¡å‹â€ï¼Œå³ä»¥è‡ªç›‘ç£çš„æ–¹å¼ï¼Œmask æ‰ä¸€éƒ¨åˆ†ï¼Œç„¶åé€šè¿‡å‰©ä½™çš„éƒ¨åˆ†æ¥è¿˜åŸè¢«mask æ‰çš„éƒ¨åˆ†ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><img src="/2020/10/25/pet/mlm.png" alt></p><p>è€Œmaskçš„æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼Œå¦‚éšæœºé€‰æ‹©tokenè¿›è¡Œmaskï¼›å°†tokenæ‰€åœ¨çš„æ•´ä¸ªè¯éƒ½maskï¼ˆwhole word maskï¼‰ï¼›æˆ–è€…å°†æŸä¸ªspanå†…çš„tokenéƒ½maskæ‰ï¼ˆspan maskï¼‰ã€‚<br>è™½ç„¶mlmåœ¨é¢„è®­ç»ƒä»»åŠ¡ä¸Šå·²ç»è¢«è¯æ˜ååˆ†æœ‰æ•ˆï¼Œä½†æ˜¯é€šå¸¸è®¤ä¸ºmlméƒ¨åˆ†çš„å‚æ•°æ˜¯ä¸mlmä»»åŠ¡ç›¸å…³çš„ï¼Œè€Œé€šå¸¸åœ¨ä¸‹æ¸¸ä»»åŠ¡ä¸­æˆ‘ä»¬æ˜¯åˆ«çš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä¼šèˆå¼ƒæ‰è¿™éƒ¨åˆ†å‚æ•°ï¼Œè€Œåªä½¿ç”¨encoderéƒ¨åˆ†ã€‚<br>ä½†æ˜¯è®ºæ–‡<a href="http://arxiv.org/abs/2009.07118" target="_blank" rel="noopener">Itâ€™s Not Just Size That Matters: Small Language Models Are Also Few-Shot Learners</a>ä¸<a href="http://arxiv.org/abs/2001.07676" target="_blank" rel="noopener">Exploiting Cloze Questions for Few Shot Text Classification and Natural Language Inference</a>å´å‘Šè¯‰æˆ‘ä»¬ï¼Œmlmä¸ä»…æœ‰ç”¨ï¼Œåœ¨few-shotåœºæ™¯ä¸‹ï¼Œé€šè¿‡ä¸€ä¸‹ç®€å•çš„èåˆæ‰‹æ®µï¼Œæ€§èƒ½èƒ½è¶…è¿‡å½“å‰çš„æ˜æ˜ŸGPT-3.</p><h1><span id="ren-wu-zhuan-huan">ä»»åŠ¡è½¬æ¢</span><a href="#ren-wu-zhuan-huan" class="header-anchor"></a></h1><p>ä¸ä¹‹å‰çš„æ€è·¯ç±»ä¼¼ï¼Œæˆ‘ä»¬é’ˆå¯¹åˆ†ç±»ä»»åŠ¡ï¼Œä¸å†ç›´æ¥å¯¹labelè¿›è¡Œé¢„æµ‹ï¼Œè€Œæ˜¯é¢„æµ‹å…¶label descriptionï¼Œå³å°†å…¶è½¬æ¢ä¸ºå®Œå½¢å¡«ç©ºå½¢å¼çš„ä»»åŠ¡ï¼Œæ¥é¢„æµ‹ä¸åŒlabel descriptionçš„æ¦‚ç‡ã€‚<br>è€Œå¦‚ä½•è½¬æ¢æˆå®Œå½¢å¡«ç©ºå‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç®€å•çš„è¯­ä¹‰é€šé¡ºçš„æè¿°ï¼Œç„¶åå°†å…¶ä¸­ä¸åˆ†ç±»æœ‰å…³çš„å†…å®¹maskæ‰å³å¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼š<br>å‡å¦‚æˆ‘ä»¬ç°åœ¨çš„ä»»åŠ¡æ˜¯çŸ­æ–‡æœ¬åˆ†ç±»ï¼Œä¸€ä¸ªæ ·æœ¬ä¸ºâ€œcontextï¼šâ€™ã€Œå¤©å¤©ç‰¹ä»·æˆ¿ã€ååº­ä»å’Œå›½é™… 3å®¤2å…2å«ä»…å”®65ä¸‡â€™, label: â€˜æˆ¿äº§â€™â€ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç»Ÿä¸€çš„æè¿°å¥ï¼Œå°†å…¶å˜ä¸ºï¼š<br>â€œä¸‹é¢æ˜¯ä¸€åˆ™__ç›¸å…³æ–°é—»æ ‡é¢˜: ã€Œå¤©å¤©ç‰¹ä»·æˆ¿ã€ååº­ä»å’Œå›½é™… 3å®¤2å…2å«ä»…å”®65ä¸‡â€,å…¶ä¸­çš„ç©ºæ ¼å¯é€‰çš„å†…å®¹æ˜¯æ‰€æœ‰çš„label descriptionï¼Œå¯¹åº”çš„çœŸå®å€¼æ˜¯â€æˆ¿äº§â€ä¸¤ä¸ªå­—ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å°†åˆ†ç±»ä»»åŠ¡è½¬æ¢ä¸ºä¸€ä¸ªå®Œå½¢å¡«ç©ºçš„å½¢å¼ã€‚<br>è€Œæ·»åŠ çš„æ–¹å¼ä¹Ÿå¯ä»¥åˆ†ä¸ºå‰ç¼€ã€åç¼€ä¸¤ç§ï¼Œå®Œæ•´çš„æ–¹å¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"ä»¥ä¸‹æ˜¯ä¸€åˆ™__ç›¸å…³æ–°é—»æ ‡é¢˜: ã€Œå¤©å¤©ç‰¹ä»·æˆ¿ã€ååº­ä»å’Œå›½é™… 3å®¤2å…2å«ä»…å”®65ä¸‡"</span></span><br><span class="line"><span class="string">"ã€Œå¤©å¤©ç‰¹ä»·æˆ¿ã€ååº­ä»å’Œå›½é™… 3å®¤2å…2å«ä»…å”®65ä¸‡ï¼Œä»¥ä¸Šæ˜¯ä¸€åˆ™__ç›¸å…³æ–°é—»æ ‡é¢˜"</span></span><br></pre></td></tr></table></figure></p><h1><span id="pattern-exploiting-training">Pattern-Exploiting Training</span><a href="#pattern-exploiting-training" class="header-anchor"></a></h1><p>ä¸Šé¢æˆ‘ä»¬æ·»åŠ çš„å‰ç¼€/åç¼€å¥å­ç§°ä¸º<code>Pattern</code>, è€Œlabel descriptionå¯ä»¥æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚ï¼Œå¯¹äºâ€œæˆ¿äº§â€è¿™ä¸ªlabelï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨â€œåœ°äº§â€æ¥è¡¨è¾¾ï¼Œå¯¹äºâ€œå¨±ä¹â€labelï¼Œä¹Ÿå¯ä»¥ç”¨â€œå…«å¦â€æ¥è¡¨è¾¾ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªtokenåˆ°labelçš„æ˜ å°„ï¼Œè¿™ä¸ªæ˜ å°„å¯ä»¥æ˜¯å¤šå¯¹ä¸€çš„ï¼Œè¿™ä¸ªè¢«ç§°ä¸º<code>Verbalizer</code>,æ‰€ä»¥åœ¨é¢„æµ‹æ—¶å¯ä»¥å°†å¤šä¸ªtokençš„æ¦‚ç‡ç»“åˆèµ·æ¥åˆ¤æ–­å…¶å¯¹åº”çš„labelã€‚<br>ç”±äºæ˜¯few-shotï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œä½œè€…é‡‡ç”¨äº†ä¸Knowledge Distillationç±»ä¼¼çš„æ€è·¯ï¼Œå…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><p>1.<em> å¯¹æ¯ä¸ªPatternåˆ©ç”¨å¤šä¸ªpre-train model è¿›è¡Œfine-tuningï¼Œå¾—åˆ°å¤šä¸ªæ¨¡å‹.å…¶ä¸­$loss=L_{ce} + L_{mlm}$;</em><br>2.<em> å°†å¤šä¸ªæ¨¡å‹çš„ç»“æœè¿›è¡Œèåˆï¼Œå¾—åˆ°ä¸€ä¸ªèåˆæ¨¡å‹Teacher Modelï¼›</em><br>3.<em> åˆ©ç”¨Teacher Modelåœ¨å¤§é‡unlabedæ•°æ®ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œå¾—åˆ°å¯¹åº”çš„soft labelsï¼›</em><br>4.<em> åˆ©ç”¨soft labelsæ•°æ®ï¼Œè®­ç»ƒä¸€ä¸ªå¸¸è§„çš„åˆ†ç±»æ¨¡å‹ï¼ˆéMLMæ¨¡å‹ï¼‰ã€‚</em></p><p>ä»¥ä¸Šå°±æ˜¯è®ºæ–‡<a href="http://arxiv.org/abs/2001.07676" target="_blank" rel="noopener">Exploiting Cloze Questions for Few Shot Text Classification and Natural Language Inference</a>ä¸­æåˆ°çš„PETã€‚<br>æ­¤å¤–ï¼Œè¯¥è®ºæ–‡ä¸­è¿˜æåˆ°äº†ä¸€ä¸ªæ”¹è¿›ï¼šiPETã€‚å…¶ä¸­çš„åŒºåˆ«æ˜¯ï¼šåœ¨ipetä¸­ï¼Œå¾—åˆ°mlmçš„å¤šä¸ªmodelåï¼Œå¢åŠ ä¸€ä¸ªè¿­ä»£ï¼šæ¯æ¬¡ä¼šä»è®­ç»ƒmlmçš„modelä¸­æŠ½å–ä¸€ä¸ª$m_i$ï¼Œç„¶åä»å‰©ä½™çš„modelä¸­é€‰å–ä¸€éƒ¨åˆ†å¯¹unlabeled dataè¿›è¡Œé¢„æµ‹ï¼Œå°†å…¶ä¸­é¢„æµ‹ç»“æœç¡®å®šï¼ˆä¸æ˜¯å‡†ç¡®ï¼Œæ­¤æ—¶æ„å‘³ç€ç»“æœçš„ç†µå¾ˆå°ï¼‰çš„éƒ¨åˆ†æ‰“ä¸Šä¸€ä¸ªfake labelï¼Œè®©$m_i$è¿›è¡Œè®­ç»ƒã€‚é‡å¤å¤šæ¬¡åï¼Œèåˆæ¨¡å‹å¯¹unlabeled dataè¿›è¡Œé¢„æµ‹ï¼Œå¾—åˆ°ä¸€ä¸ªsoft labels dataï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè®­ç»ƒä¸€ä¸ªå¸¸è§„åˆ†ç±»å™¨ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒPETçš„æ–¹å¼ä¸»è¦é€‚ç”¨label descriptionä¸ºæœ‰é™ç©ºé—´ï¼Œå³é€‰æ‹©é¢˜ï¼Œæ­¤å¤–ï¼Œæ¯ä¸ªæ ·æœ¬çš„label descriptionéœ€è¦é•¿åº¦ç›¸åŒï¼Œè€Œä¸”ç”±äºmaskä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ‰€ä»¥é•¿åº¦ä¹Ÿä¸èƒ½å¤ªé•¿ã€‚</p><h1><span id="yu-nlg-chai-yi">ä¸NLGå·®å¼‚</span><a href="#yu-nlg-chai-yi" class="header-anchor"></a></h1><p>åœ¨ä¹‹å‰çš„è„‘æ´ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†ç±»ä»»åŠ¡è½¬å˜ä¸ºNLGä»»åŠ¡ï¼Œå³åˆ©ç”¨æ ·æœ¬æ¥ç”Ÿæˆå¯¹åº”çš„label descriptionï¼Œè€Œä»–ä¸PETä¸­çš„ä¸»è¦å·®åˆ«ä¸»è¦æœ‰å‡ ç‚¹ï¼š</p><p>1.<em> NLGä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰æ²¡æœ‰é™åˆ¶label descriptionçš„é•¿åº¦ï¼Œä¸”ä¸åŒlabelå¯¹åº”descriptionä¹Ÿå¯èƒ½æ˜¯ä¸åŒé•¿åº¦ï¼›</em><br>2.<em> NLGä¸­æˆ‘ä»¬æ¯ä¸ªtokençš„ç”Ÿæˆæ˜¯æœ‰ä¾èµ–å…³ç³»çš„ï¼Œå³åé¢çš„tokenä¼šä¾èµ–ä¹‹å‰çš„tokenï¼Œæ‰€ä»¥tokené•¿åº¦å¯ä»¥æ¯”PETä¸­ç¨å¾®é•¿ä¸€äº›ï¼›</em><br>3.<em> PETä¸­å¯¹åº”çš„è§£ç ç©ºé—´å¤§å¤§å‡å°ï¼Œåªéœ€è¦å¾—åˆ°labelå¯¹åº”tokençš„æ¦‚ç‡å³å¯;</em><br>4.<em> PETä¸­çš„patternå¯ä»¥æ”¾åœ¨å‰ç¼€ä¹Ÿå¯ä»¥æ”¾åœ¨åç¼€ï¼ŒNLGå¯ä»¥çœ‹ä½œæ˜¯åç¼€PET.</em><br>5.<em> PET ä¸­ç”±äºpre-trainæ˜¯mlmä»»åŠ¡ï¼Œæ‰€ä»¥zero-showæ€§èƒ½æ›´å¥½ã€‚</em></p><h1><span id="shi-yan">å®éªŒ</span><a href="#shi-yan" class="header-anchor"></a></h1><p>é’ˆå¯¹è¿™äº›å·®å¼‚å°è¯•åšäº†å‡ ç»„å®éªŒï¼ŒéªŒè¯ä¸€ä¸‹æƒ³æ³•ã€‚</p><ol><li>NLGä¸­labelé•¿åº¦åŒä¸€ä¸”è§£ç æ—¶åˆ©ç”¨PETçš„æ–¹å¼è§£ç ï¼Œåœ¨few-shotä¸‹å‡†ç¡®ç‡ä»$52.4%$ä¸Šå‡åˆ°$52.9%$ï¼Œæ‰€ä»¥ç”Ÿæˆçš„labelè¶ŠçŸ­ï¼Œè§£ç ç©ºé—´è¶Šå°è¶Šå‡†ç¡®ï¼›</li><li>PETå‰ç¼€patternä¸‹å‡†ç¡®ç‡ä¸º%53.7%$,æ‰€ä»¥å‰ç¼€patternæ¯”åç¼€æ€§èƒ½æ›´å¥½ï¼Œè¿™ä¹Ÿä¸è‹å‰‘æ—<a href="https://spaces.ac.cn/archives/7764" target="_blank" rel="noopener">ã€Šå¿…é¡»è¦GPT3å—ï¼Ÿä¸ï¼ŒBERTçš„MLMæ¨¡å‹ä¹Ÿèƒ½å°æ ·æœ¬å­¦ä¹ ã€‹</a>çš„ç»“è®ºä¸€è‡´ã€‚</li><li>zero-shotæƒ…å†µä¸‹ï¼ŒPETçš„å‡†ç¡®ç‡ä¸º$47.2%$, è€ŒNLGåªæœ‰$17.9%$ï¼Œè€ƒè™‘åˆ°æ•°æ®é›†å…¨é‡ä¸‹ç›®å‰æœ€å¥½æˆç»©æ‰$60.7%$,è¯´æ˜PETçš„æ–¹å¼åœ¨zero-shotä¸‹æ•ˆæœç›¸å½“æƒŠäººã€‚</li></ol><p>ä¸»è¦å®éªŒä»£ç åœ¨<a href="https://github.com/xv44586/toolkit4nlp/blob/master/examples/classification_pet_seq2seq.py" target="_blank" rel="noopener">classification_pet_seq2seq</a> ä¸ <a href="https://github.com/xv44586/toolkit4nlp/blob/master/examples/classification_tnews_pet.py" target="_blank" rel="noopener">classification_tnews_pet</a></p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬æ–‡ä»‹ç»äº†ä¸€ç§æ–°çš„è½¬å˜åˆ†ç±»ä»»åŠ¡è·å¾—æ›´å¥½æ€§èƒ½çš„æ–¹æ³•ï¼šå³å°†åˆ†ç±»ä»»åŠ¡è½¬åŒ–ä¸ºmlmæ¨¡å‹è¿›è¡Œå®Œå½¢å¡«ç©ºï¼ŒåŒæ—¶ä¸ä¹‹å‰è„‘æ´çš„å°†åˆ†ç±»è½¬å˜ä¸ºç”Ÿæˆä»»åŠ¡è¿›è¡Œå¯¹æ¯”ï¼Œé€šè¿‡å®éªŒéªŒè¯äº†ä¸¤è€…çš„å·®å¼‚ä¸æœ‰æ•ˆæ€§ã€‚åŒæ—¶ä¹Ÿæé†’è‡ªå·±ï¼Œå¤šæƒ³å‡ æ­¥ï¼Œä¹Ÿè®¸å°±èƒ½æœ‰æ–°çš„å‘ç°ã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="NLP" scheme="https://xv44586.github.io/categories/NLP/"/>
    
    
      <category term="Classification" scheme="https://xv44586.github.io/tags/Classification/"/>
    
      <category term="Few-shot" scheme="https://xv44586.github.io/tags/Few-shot/"/>
    
  </entry>
  
  <entry>
    <title>AdaBelief-æ›´ç¨³å®šçš„ä¼˜åŒ–å™¨</title>
    <link href="https://xv44586.github.io/2020/10/25/adabelief/"/>
    <id>https://xv44586.github.io/2020/10/25/adabelief/</id>
    <published>2020-10-25T02:26:54.000Z</published>
    <updated>2020-10-25T03:18:27.710Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#warmup">warmup</a></li><li><a href="#xiu-gai-adam">ä¿®æ”¹Adam</a></li><li><a href="#you-dian">ä¼˜ç‚¹</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div><br>å¯¹<code>Adam</code> è¿›è¡Œæ”¹è¿›çš„ç®—æ³•æœ‰å¾ˆå¤šï¼Œä»Šå¤©ä»‹ç»ä¸€ç¯‡æ”¹åŠ¨å¾ˆå°æ”¹åŠ¨å°æ•ˆæœä¸é”™çš„-<code>AdaBelief</code>ã€‚</p><h1><span id="warmup">warmup</span><a href="#warmup" class="header-anchor"></a></h1><p>åœ¨bertä¸­ç¬¬ä¸€æ¬¡è§åˆ°warmupçš„ä½¿ç”¨ï¼Œè€Œwarmupçš„ä½œç”¨æ˜¯è®©è®­ç»ƒæ›´ç¨³å®šï¼Œæœ€åæ”¶æ•›çš„æ›´å¥½ã€‚è€Œwarmupæœ‰æ•ˆçš„ä¸€ä¸ªåŸå› æ˜¯å‡ç¼“è®­ç»ƒåˆæœŸæ¨¡å‹å¯¹mini-batchçš„æå‰è¿‡æ‹Ÿåˆï¼ŒåŒæ—¶ï¼Œåœ¨è®­ç»ƒåˆæœŸï¼Œç”±äºlossè¾ƒå¤§ï¼Œæ¨¡å‹è¿˜æ²¡å¾—åˆ°å¤šå°‘è®­ç»ƒï¼Œä¸åŒstep ä¹‹é—´çš„æ¢¯åº¦æ–¹å·®è¾ƒå¤§ï¼Œè€Œæ­¤æ—¶å¦‚æœä½¿ç”¨è¾ƒå¤§çš„æ­¥é•¿æ›´æ–°ï¼Œåˆ™ä¼šæœé”™è¯¯çš„æ–¹å‘èµ°ä¸€å¤§æ­¥ï¼Œè€Œéšåçš„æ¨¡å‹ä¸æ–­å¾—åˆ°è®­ç»ƒï¼Œå¯¹åº”çš„æ¢¯åº¦ä¸æ–­å‡å°ï¼ŒåŒæ—¶ä¸€èˆ¬æˆ‘ä»¬ä¼šé‡‡ç”¨ä¸æ–­è¡°å‡çš„å­¦ä¹ ç‡ï¼Œè¿™äº›éƒ½å¯¼è‡´éšç€æ¨¡å‹çš„è®­ç»ƒï¼Œæ›´æ–°çš„æ­¥é•¿ä¸æ–­å˜å°ï¼Œè€Œå‰æœŸæœé”™è¯¯æ–¹å‘çš„ä¸€å¤§æ­¥æ›´æ–°å¯èƒ½éœ€è¦åæœŸå¾ˆå¤šæ­¥çš„æ›´æ–°æ‰èƒ½å¼¥è¡¥ï¼Œæœ‰æ—¶å€™å¯èƒ½ç”šè‡³æ— æ³•å¼¥è¡¥ï¼Œè¿™å°±å¯¼è‡´æ¨¡å‹æœ€åæ”¶æ•›åœ¨ä¸€ä¸ªä¸æ€ä¹ˆå¥½çš„å±€éƒ¨æœ€ä¼˜ç‚¹ï¼Œè€Œå¦‚æœåœ¨å‰æœŸæ—¶æŠ‘åˆ¶å¯èƒ½å‡ºç°çš„å¤§æ­¥æ›´æ–°ï¼Œä¿æŒæ¨¡å‹ä¿æŒâ€œå°æ­¥èµ°â€ï¼Œåˆ™å¯ä»¥é¿å…æ¨¡å‹åœ¨é”™è¯¯æ–¹å‘ä¸Šçš„å¤§æ­¥æ›´æ–°ï¼Œè€Œç”±æ¨¡å‹çš„ä¸æ–­è®­ç»ƒè°ƒæ•´ä¼šæ­£ç¡®çš„è½¨é“ã€‚<br>æ‰€ä»¥ä¸€ä¸ªé‡è¦çš„ç‚¹æ˜¯æ¢¯åº¦æ›´æ–°æ–¹å·®å¤§æ—¶ï¼ˆä¸åŒtime stepï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è°¨æ…è¡Œäº‹ï¼Œé˜²æ­¢å‡ºç°å¤§é”™æ­¥ï¼Œè€Œæ–¹å·®å°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†ä¸€äº›ï¼Œå› ä¸ºæ­¤æ—¶æ–¹å‘ä¸ŠåŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥å¤§è¸æ­¥çš„å¾€å‰èµ°ã€‚</p><h1><span id="xiu-gai-adam">ä¿®æ”¹Adam</span><a href="#xiu-gai-adam" class="header-anchor"></a></h1><p>ç°åœ¨è®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹Adamæ›´æ–°å…¬å¼ï¼š</p><p>$$<br>\theta_t = \theta_{t-1} - \alpha \frac{m_t}{\sqrt{v_t}}<br>$$</p><p>å…¶ä¸­$m_t$æ˜¯å¯¹$g_t$çš„é¢„æµ‹ï¼Œ$v_t$æ˜¯å¯¹$g_t^2$çš„é¢„æµ‹ï¼Œå¯¹åº”çš„æ›´æ–°æ–¹å‘ä¸º$\frac{m_t}{\sqrt{v_t}}$.<br>$m_t$é™¤äº†æ˜¯å¯¹$g_t$çš„é¢„æµ‹å¤–ï¼Œè¿˜å¯ä»¥çœ‹åšæ˜¯æœ€è¿‘ä¸€æ®µæ—¶é—´å†…ï¼ˆå¤§æ¦‚ä¸º$\frac{1}{1-\alpha}$ï¼‰æ¢¯åº¦çš„å‡å€¼,è€Œä¸ºäº†è¡¨å¾å½“å‰æ¢¯åº¦$g_t$æ‰€å¤„åŒºåŸŸçš„æ–¹å·®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨$belief = \left | g_t - m_t\right |$,å³å½“å‰æ¢¯åº¦è·æœ€è¿‘ä¸€æ®µåŒºåŸŸæ¢¯åº¦å‡å€¼çš„è·ç¦»ã€‚åœ¨ç»“åˆAdamçš„æ›´æ–°å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨$s_t = (g_t - m_t) ^ 2$ æ¥ä»£æ›¿$v_t$,å³åœ¨æ–¹å·®å¤§çš„åŒºåŸŸæ›´æ–°æ—¶å‡å°æ­¥é•¿ï¼Œè€Œåœ¨æ–¹å·®å°çš„åŒºåŸŸï¼Œå¿«æ­¥å¤§èµ°ï¼Œæœ€åçš„æ›´æ–°å…¬å¼ä¸ºï¼š</p><p>$$<br>\theta_t = \theta_{t-1} - \alpha \frac{m_t}{\sqrt{s_t}}<br>$$</p><p>æ­¤æ—¶çš„æ›´æ–°æ–¹å‘ä¸º$\frac{m_t}{\sqrt{s_t}}$.<br>è¿™å°±æ˜¯<a href="https://arxiv.org/pdf/2010.07468.pdf" target="_blank" rel="noopener">AdaBelief Optimizer</a>çš„æ ¸å¿ƒæ€æƒ³ã€‚å…·ä½“çš„æ›´æ–°æµç¨‹ä¸Adamåªéœ€è¦ä¿®æ”¹ä¸€å°éƒ¨åˆ†å³å¯ï¼š<br><img src="/2020/10/25/adabelief/opt.jpg" alt></p><h1><span id="you-dian">ä¼˜ç‚¹</span><a href="#you-dian" class="header-anchor"></a></h1><p>ä½œè€…åœ¨è®ºæ–‡ä¸­æåˆ°AdaBeliefèƒ½åª²ç¾Adamçš„æ”¶æ•›é€Ÿåº¦ï¼ŒåŒæ—¶è¾¾åˆ°SGDçš„å‡†ç¡®ç‡ã€‚æˆ‘åšäº†å‡ ä¸ªå®éªŒï¼Œç”±äºæ˜¯åœ¨å°æ•°æ®é›†ä¸Šfine-tuningï¼Œæ‰€ä»¥å¯èƒ½ä¸å¦‚åœ¨å¤§æ•°æ®é›†ä¸Šä»å¤´è®­ç»ƒæ•ˆæœæ˜æ˜¾ã€‚ä¸è¿‡ä¾ç„¶å¯ä»¥å¾—åˆ°ï¼š<br>1.<em>lossä¸Šç›¸å¯¹Adamæ›´å¹³ç¨³</em><br>2.<em>æ”¶æ•›ä¸Šæ¯”Adamç¨å¿«</em><br>3.<em>æ€§èƒ½ä¸Šæ¯”Adamæ›´å¥½</em></p><p>loss å¯¹æ¯”å›¾<br><img src="/2020/10/25/adabelief/loss.png" alt></p><p>accuracyå¯¹æ¯”å›¾<br><img src="/2020/10/25/adabelief/acc.png" alt></p><p>å®éªŒä»£ç ï¼š<a href="https://github.com/xv44586/toolkit4nlp/blob/master/examples/classification_adabelief.py" target="_blank" rel="noopener">classification_adabelief</a></p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬æ–‡ä»‹ç»ä¸€ä¸ªæœ€æ–°çš„ä¼˜åŒ–å™¨AdaBeliefï¼Œå¹¶ä»ä¸è®ºæ–‡ä¸åŒè§’åº¦è§£é‡Šå…¶ä¸»è¦ä½œç”¨ï¼Œåœ¨å®é™…å·¥ä½œä¸­å¯ä»¥å°è¯•ä½¿ç”¨AdaBeliefï¼Œä¹Ÿè®¸èƒ½å¾—åˆ°æ¯”Adamæ”¶æ•›æ›´å¿«æ€§èƒ½æ›´å¥½çš„ç»“æœã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p>ç®—æ³•æ”¹è¿›å¯¹æ¯”å›¾</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="MachineLearning" scheme="https://xv44586.github.io/categories/MachineLearning/"/>
    
    
      <category term="Optimizer" scheme="https://xv44586.github.io/tags/Optimizer/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€åˆ‡ä¸‰æ®µæˆä¸‰è§’å½¢</title>
    <link href="https://xv44586.github.io/2020/10/19/triangle/"/>
    <id>https://xv44586.github.io/2020/10/19/triangle/</id>
    <published>2020-10-19T13:23:48.000Z</published>
    <updated>2020-10-20T15:11:24.993Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#ti-mu">é¢˜ç›®</a></li><li><a href="#jie-da">è§£ç­”</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --></div><p>å¬åˆ°ä¸€ä¸ªé¢˜ç›®ï¼Œè¿˜æŒºæœ‰æ„æ€ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚</p><h1><span id="ti-mu">é¢˜ç›®</span><a href="#ti-mu" class="header-anchor"></a></h1><p>é—®ï¼šä¸€ä¸ªç»³å­é•¿<code>a</code>ï¼Œä»»æ„å‰ªä¸¤åˆ€å˜æˆä¸‰æ®µåï¼Œå¯ä»¥ç»„æˆä¸€ä¸ªä¸‰è§’å½¢çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p><h1><span id="jie-da">è§£ç­”</span><a href="#jie-da" class="header-anchor"></a></h1><p>åˆ†æä¸€ä¸‹é¢˜ç›®ï¼Œä¸€æ®µé•¿åº¦å›ºå®šçš„ç»³å­ï¼Œåˆ‡å‰²ä¸ºä¸‰æ®µï¼Œåˆ™ï¼š<br>1.<em> ä»»æ„ä¸€æ®µç»³å­çš„é•¿åº¦å¤§äº0å°äº<code>a</code>ï¼›</em><br>2.<em> ä»»æ„ä¸¤æ®µç»³å­çš„é•¿åº¦å¤§äº0å°äº<code>a</code>ã€‚</em></p><p>è€Œä¸‰æ®µç»³å­å¯ä»¥ç»„æˆä¸€ä¸ªä¸‰è§’å½¢ï¼Œè€Œä¸‰è§’å½¢ä¸­ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹ï¼Œæ‰€ä»¥æ„å‘³ç€ï¼š<br>1.<em>ä»»æ„ä¸€æ®µçš„é•¿åº¦å°äº<code>a/2</code>ï¼›</em><br>2.<em>ä»»æ„ä¸¤æ®µçš„é•¿åº¦å’Œå¤§äº<code>a/2</code>.</em></p><p>ç°åœ¨è®¾å…¶ä¸­ä¸¤æ®µçš„é•¿åº¦åˆ†åˆ«ä¸º <code>x</code>, <code>y</code>ï¼Œç”»å‡ºä¸€ä¸ªç›´è§’åæ ‡ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="/2020/10/19/triangle/triangle.png" alt></p><p>åŒæ—¶è¿æ¥<code>(0, a), (a, 0)</code>ä¸¤ç‚¹ï¼Œåˆ™åˆ‡å‰²ç»³å­åå…¶ä¸­ä¸¤æ®µçš„é•¿åº¦çš„æ‰€æœ‰å¯å–çš„å€¼å¯¹åº”ç”±<code>(0, 0),(a, 0), (0, a)</code>ç»„æˆçš„ä¸‰è§’å½¢åŒºåŸŸã€‚<br>ç®€å•è¯æ˜å¦‚ä¸‹ï¼šå¯¹äºä»»æ„ä¸€ç‚¹<code>B</code>,æˆ‘ä»¬åšå…¶å¯¹<code>y</code>è½´çš„å‚çº¿ï¼Œç›¸äº¤ä¸ç‚¹<code>P</code>,è€Œç‚¹<code>B</code>ä½äº<code>(a, 0) (0, a)</code>çš„è¿çº¿æ—¶ï¼Œå¯¹åº”$\angle PAB  = 45^o$,æ­¤æ—¶<br>$PB=PA \Rightarrow  PB + PO = PA + PO = a$,è€Œå½“<code>P</code>ä½äºè¿çº¿å¤–ä¾§ï¼Œåˆ™$\angle PAB  &gt; 45^o$,å¯¹åº”$PO + PB &gt; PO + PA = a$,ä¸æ»¡è¶³çº¦æŸã€‚è€Œ$\Delta A O C$ çš„é¢ç§¯ä¸º $a^2 / 2$.</p><p>è€Œå¯¹äºèƒ½ç»„æˆä¸‰è§’å½¢æ—¶ï¼Œé¦–å…ˆä»»æ„ä¸€æ¡é•¿åº¦å°äº$a/2$ï¼Œå¯¹åº”<code>(0, a/2),(a/2,a/2)</code>è¿çº¿ä¸<code>(a/2,0)(a/2,a/2)</code>è¿çº¿å›´åŸçš„çŸ©å½¢åŒºåŸŸï¼Œè€Œä»»æ„ä¸¤è¾¹ä¹‹å’Œå¤§äº$a/2$,åˆ©ç”¨ä¹‹å‰çš„æ–¹æ³•å¯ä»¥è¯æ˜æ˜¯(0,a/2)(a/2, 0)è¿çº¿å³ä¾§åŒºåŸŸï¼Œä¸¤è€…çš„äº¤å³å›¾ä¸­ç»¿è‰²ä¸‰è§’å½¢åŒºåŸŸï¼Œå…¶é¢ç§¯ä¸º$(a/2)^2/2 = a^2 / 8$</p><p>æ‰€ä»¥æœ€åç»“è®ºæ˜¯ç»„æˆä¸‰è§’å½¢çš„æ¦‚ç‡ä¸ºä¸¤ä¸ªé¢ç§¯ä¹‹æ¯”ï¼š<br>$$<br>pro = \frac{a^2/8}{a^2/2} = 1/4<br>$$</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="Math" scheme="https://xv44586.github.io/categories/Math/"/>
    
    
      <category term="Statistics" scheme="https://xv44586.github.io/tags/Statistics/"/>
    
  </entry>
  
  <entry>
    <title>æ ·æœ¬ä¸å‡è¡¡ä¹‹éš¾æ˜“ä¸å‡è¡¡</title>
    <link href="https://xv44586.github.io/2020/10/14/focal-loss/"/>
    <id>https://xv44586.github.io/2020/10/14/focal-loss/</id>
    <published>2020-10-14T13:35:55.000Z</published>
    <updated>2020-11-11T14:47:58.900Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="toc"><!-- toc --><ul><li><a href="#cross-entropy">Cross Entropy</a></li><li><a href="#yang-ben-lei-bie-bu-jun-heng">æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡</a></li><li><a href="#focal-loss">Focal Loss</a><ul><li><a href="#ru-he-que-ding-alpha-yu-gamma">å¦‚ä½•ç¡®å®š$\alpha$ ä¸ $\gamma$</a></li><li><a href="#shi-yan">å®éªŒ</a></li></ul></li><li><a href="#ghm">GHM</a></li><li><a href="#zong-jie">æ€»ç»“</a></li><li><a href="#guan-yu-tou-tu">å…³äºå¤´å›¾</a></li></ul><!-- tocstop --><p></div><br>ä¸Šç¯‡<a href="https://xv44586.github.io/2020/09/25/fastbert/">çœ‹æ ·æœ¬ä¸‹èœçš„FastBERT</a>æåˆ°æ ·æœ¬æœ‰éš¾æ˜“ï¼Œé€šè¿‡åˆ©ç”¨æ ·æœ¬çš„è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥åœ¨æ¨ç†ä¸Šè¿›è¡ŒåŠ é€Ÿï¼Œé™¤äº†åœ¨æ¨ç†ä¸Šå¯ä»¥åˆ©ç”¨ï¼Œåœ¨è®­ç»ƒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨ï¼Œæœ¬ç¯‡å°±æ¥è¯´æ€ä¹ˆåœ¨è®­ç»ƒæ—¶æ›´å……åˆ†çš„åˆ©ç”¨æ ·æœ¬æœ‰éš¾æ˜“çš„ç‰¹æ€§ã€‚</p><h1><span id="cross-entropy">Cross Entropy</span><a href="#cross-entropy" class="header-anchor"></a></h1><p>å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œé€šå¸¸æˆ‘ä»¬é€‰æ‹©äº¤å‰ç†µä½œä¸ºæŸå¤±ã€‚æœ¬æ–‡å‡é’ˆå¯¹äºŒåˆ†ç±»è¿›è¡Œè¯´æ˜ï¼Œå¤šåˆ†ç±»çš„æƒ…å†µå¯ä»¥æ¨ªå‘æ‰©å±•ã€‚å¯¹äºäºŒåˆ†ç±»é—®é¢˜æ¥è¯´ï¼Œå…¶æŸå¤±CEï¼š</p><p>$$<br>CE = \left\{\begin{matrix}<br> -log(p)&amp; y\_true=1  \\<br> -log(1-p),&amp; y\_true=0<br>\end{matrix}\right.<br>$$</p><h1><span id="yang-ben-lei-bie-bu-jun-heng">æ ·æœ¬ç±»åˆ«ä¸å‡è¡¡</span><a href="#yang-ben-lei-bie-bu-jun-heng" class="header-anchor"></a></h1><p>å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªæ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡çš„æƒ…å†µï¼Œå¦‚1:1000æ—¶ï¼Œç›´æ¥è®­ç»ƒåæ•ˆæœå¾€å¾€ä¸å¥½ï¼Œå…¶å€¾å‘äºå°†æ›´å¤šçš„æ ·æœ¬é¢„æµ‹ä¸ºç±»åˆ«å¤šçš„ç±»ï¼Œè€Œäº§ç”Ÿçš„åŸå› æ˜¯ï¼šç”±äºæˆ‘ä»¬è®­ç»ƒæ—¶ä½¿ç”¨çš„ CE:<br>$CE_W = CE_positive + CE_negative$, å…¶ä¸­CE_positive ä¸ CE_negative åˆ†åˆ«ä»£è¡¨æ­£è´Ÿæ ·æœ¬çš„lossï¼Œè€Œç”±äºæ­¤æ—¶çš„æ ·æœ¬ä¸å‡è¡¡ï¼Œlossä¸»è¦æœ‰ç±»åˆ«å¤šçš„æ ·æœ¬è´¡çŒ®ï¼Œä¸»å¯¼äº†ä¼˜åŒ–æ–¹å‘ï¼Œæ‰€ä»¥æ¨¡å‹ä¼šåå‘æ•°é‡å¤šçš„æ–¹å‘ï¼Œå¦‚å½“å‰å…¨éƒ¨é¢„æµ‹ä¸ºæ­£æ ·æœ¬ï¼Œé‚£è§£å†³è¿™ä¸ªé—®é¢˜æœ€ç®€å•ç›´æ¥çš„åŠæ³•å°±æ˜¯åœ¨lossä¸Šå¢åŠ ä¸€ä¸ªæƒé‡Î±æ¥å‡è¡¡ä¸€ä¸‹ä¸¤æ–¹çš„lossï¼Œä»è€Œè®©æ¨¡å‹æ›´â€œå…¬å¹³â€çš„å¯¹å¾…ä¸åŒç±»åˆ«æ ·æœ¬,å³ï¼š</p><p>$$<br>CE_W = \left\{\begin{matrix}<br> -\alpha log(p)&amp; y\_true=1  \\<br> -(1-\alpha)log(1-p),&amp; y\_true=0<br>\end{matrix}\right.<br>$$</p><h1><span id="focal-loss">Focal Loss</span><a href="#focal-loss" class="header-anchor"></a></h1><p>é™¤äº†åœ¨ç±»åˆ«ä¸Šå¯èƒ½å­˜åœ¨è¿™ç§ä¸å‡è¡¡å¤–ï¼Œæ ·æœ¬åœ¨éš¾æ˜“ç¨‹åº¦ä¸Šå¾€å¾€ä¹Ÿä¼šæœ‰éš¾æ˜“ä¹‹åˆ†ã€‚å¦‚å½“è®­ç»ƒä¸€ä¸ªæƒ…æ„Ÿåˆ†ç±»å™¨æ—¶ï¼Œâ€œä¸å–œæ¬¢xxâ€å°±æ¯”â€œè°ä¸å–œæ¬¢xxå‘¢â€è¦å®¹æ˜“è®­ç»ƒä¸€äº›. ä¸ºäº†è¡¡é‡è¿™ç§â€œéš¾æ˜“â€ç‰¹å¾ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªä»£è¡¨é¢„æµ‹å€¼ä¸çœŸå®label ä¹‹é—´å·®è·çš„å‚æ•°$p_t$:</p><p>$$<br>p_t = \left\{\begin{matrix}<br> 1-p,&amp; y\_true=1  \\<br> p,&amp; y\_true=0<br>\end{matrix}\right.<br>$$</p><p>å³</p><p>$$<br>p_t = \begin{vmatrix}<br>pred - y_{true}<br>\end{vmatrix}<br>$$</p><p>ptè¶Šå¤§åˆ™è¯´æ˜é¢„æµ‹å€¼ä¸å…¶label ç›¸å·®è¶Šå¤§ï¼Œä¹Ÿå³æ ·æœ¬è¶Šâ€œéš¾è®­ç»ƒâ€ï¼Œæœ€åæˆ‘ä»¬å¯¹æ•´ä¸ªæ ·æœ¬çš„pt ç»Ÿè®¡å¾€å¾€å¾—åˆ°ä¸€ä¸ªUå‹åˆ†å¸ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2020/10/14/focal-loss/a1.png" alt><br>å³â€œæ˜“è®­ç»ƒâ€æ ·æœ¬æ˜¯â€œéš¾è®­ç»ƒâ€æ ·æœ¬çš„æŒ‡æ•°çº§ã€‚è™½ç„¶æ­¤æ—¶â€œæ˜“è®­ç»ƒâ€æ ·æœ¬ç”±äºå¾—åˆ°äº†å¾ˆå¥½çš„è®­ç»ƒï¼Œå…¶loss å¾ˆå°ï¼Œå½“ç”±äºå…¶æ•°é‡åºå¤§ï¼Œä»»ç„¶å¯èƒ½ä¸»åŠ¨æ•´ä¸ªè®­ç»ƒã€‚<br>æ‰€ä»¥ä¸ºäº†è§£å†³éš¾æ˜“ä¸å‡è¡¡çš„é—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸æ ·æœ¬ä¸å‡è¡¡ä¸€æ ·çš„æ–¹æ³•ï¼šå¯¹ä¸åŒæ ·æœ¬æ·»åŠ ä¸€ä¸ªæƒé‡æ¥å¹³è¡¡ï¼Œå³æ­¤æ—¶çš„loss FL:</p><p>$$<br>FL = \left\{\begin{matrix}<br> -\alpha \beta(p\_t) log(p)&amp; y\_true=1  \\<br> -(1-\alpha)\beta(1-p\_t)log(1-p),&amp; y\_true=0<br>\end{matrix}\right.<br>$$</p><p>è€Œå‰é¢æˆ‘ä»¬è¯´éš¾æ˜“æ ·æœ¬çš„loss å‘ˆæŒ‡æ•°çº§å·®è·ï¼Œæ‰€ä»¥æ­¤æ—¶çš„$\beta(p_t)$ æˆ‘ä»¬ä¹Ÿå®šä¹‰ä¸ºæŒ‡æ•°å‡½æ•°ï¼Œæœ€ç»ˆçš„ FL:</p><p>$$<br>FL = \left\{\begin{matrix}<br> -\alpha(1 - p)^{\gamma} log(p)&amp; y\_true=1  \\<br> -(1-\alpha)(p)^{\gamma}log(1-p),&amp; y\_true=0<br>\end{matrix}\right.<br>$$</p><p>æ­¤æ—¶ï¼Œ$\alpha$ ç”¨æ¥å¹³è¡¡æ ·æœ¬ä¸å‡è¡¡ï¼Œ$(1-p)^{\gamma}$ ç”¨æ¥å‡è¡¡éš¾æ˜“æ ·æœ¬ã€‚é€šè¿‡å¹³è¡¡éš¾æ˜“æ ·æœ¬å¯¹åº”æŸå¤±ï¼Œè®©æ¨¡å‹æ›´â€œå…³æ³¨â€é‚£äº›éš¾åˆ†çš„æ ·æœ¬ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯<a href="https://arxiv.org/pdf/1708.02002.pdf" target="_blank" rel="noopener">focal loss</a> çš„ä¸»è¦æ€æƒ³ï¼Œè™½ç„¶æœ€åæˆ‘ä»¬å¾—åˆ°çš„losså½¢å¼ä¸Šä¸focal lossä¸€æ ·ï¼Œä½†å…¶ä¸­å‚æ•°çš„å«ä¹‰ä¸focal lossä¸­çš„å†…å®¹å´æœ‰ä¸€äº›ä¸åŒï¼Œä¸»è¦åœ¨äºfocal loss ä¸­å®éªŒè¯æ˜ï¼Œç”±äºå¯¹éš¾æ˜“æ ·æœ¬é™æƒåæ­£æ ·æœ¬ï¼ˆé‡å°‘çš„ç±»ï¼‰å¯¹åº”çš„lossåè€Œæ›´æ˜“ä¸»åŠ¨ä¼˜åŒ–æ–¹å‘ï¼Œæ‰€ä»¥ç”¨ $\alpha$ æ¥é™æƒï¼Œè€Œæˆ‘ä»¬ä¸Šé¢æåˆ°çš„alpha ä¸»è¦æ˜¯ç”¨æ¥å‡è¡¡æ­£è´Ÿæ ·æœ¬ï¼Œè¿™é‡Œè¯»è€…å¯ä»¥è‡ªè¡Œåˆ¤æ–­ç†è§£ã€‚æ­¤å¤–ï¼Œè‹å‰‘æ—é€šè¿‡ç¡¬æˆªæ–­è¿‡æ¸¡åˆ°è½¯é˜¶æ®µä¹Ÿå¾—åˆ°äº†ç±»ä¼¼çš„lossï¼Œæ¨èå¤§å®¶ä¹Ÿçœ‹çœ‹ï¼š<a href="https://spaces.ac.cn/archives/4733" target="_blank" rel="noopener">ä»lossçš„ç¡¬æˆªæ–­ã€è½¯åŒ–åˆ°focal loss </a></p><h2><span id="ru-he-que-ding-alpha-yu-gamma">å¦‚ä½•ç¡®å®š$\alpha$ ä¸ $\gamma$</span><a href="#ru-he-que-ding-alpha-yu-gamma" class="header-anchor"></a></h2><p>åœ¨focal lossè®ºæ–‡å†…ï¼Œä½œè€…æ˜¯é€šè¿‡æœç´¢ä¸€ä¸ªèŒƒå›´æ¥ç¡®å®šä¸¤ä¸ªå‚æ•°çš„æœ€ä¼˜è§£ï¼Œæœ€åç»™å‡ºçš„ç»“æœæ˜¯ $\alpha = 0.25$, $\gamma=2.$ï¼Œè€Œé€šè¿‡ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªç¡®å®šå‚æ•°èŒƒå›´çš„æ–¹æ¡ˆï¼š<br>1.é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ç»Ÿè®¡æ­£è´Ÿæ ·æœ¬ï¼Œæ¥ç¡®å®š$\alpha$çš„å¤§è‡´èŒƒå›´ï¼›<br>2.é€šè¿‡CE_Wæˆ‘ä»¬å¯ä»¥è®­ç»ƒä¸€ä¸ªåŸºç¡€çš„åˆ†ç±»å™¨ï¼Œé€šè¿‡è¿™ä¸ªåˆ†ç±»å™¨ï¼Œæˆ‘ä»¬å¯¹è®­ç»ƒé›†è¿›è¡Œé¢„æµ‹ï¼Œç”Ÿæˆå¯¹åº”çš„probï¼Œç„¶åé€šè¿‡ç»Ÿè®¡$p_t$ï¼Œæˆ‘ä»¬è®¤ä¸º$p_t&lt;=0.1$ çš„ä¸ºä¸»è¦çš„â€œæ˜“åˆ†æ ·æœ¬â€ï¼Œ${p_t&gt;=0.9}$ ä¸ºä¸»è¦â€œéš¾åˆ†æ ·æœ¬â€ï¼Œç”±äºæ˜¯æŒ‡æ•°è¡°å‡ï¼Œæ‰€ä»¥ä¸¤è€…çš„loss å·®è·ä¸º $9^\gamma$, å³æ­¤æ—¶$9^\gamma=C_æ˜“/C_éš¾$, è§£å‡ºæ­¤æ—¶çš„$\gamma$ å³å¯å¾—åˆ°å…¶å¤§è‡´çš„èŒƒå›´ã€‚</p><h2><span id="shi-yan">å®éªŒ</span><a href="#shi-yan" class="header-anchor"></a></h2><p>å®éªŒæ—¶ï¼Œé€šè¿‡æ„é€ ä¸€ä¸ªæ­£è´Ÿæ ·æœ¬8:1çš„æ•°æ®é›†è¿›è¡Œå®éªŒï¼Œåœ¨é€šè¿‡æƒé‡å¹³è¡¡æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡åï¼Œå¯¹åº”çš„ptåˆ†å¸ƒå¦‚ä¸‹å›¾ï¼š<br><img src="/2020/10/14/focal-loss/a1.png" alt><br><img src="/2020/10/14/focal-loss/p1.png" alt><br><img src="/2020/10/14/focal-loss/n1.png" alt><br>è€Œfocal loss è®­ç»ƒåçš„pt åˆ†å¸ƒä¸ºï¼š<br><img src="/2020/10/14/focal-loss/a2.png" alt><br><img src="/2020/10/14/focal-loss/p2.png" alt><br><img src="/2020/10/14/focal-loss/n2.png" alt><br>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨focal loss ä¸‹ï¼Œå³ä¾§åå·®å¤§çš„æ ·æœ¬åŸºæœ¬éƒ½è¢«ç§»åˆ°äº†å·¦ä¾§ï¼Œè¯´æ˜â€œéš¾æ ·æœ¬â€å¤§å¹…åº¦å‡å°‘å˜ä¸ºäº†â€œæ˜“æ ·æœ¬â€ã€‚<br>å®éªŒä»£ç åœ°å€ï¼š<a href="https://github.com/xv44586/toolkit4nlp/blob/master/examples/classification_focal_loss.py" target="_blank" rel="noopener">classification use focal loss</a></p><h1><span id="ghm">GHM</span><a href="#ghm" class="header-anchor"></a></h1><p>ç°åœ¨è®©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹focal losså­˜åœ¨çš„é—®é¢˜ï¼š</p><ol><li>é¦–å…ˆï¼Œè®©æ¨¡å‹è¿‡å¤šçš„å…³æ³¨é‚£äº›ç‰¹åˆ«éš¾åˆ†çš„æ ·æœ¬æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªå‰æï¼šæ ·æœ¬ç´§å‡‘ã€‚è€Œå½“æ•°æ®ä¸­å­˜åœ¨ç¦»ç¾¤ç‚¹æ—¶ï¼Œé‚£æ­¤æ—¶å°±ä¼šå‘ç”Ÿï¼šæœ¬æ¥æ¨¡å‹å·²ç»æ”¶æ•›äº†ï¼Œä½†æ˜¯ç”±äºè¿™äº›ç¦»ç¾¤ç‚¹è¿˜æ˜¯ä¼šè¯¯åˆ¤ï¼Œä¸€ç›´å­˜åœ¨åœ¨ptçš„æœ€å³ä¾§ï¼Œè€Œè®©æ¨¡å‹å†è¿‡å¤šçš„å»å…³æ³¨è¿™äº›ç‚¹ï¼Œè¿™æ˜æ˜¾æ˜¯ä¸åˆé€‚çš„ï¼›</li><li>å¯¹äºfocal lossä¸­çš„ä¸¤ä¸ªå‚æ•°$\alpha$ å’Œ$\gamma$ ï¼Œè™½ç„¶æˆ‘ä»¬èƒ½ä¼°ç®—ä¸€ä¸ªå¤§è‡´èŒƒå›´ï¼Œä½†æ˜¯ç”±äºä¸¤è€…æ˜¯ç›¸äº’å½±å“çš„ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨æ—¶è¿˜æ˜¯éœ€è¦é€šè¿‡å®éªŒå»å¯»æ‰¾æœ€ä¼˜è§£ï¼Œè¿™ä¹Ÿä¸ºè®­ç»ƒå¢åŠ äº†ä¸€å®šçš„éš¾åº¦ã€‚</li></ol><p>ç°åœ¨å†è®©æˆ‘ä»¬å›è¿‡å¤´æ¥é‡æ–°å®¡è§†ä¸€ä¸‹æˆ‘ä»¬çš„åŸå§‹é—®é¢˜ï¼šæ ·æœ¬æœ‰éš¾æ˜“ä¹‹åˆ†ï¼Œæ‰€ä»¥è®­ç»ƒæ—¶å­˜åœ¨éš¾æ˜“æ ·æœ¬ä¸å‡è¡¡ï¼Œè€Œâ€æ˜“åˆ†â€æ ·æœ¬å æ¯”è¿‡é«˜å¯¼è‡´ä¸»å¯¼ä¼˜åŒ–æ–¹å‘ã€‚é‚£æ­¤æ—¶è®©æˆ‘ä»¬å¾€åå†æ€è€ƒä¸€æ­¥ï¼Œå½“æˆ‘ä»¬å¯¹æ˜“åˆ†æ ·æœ¬é™æƒåï¼Œå¯¹åº”çš„ptåˆ†å¸ƒå›¾ä¸­æœ€å·¦ä¾§çš„æŸ±å­ä¼šé™ä½ï¼Œè€Œç”±äºæ¨¡å‹å¾—åˆ°äº†æ›´å¥½çš„ä¼˜åŒ–æ–¹å‘ï¼Œæ¨¡å‹çš„æ€§èƒ½æé«˜ï¼Œæ‰€ä»¥æœ€å³ä¾§çš„æŸ±å­ä¹Ÿä¼šé™ä½ï¼Œä¸¤è¾¹å‡å°‘çš„æ ·æœ¬ä¼šåŒæ—¶å‘â€ä¸­é—´â€æ‰©æ•£ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªæ¯”åŸå§‹ptåˆ†å¸ƒæ›²çº¿æ›´â€å¹³æ»‘â€çš„åˆ†å¸ƒæ›²çº¿ï¼Œæ­£å¦‚ä¸Šæ–‡ä¸­focal losså¯¹åº”çš„ptåˆ†å¸ƒå›¾ã€‚<br>è€Œfocal loss ç”±äºè¿‡åº¦å…³æ³¨â€éš¾åˆ†æ ·æœ¬â€ï¼Œå¯¼è‡´å­˜åœ¨ç¦»ç¾¤ç‚¹æ—¶ä¸ç†æƒ³çš„é—®é¢˜ã€‚è€Œç¦»ç¾¤ç‚¹æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼šé‡ç›¸å¯¹æ­£å¸¸æ ·æœ¬éå¸¸å°‘ï¼ˆå¦åˆ™å°±æ˜¯ä¸€ä¸ªâ€å°ç¾¤â€äº†ï¼‰ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°±èƒ½å¯¹focal loss è¿›è¡Œæ”¹è¿›äº†ã€‚æ”¹è¿›çš„æ€è·¯å°±æ˜¯åˆ©ç”¨ç¦»ç¾¤ç‚¹å°‘çš„ç‰¹ç‚¹ï¼Œä»éš¾æ˜“æ ·æœ¬çš„é‡ä¸Šæ¥å¹³è¡¡éš¾æ˜“æ ·æœ¬çš„lossã€‚<br>å…·ä½“åšæ³•ï¼šæˆ‘ä»¬å°†$p_t$ æŒ‰é—´éš”$\varepsilon$å‡ç­‰çš„åˆ†ä¸ºKä¸ªåŒºé—´ï¼Œç„¶åç»Ÿè®¡ä¸åŒåŒºé—´å†…çš„æ ·æœ¬æ•°é‡$num_k$ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªåŒºé—´å†…çš„loss æˆ‘ä»¬ç”¨å‚æ•°$\beta(i)$ æ¥å¹³æ»‘ï¼š</p><p>$$<br>L_{GHN-C} = \sum_{1}^{N}\beta(i)L_{CE}(p_i,  \hat p_i)<br>$$</p><p>å…¶ä¸­ï¼š<br>$\beta(i)$å¯¹åº”$pt_i$æ‰€å±åŒºé—´çš„æ ·æœ¬$num_k$åœ¨æ•´ä½“æ ·æœ¬ $N$ ä¸­å æ¯”çš„å€’æ•°ã€‚<br>è€Œåœ¨å®ç°æ—¶ï¼Œç”±äºé€šå¸¸æˆ‘ä»¬éƒ½æ˜¯é‡‡å–mini-batch çš„æ–¹å¼è®­ç»ƒï¼Œæ— æ³•åœ¨æ¯ä¸ªbatchå†…äº‹å…ˆå¾—åˆ°å…¨å±€ç»Ÿè®¡é‡è¿›è¡Œ$\beta(i)çš„è®¡ç®—ï¼Œä¸€ç§è¿‘ä¼¼çš„åŠæ³•æ˜¯åˆ©ç”¨åŠ¨é‡ï¼Œé€æ­¥è¿‘ä¼¼æ±‚ã€‚<br>ä»¥ä¸Šå°±æ˜¯<a href="http://arxiv.org/abs/1811.05181" target="_blank" rel="noopener">GHM</a> åœ¨åˆ†ç±»æƒ…å†µä¸‹çš„lossï¼ŒåŸå§‹è®ºæ–‡ä¸­çš„pt åˆ†å¸ƒå¯¹æ¯”å›¾ä¸­ä¹Ÿèƒ½çœ‹åˆ°ï¼Œåˆ©ç”¨GHMç¡®å®æ›´å¹³æ»‘ã€‚<br><img src="/2020/10/14/focal-loss/gn.jpeg" alt> </p><h1><span id="zong-jie">æ€»ç»“</span><a href="#zong-jie" class="header-anchor"></a></h1><p>æœ¬æ–‡ä»‹ç»äº†ä¸¤ç§é’ˆå¯¹æ ·æœ¬éš¾æ˜“ä¸å‡è¡¡é—®é¢˜çš„lossï¼šfocal loss ä¸ GHMï¼Œå¹¶é€šè¿‡å®éªŒè¿›ä¸€æ­¥éªŒè¯äº†å…¶æœ‰æ•ˆæ€§ï¼Œåœ¨ä¸€äº›æ ·æœ¬ä¸å‡è¡¡çš„åœºæ™¯ä¸‹å‡å¯å°è¯•ä½¿ç”¨ã€‚</p><h1><span id="guan-yu-tou-tu">å…³äºå¤´å›¾</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h1><p><a href="https://arxiv.org/pdf/1811.05181.pdf" target="_blank" rel="noopener">Gradient Harmonized Single-stage Detector</a>ä¸­é…å›¾ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="MachineLearning" scheme="https://xv44586.github.io/categories/MachineLearning/"/>
    
    
      <category term="æ ·æœ¬ä¸å‡è¡¡" scheme="https://xv44586.github.io/tags/%E6%A0%B7%E6%9C%AC%E4%B8%8D%E5%9D%87%E8%A1%A1/"/>
    
      <category term="Loss" scheme="https://xv44586.github.io/tags/Loss/"/>
    
  </entry>
  
</feed>
