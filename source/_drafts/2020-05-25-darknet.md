---
author:
  nick: 小蛋子
  link: 'https://github.com/xv44586'
title: darknet
date: 2020-05-25 08:16:52
categories:
tags:
cover:
---
<!-- toc -->

yolov4出来了，打榜上看效果还不错，想自己测试一下，遂有了一次折腾darknet的机会，简单记录一下遇到的问题

# darknet
首先从[AlexeyAB](https://github.com/AlexeyAB/darknet)下载源码，修改 <code> Makefile </code> 中 <code>GPU=1 CUDNN=1 CUDNN_HALF=1 OPENCV=1 </code>，
然后直接<code>make</code>, 此时在当前文件夹下即可运行<code> ./darknet</code>
 
下载预训练权重[yolov4.weights](https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.weights),放入./build/darknet/x64/
 cd ./build/darknet/x64
 ../../../darknet detector demo cfg/coco.data cfg/yolov4.cfg yolov4.weights yolo_test.mp4 -out_filename res.mp4

# build
1. video stream stopped!
ffmpeg没有与opencv一起编译，需要重新安装opencv（从源码）
卸载之前安装的opencv，进入之前安装的opencv目录
<!bash>
sudo make uninstall
cd ..
rm -Rf build
cd /usr
find . -name "*opencv*" | xargs sudo rm -rf
yum remove opencv-data python-opencv
<>

cmake -D CMAKE_BUILD_TYPE=RELEASE     -D CMAKE_INSTALL_PREFIX=/usr/local     -D INSTALL_C_EXAMPLES=ON     -D INSTALL_PYTHON_EXAMPLES=ON     -D OPENCV_GENERATE_PKGCONFIG=ON     -D OPENCV_EXTRA_MODULES_PATH=~/root/Download/opencv_contrib/modules     -D BUILD_EXAMPLES=ON -D WITH_FFMPEG=ON ..

# 关于头图